/*! MIT License

Copyright (c) 2024 Lokuyow

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.nostrZapView=t():e.nostrZapView=t()}(self,(()=>(()=>{var e={203:(e,t)=>{"use strict";function n(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function r(...e){const t=(e,t)=>n=>e(t(n));return{encode:Array.from(e).reverse().reduce(((e,n)=>e?t(e,n.encode):n.encode),void 0),decode:e.reduce(((e,n)=>e?t(e,n.decode):n.decode),void 0)}}function i(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("alphabet.encode input should be an array of numbers");return t.map((t=>{if(n(t),t<0||t>=e.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${e.length})`);return e[t]}))},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("alphabet.decode input should be array of strings");return t.map((t=>{if("string"!=typeof t)throw new Error(`alphabet.decode: not string element=${t}`);const n=e.indexOf(t);if(-1===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n}))}}}function s(e=""){if("string"!=typeof e)throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw new Error("join.decode input should be string");return t.split(e)}}}function o(e,t="="){if(n(e),"string"!=typeof t)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.encode: non-string input=${e}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.decode: non-string input=${e}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function a(e){if("function"!=typeof e)throw new Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function c(e,t,r){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let i=0;const s=[],o=Array.from(e);for(o.forEach((e=>{if(n(e),e<0||e>=t)throw new Error(`Wrong integer: ${e}`)}));;){let e=0,n=!0;for(let s=i;s<o.length;s++){const a=o[s],c=t*e+a;if(!Number.isSafeInteger(c)||t*e/t!==e||c-a!=t*e)throw new Error("convertRadix: carry overflow");if(e=c%r,o[s]=Math.floor(c/r),!Number.isSafeInteger(o[s])||o[s]*r+e!==c)throw new Error("convertRadix: carry overflow");n&&(o[s]?n=!1:i=s)}if(s.push(e),n)break}for(let t=0;t<e.length-1&&0===e[t];t++)s.push(0);return s.reverse()}Object.defineProperty(t,"__esModule",{value:!0}),t.bytes=t.stringToBytes=t.str=t.bytesToString=t.hex=t.utf8=t.bech32m=t.bech32=t.base58check=t.base58xmr=t.base58xrp=t.base58flickr=t.base58=t.base64url=t.base64=t.base32crockford=t.base32hex=t.base32=t.base16=t.utils=t.assertNumber=void 0,t.assertNumber=n;const l=(e,t)=>t?l(t,e%t):e,u=(e,t)=>e+(t-l(e,t));function h(e,t,r,i){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(u(t,r)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${r} carryBits=${u(t,r)}`);let s=0,o=0;const a=2**r-1,c=[];for(const i of e){if(n(i),i>=2**t)throw new Error(`convertRadix2: invalid data word=${i} from=${t}`);if(s=s<<t|i,o+t>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${t}`);for(o+=t;o>=r;o-=r)c.push((s>>o-r&a)>>>0);s&=2**o-1}if(s=s<<r-o&a,!i&&o>=t)throw new Error("Excess padding");if(!i&&s)throw new Error(`Non-zero padding: ${s}`);return i&&o>0&&c.push(s>>>0),c}function d(e){return n(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return c(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(c(t,e,256))}}}function f(e,t=!1){if(n(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(u(8,e)>32||u(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return h(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(h(n,e,8,t))}}}function p(e){if("function"!=typeof e)throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(e){}}}function g(e,t){if(n(e),"function"!=typeof t)throw new Error("checksum fn should be function");return{encode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const r=t(n).slice(0,e),i=new Uint8Array(n.length+e);return i.set(n),i.set(r,n.length),i},decode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const r=n.slice(0,-e),i=t(r).slice(0,e),s=n.slice(-e);for(let t=0;t<e;t++)if(i[t]!==s[t])throw new Error("Invalid checksum");return r}}}t.utils={alphabet:i,chain:r,checksum:g,radix:d,radix2:f,join:s,padding:o},t.base16=r(f(4),i("0123456789ABCDEF"),s("")),t.base32=r(f(5),i("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),s("")),t.base32hex=r(f(5),i("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),s("")),t.base32crockford=r(f(5),i("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),s(""),a((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),t.base64=r(f(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),s("")),t.base64url=r(f(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),s(""));const y=e=>r(d(58),i(e),s(""));t.base58=y("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),t.base58flickr=y("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),t.base58xrp=y("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const w=[0,2,3,5,6,7,9,10,11];t.base58xmr={encode(e){let n="";for(let r=0;r<e.length;r+=8){const i=e.subarray(r,r+8);n+=t.base58.encode(i).padStart(w[i.length],"1")}return n},decode(e){let n=[];for(let r=0;r<e.length;r+=11){const i=e.slice(r,r+11),s=w.indexOf(i.length),o=t.base58.decode(i);for(let e=0;e<o.length-s;e++)if(0!==o[e])throw new Error("base58xmr: wrong padding");n=n.concat(Array.from(o.slice(o.length-s)))}return Uint8Array.from(n)}};t.base58check=e=>r(g(4,(t=>e(e(t)))),t.base58);const m=r(i("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),s("")),b=[996825010,642813549,513874426,1027748829,705979059];function E(e){const t=e>>25;let n=(33554431&e)<<5;for(let e=0;e<b.length;e++)1==(t>>e&1)&&(n^=b[e]);return n}function v(e,t,n=1){const r=e.length;let i=1;for(let t=0;t<r;t++){const n=e.charCodeAt(t);if(n<33||n>126)throw new Error(`Invalid prefix (${e})`);i=E(i)^n>>5}i=E(i);for(let t=0;t<r;t++)i=E(i)^31&e.charCodeAt(t);for(let e of t)i=E(i)^e;for(let e=0;e<6;e++)i=E(i);return i^=n,m.encode(h([i%2**30],30,5,!1))}function I(e){const t="bech32"===e?1:734539939,n=f(5),r=n.decode,i=n.encode,s=p(r);function o(e,n=90){if("string"!=typeof e)throw new Error("bech32.decode input should be string, not "+typeof e);if(e.length<8||!1!==n&&e.length>n)throw new TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${n})`);const r=e.toLowerCase();if(e!==r&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=(e=r).lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const s=e.slice(0,i),o=e.slice(i+1);if(o.length<6)throw new Error("Data must be at least 6 characters long");const a=m.decode(o).slice(0,-6),c=v(s,a,t);if(!o.endsWith(c))throw new Error(`Invalid checksum in ${e}: expected "${c}"`);return{prefix:s,words:a}}return{encode:function(e,n,r=90){if("string"!=typeof e)throw new Error("bech32.encode prefix should be string, not "+typeof e);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const i=e.length+7+n.length;if(!1!==r&&i>r)throw new TypeError(`Length ${i} exceeds limit ${r}`);return`${e=e.toLowerCase()}1${m.encode(n)}${v(e,n,t)}`},decode:o,decodeToBytes:function(e){const{prefix:t,words:n}=o(e,!1);return{prefix:t,words:n,bytes:r(n)}},decodeUnsafe:p(o),fromWords:r,fromWordsUnsafe:s,toWords:i}}t.bech32=I("bech32"),t.bech32m=I("bech32m"),t.utf8={encode:e=>(new TextDecoder).decode(e),decode:e=>(new TextEncoder).encode(e)},t.hex=r(f(4),i("0123456789abcdef"),s(""),a((e=>{if("string"!=typeof e||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})));const A={utf8:t.utf8,hex:t.hex,base16:t.base16,base32:t.base32,base64:t.base64,base64url:t.base64url,base58:t.base58,base58xmr:t.base58xmr},C=`Invalid encoding type. Available types: ${Object.keys(A).join(", ")}`;t.bytesToString=(e,t)=>{if("string"!=typeof e||!A.hasOwnProperty(e))throw new TypeError(C);if(!(t instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return A[e].encode(t)},t.str=t.bytesToString;t.stringToBytes=(e,t)=>{if(!A.hasOwnProperty(e))throw new TypeError(C);if("string"!=typeof t)throw new TypeError("stringToBytes() expects string");return A[e].decode(t)},t.bytes=t.stringToBytes},806:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(601),i=n.n(r),s=n(314),o=n.n(s)()(i());o.push([e.id,'.zap-sender.with-comment {\n  border-radius: 6px 6px 0 0;\n}\n\n/* Color Classes Generator */\n[class*="zap-amount-"] .zap-sender {\n  border-radius: 6px;\n}\n\n[class*="zap-amount-"] .zap-sender.with-comment {\n  border-radius: 6px 6px 0 0;\n}\n\n/* Amount-based Styles */\n.zap-amount-100 .zap-sender { background-color: var(--zap-100); }\n.zap-amount-200 .zap-sender { background-color: var(--zap-200); }\n.zap-amount-500 .zap-sender { background-color: var(--zap-500); }\n.zap-amount-1k .zap-sender { background-color: var(--zap-1k); }\n.zap-amount-2k .zap-sender { background-color: var(--zap-2k); }\n.zap-amount-5k .zap-sender { background-color: var(--zap-5k); }\n.zap-amount-10k .zap-sender { background-color: var(--zap-10k); }\n\n/* Details Background Colors */\n.zap-amount-100 .zap-details { background-color: var(--zap-100-light); }\n.zap-amount-200 .zap-details { background-color: var(--zap-200-light); }\n.zap-amount-500 .zap-details { background-color: var(--zap-500-light); }\n.zap-amount-1k .zap-details { background-color: var(--zap-1k-light); }\n.zap-amount-2k .zap-details { background-color: var(--zap-2k-light); }\n.zap-amount-5k .zap-details { background-color: var(--zap-5k-light); }\n.zap-amount-10k .zap-details { background-color: var(--zap-10k-light); }\n\n/* Dark Text Colors */\n.zap-amount-100, .zap-amount-2k, .zap-amount-5k, .zap-amount-10k {\n  .zap-amount { color: var(--text-light); }\n  .sender-name { color: var(--text-light-secondary); }\n  .sender-pubkey { color: var(--text-light-tertiary); }\n  .zap-comment { color: var(--text-light); }\n}\n\n/* Light Text Colors */\n.zap-amount-200, .zap-amount-500, .zap-amount-1k {\n  .zap-amount { color: var(--text-dark); }\n  .sender-name { color: var(--text-dark-secondary); }\n  .sender-pubkey { color: var(--text-dark-tertiary); }\n  .zap-comment { color: var(--text-dark); }\n}\n',""]);const a=o},540:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(806),c=o()(i());c.i(a.A),c.push([e.id,'/* styles.css */\n\n:host {\n  --main-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,\n    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;\n  --main-text: Black;\n  --pubkey-text: #888;\n  --tite-text: #555;\n  --stats-item-text: #333;\n  --name-text: #444;\n  --dialog-bg: #ffffff;\n  --zap-stats-bg: #edf2f7;\n  --hover-bg: #edf2f7;\n  --border: #edf2f7;\n  --skeleton: #fdfdfd;\n  --skeleton2: #e2e5ec;\n  --zap-stats-skeleton-bg: #bbc5cf;\n  --new-mark: #22c55e;\n\n  /* Zap Amount Colors */\n  --zap-100: #1565c0;\n  --zap-200: #00b8d4;\n  --zap-500: #00bfa5;\n  --zap-1k: #ffb300;\n  --zap-2k: #e65100;\n  --zap-5k: #c2185b;\n  --zap-10k: #d00000;\n\n  /* Light Variants */\n  --zap-100-light: #1e88e5;\n  --zap-200-light: #00e5ff;\n  --zap-500-light: #1de9b6;\n  --zap-1k-light: #ffca28;\n  --zap-2k-light: #f57c00;\n  --zap-5k-light: #e91e63;\n  --zap-10k-light: #e62117;\n\n  /* Text Colors */\n  --text-light: #ffffff;\n  --text-light-secondary: rgba(255, 255, 255, 0.9);\n  --text-light-tertiary: rgba(255, 255, 255, 0.5);\n  --text-dark: #000000;\n  --text-dark-secondary: rgba(0, 0, 0, 0.7);\n  --text-dark-tertiary: rgba(0, 0, 0, 0.5);\n}\n\n* {\n  box-sizing: border-box;\n}\n\nbutton {\n  color: var(--main-text);\n  background: none;\n  border: none;\n  cursor: pointer;\n}\n\n.dialog {\n  font-family: var(--main-font);\n  color: var(--main-text);\n  font-size: medium;\n  font-weight: normal;\n  max-height: 700px;\n  height: 100dvh;\n  width: 360px;\n  margin: auto;\n  padding: 0;\n  border: none;\n  border-radius: 10px;\n  background: var(--dialog-bg);\n  display: flex;\n  flex-direction: column;\n}\n\n.close-dialog-button {\n  font-size: 16px;\n  font-weight: 500;\n  position: absolute;\n  top: 3px;\n  right: 3px;\n  width: 36px;\n  height: 36px;\n  border: none;\n  border-radius: 50%;\n  background: none;\n  cursor: pointer;\n  padding: 10px;\n  text-align: center;\n}\n\n.close-dialog-button:hover {\n  background-color: var(--hover-bg);\n}\n\n.dialog-title {\n  height: 42px;\n  margin: 0;\n  padding: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  & a {\n    font-size: 0.9rem;\n    font-weight: normal;\n    color: var(--pubkey-text);\n    text-decoration: none;\n    cursor: pointer;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    display: inline-block;\n  }\n\n  & a:hover {\n    text-decoration: underline;\n  }\n}\n\n.dialog-title.custom-title a {\n  color: var(--tite-text);\n  font-weight: 600;\n  font-size: 1rem;\n}\n\n.zap-stats {\n  min-height: 80px;\n  padding: 6px 14px;\n  background: var(--zap-stats-bg);\n  border-radius: 6px;\n  display: grid;\n  grid-template-columns: 90px 1fr 40px;\n  grid-template-rows: repeat(3, 1fr);\n  gap: 4px;\n  margin: 0 8px;\n\n  .stats-item {\n    height: 23px;\n    color: var(--stats-item-text);\n    font-size: 0.9rem;\n  \n    .number {\n      font-size: 1.1rem;\n      font-weight: 500;\n    }\n  \n    .number.skeleton {\n      width: 100%;\n      background: linear-gradient(\n        90deg,\n        var(--skeleton) 0%,\n        var(--zap-stats-skeleton-bg) 50%,\n        var(--skeleton) 100%\n      );\n      background-size: 200% 100%;\n    }\n  }\n}\n\n.stats-item:nth-child(3n + 1) {\n  justify-content: flex-start;\n}\n\n.stats-item:nth-child(3n + 2),\n.stats-item:nth-child(3n + 3) {\n  justify-content: flex-end;\n}\n\n.text-muted {\n  margin-right: 16px;\n  opacity: 0.4;\n}\n\n.dialog-zap-list {\n  list-style-type: none;\n  margin: 10px 0;\n  padding: 0 6px;\n  flex: 1;\n  overflow-y: auto;\n  overscroll-behavior: contain;\n  scroll-behavior: smooth;\n\n  /* スクロールバーのスタイリング */\n  &::-webkit-scrollbar {\n    width: 6px;\n    height: 6px;\n  }\n\n  &::-webkit-scrollbar-track {\n    background: transparent;\n    border-radius: 3px;\n  }\n\n  &::-webkit-scrollbar-thumb {\n    background: rgba(0, 0, 0, 0.1);\n    border-radius: 3px;\n    transition: background 0.2s;\n  }\n\n  &::-webkit-scrollbar-thumb:hover {\n    background: rgba(0, 0, 0, 0.2);\n  }\n\n  /* Firefox用のスクロールバースタイル */\n  scrollbar-width: thin;\n  scrollbar-color: rgba(0, 0, 0, 0.1) transparent;\n}\n\n.zap-list-item {\n  display: flex;\n  flex-direction: column;\n  border-top: 1px solid var(--border);\n  padding: 2px 0;\n}\n\n.zap-content {\n  display: flex;\n  flex-direction: column;\n}\n\n.reference-container {\n  display: flex;\n  flex-direction: column;\n}\n\n.zap-sender {\n  gap: 12px;\n  height: 46px;\n  justify-content: space-between;\n  padding: 6px;\n}\n\n.sender-icon {\n  flex-shrink: 0;\n\n  & img {\n    width: 100%;\n    height: 100%;\n    border-radius: 4px;\n    object-fit: cover;\n    object-position: center;\n  }\n}\n\n.sender-icon.is-new::before {\n  content: "";\n  position: absolute;\n  top: -4px;\n  left: -4px;\n  width: 8px;\n  height: 8px;\n  background-color: var(--new-mark);\n  border: 1px solid #fff;\n  border-radius: 50%;\n  z-index: 1;\n  animation: pulse 2500ms cubic-bezier(0.4, 0, 0.6, 1) infinite;\n}\n\n@keyframes pulse {\n  50% {\n    opacity: 0.3;\n  }\n}\n\n.sender-info {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  overflow: hidden;\n  min-width: 0;\n}\n\n.sender-name {\n  font-size: 0.9375rem;\n  font-weight: bold;\n  color: var(--name-text);\n}\n\n.sender-pubkey {\n  font-size: 0.625rem;\n  color: var(--pubkey-text);\n  margin-top: -1px;\n}\n\n.zap-amount {\n  font-size: 0.8rem;\n  white-space: nowrap;\n  flex-shrink: 0;\n\n  .number {\n    font-size: 1.4rem;\n    font-weight: 500;\n    text-align: right;\n  }\n}\n\n.zap-details {\n  padding: 2px 0 4px 50px;\n  border-radius: 0 0 6px 6px;\n  margin: 0;\n}\n\n.zap-comment {\n  font-size: 0.9375rem;\n  margin: 2px 0;\n  white-space: pre-wrap;\n  overflow-wrap: break-word;\n  max-width: 100%;\n}\n\n.no-zaps-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100%;\n  width: 100%;\n}\n\n.no-zaps-message {\n  text-align: center;\n  color: var(--pubkey-text);\n  font-size: 1.8rem;\n  font-weight: 700;\n}\n\n.zap-reference {\n  padding: 0 0 2px 50px;\n  margin: 0;\n  font-size: 0.875rem;\n  color: var(--pubkey-text);\n}\n\n.reference-icon {\n  margin-right: 4px;\n}\n\n.reference-content {\n  justify-content: space-between;\n  flex: 1;\n  min-width: 0;\n}\n\n.reference-text {\n  font-size: 0.75rem;\n  margin: 2px 0;\n}\n\n.reference-link {\n  color: var(--pubkey-text);\n  margin-left: 6px;\n  padding-left: 6px;\n  text-decoration: none;\n  border-left: 1px solid var(--border);\n}\n\n.zap-placeholder-name {\n  height: 30px;\n  width: 140px;\n}\n\n.zap-placeholder-name.skeleton {\n  width: 120px;\n  height: 19px;\n  margin: 2px 0;\n}\n\n.skeleton {\n  color: transparent;\n  border-radius: 2px;\n  background: linear-gradient(\n    90deg,\n    var(--skeleton) 0%,\n    var(--skeleton2) 50%,\n    var(--skeleton) 100%\n  );\n  background-size: 200% 100%;\n  animation: loading-animation 3.5s infinite;\n  opacity: 0.7;\n}\n\n@keyframes loading-animation {\n  0% {\n    background-position: 200% 0;\n  }\n  100% {\n    background-position: -200% 0;\n  }\n}\n\n/* 共通のテキストオーバーフロー処理 */\n.dialog-title,\n.sender-name,\n.sender-pubkey,\n.reference-text {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n/* 共通のフレックスボックス設定 */\n.zap-sender,\n.stats-item,\n.zap-details,\n.reference-content,\n.reference-link,\n.zap-reference {\n  display: flex;\n  align-items: center;\n}\n\n/* 共通のアイコンサイズ */\n.zap-placeholder-icon,\n.sender-icon {\n  width: 32px;\n  height: 32px;\n  border-radius: 4px;\n  position: relative;\n}\n\n/* 共通のリファレンス画像サイズ */\n.reference-icon img,\n.reference-link img {\n  height: 16px;\n  width: auto;\n}\n\n.load-more-trigger {\n  height: 40px;\n  margin: 10px 0;\n  padding: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.loading-spinner {\n  width: 24px;\n  height: 24px;\n  border: 3px solid var(--zap-stats-bg);\n  border-top: 3px solid var(--pubkey-text);\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n',""]);const l=c},314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,i,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var l=0;l<e.length;l++){var u=[].concat(e[l]);r&&o[u[0]]||(void 0!==s&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=s),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),i&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=i):u[4]="".concat(i)),t.push(u))}},t}},601:e=>{"use strict";e.exports=function(e){return e[1]}},705:(e,t,n)=>{const{bech32:r,hex:i,utf8:s}=n(203),o={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},a={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},l={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},u={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},h=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],d={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},f=BigInt("2100000000000000000"),p=BigInt(1e11),g={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},y={};for(let e=0,t=Object.keys(g);e<t.length;e++){const n=t[e],r=g[t[e]].toString();y[r]=n}const w={1:e=>i.encode(r.fromWordsUnsafe(e)),16:e=>i.encode(r.fromWordsUnsafe(e)),13:e=>s.encode(r.fromWordsUnsafe(e)),19:e=>i.encode(r.fromWordsUnsafe(e)),23:e=>i.encode(r.fromWordsUnsafe(e)),27:e=>i.encode(r.fromWordsUnsafe(e)),6:b,24:b,3:function(e){const t=[];let n,s,o,a,c,l=r.fromWordsUnsafe(e);for(;l.length>0;)n=i.encode(l.slice(0,33)),s=i.encode(l.slice(33,41)),o=parseInt(i.encode(l.slice(41,45)),16),a=parseInt(i.encode(l.slice(45,49)),16),c=parseInt(i.encode(l.slice(49,51)),16),l=l.slice(51),t.push({pubkey:n,short_channel_id:s,fee_base_msat:o,fee_proportional_millionths:a,cltv_expiry_delta:c});return t},5:function(e){const t=e.slice().reverse().map((e=>[!!(1&e),!!(2&e),!!(4&e),!!(8&e),!!(16&e)])).reduce(((e,t)=>e.concat(t)),[]);for(;t.length<2*h.length;)t.push(!1);const n={};h.forEach(((e,r)=>{let i;i=t[2*r]?"required":t[2*r+1]?"supported":"unsupported",n[e]=i}));const r=t.slice(2*h.length);return n.extra_bits={start_bit:2*h.length,bits:r,has_required:r.reduce(((e,t,n)=>n%2!=0?e||!1:e||t),!1)},n}};function m(e){return t=>({tagCode:parseInt(e),words:r.encode("unknown",t,Number.MAX_SAFE_INTEGER)})}function b(e){return e.reverse().reduce(((e,t,n)=>e+t*Math.pow(32,n)),0)}function E(e,t){let n,r;if(e.slice(-1).match(/^[munp]$/))n=e.slice(-1),r=e.slice(0,-1);else{if(e.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");r=e}if(!r.match(/^\d+$/))throw new Error("Not a valid human readable amount");const i=BigInt(r),s=n?i*p/d[n]:i*p;if("p"===n&&i%BigInt(10)!==BigInt(0)||s>f)throw new Error("Amount is outside of valid range");return t?s.toString():s}e.exports={decode:function(e,t){if("string"!=typeof e)throw new Error("Lightning Payment Request must be string");if("ln"!==e.slice(0,2).toLowerCase())throw new Error("Not a proper lightning payment request");const n=[],s=r.decode(e,Number.MAX_SAFE_INTEGER);e=e.toLowerCase();const h=s.prefix;let d=s.words,f=e.slice(h.length+1),p=d.slice(-104);d=d.slice(0,-104);let v=h.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(v&&!v[2]&&(v=h.match(/^ln(\S+)$/)),!v)throw new Error("Not a proper lightning payment request");n.push({name:"lightning_network",letters:"ln"});const I=v[1];let A;if(t){if(void 0===t.bech32||void 0===t.pubKeyHash||void 0===t.scriptHash||!Array.isArray(t.validWitnessVersions))throw new Error("Invalid network");A=t}else switch(I){case o.bech32:A=o;break;case a.bech32:A=a;break;case c.bech32:A=c;break;case l.bech32:A=l;break;case u.bech32:A=u}if(!A||A.bech32!==I)throw new Error("Unknown coin bech32 prefix");n.push({name:"coin_network",letters:I,value:A});const C=v[2];let x;if(C){x=E(C+v[3],!0),n.push({name:"amount",letters:v[2]+v[3],value:x})}else x=null;n.push({name:"separator",letters:"1"});const S=b(d.slice(0,7));let T,L,k,_;for(d=d.slice(7),n.push({name:"timestamp",letters:f.slice(0,7),value:S}),f=f.slice(7);d.length>0;){const e=d[0].toString();T=y[e]||"unknown_tag",L=w[e]||m(e),d=d.slice(1),k=b(d.slice(0,2)),d=d.slice(2),_=d.slice(0,k),d=d.slice(k),n.push({name:T,tag:f[0],letters:f.slice(0,3+k),value:L(_)}),f=f.slice(3+k)}n.push({name:"signature",letters:f.slice(0,104),value:i.encode(r.fromWordsUnsafe(p))}),f=f.slice(104),n.push({name:"checksum",letters:f});let N={paymentRequest:e,sections:n,get expiry(){let e=n.find((e=>"expiry"===e.name));if(e)return M("timestamp")+e.value},get route_hints(){return n.filter((e=>"route_hint"===e.name)).map((e=>e.value))}};for(let e in g)"route_hint"!==e&&Object.defineProperty(N,e,{get:()=>M(e)});return N;function M(e){let t=n.find((t=>t.name===e));return t?t.value:void 0}},hrpToMillisat:E}},0:(e,t,n)=>{var r=n(540);r&&r.__esModule&&(r=r.default),e.exports="string"==typeof r?r:r.toString()}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={id:r,exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r),n.d(r,{nostrZapView:()=>Qc});var e={};n.r(e),n.d(e,{OG:()=>D,My:()=>k,Ph:()=>M,lX:()=>z,Id:()=>P,fg:()=>F,qj:()=>R,aT:()=>N,lq:()=>O,z:()=>U,Q5:()=>$});var t={};n.r(t),n.d(t,{Relay:()=>Ls,SimplePool:()=>_s,finalizeEvent:()=>Nr,fj:()=>fs,generateSecretKey:()=>kr,getEventHash:()=>Tr,getFilterLimit:()=>ds,getPublicKey:()=>_r,kinds:()=>zr,matchFilter:()=>ls,matchFilters:()=>us,mergeFilters:()=>hs,nip04:()=>Ws,nip05:()=>Js,nip10:()=>oo,nip11:()=>co,nip13:()=>ho,nip18:()=>yo,nip19:()=>Ns,nip21:()=>Eo,nip25:()=>Co,nip27:()=>To,nip28:()=>No,nip30:()=>Po,nip39:()=>$o,nip42:()=>Es,nip44:()=>Vo,nip47:()=>ra,nip57:()=>aa,nip59:()=>fa,nip98:()=>Sa,parseReferences:()=>Gs,serializeEvent:()=>Sr,sortEvents:()=>yr,utils:()=>wr,validateEvent:()=>gr,verifiedSymbol:()=>fr,verifyEvent:()=>Mr});var i=n(705);function s(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function o(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function a(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");s(e.outputLen),s(e.blockLen)}function c(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function l(e,t){o(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const u="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,h=e=>e instanceof Uint8Array,d=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),f=(e,t)=>e<<32-t|e>>>t;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function p(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!h(e))throw new Error("expected Uint8Array, got "+typeof e);return e}class g{clone(){return this._cloneInto()}}function y(e){const t=t=>e().update(p(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function w(e=32){if(u&&"function"==typeof u.getRandomValues)return u.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}class m extends g{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=d(this.buffer)}update(e){c(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=p(e)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=d(e);for(;r<=i-s;s+=r)this.process(t,s)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){c(this),l(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let e=s;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const o=d(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=a/4,h=this.get();if(u>h.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<u;e++)o.setUint32(4*e,h[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:s,pos:o}=this;return e.length=r,e.pos=o,e.finished=i,e.destroyed=s,r%t&&e.buffer.set(n),e}}const b=(e,t,n)=>e&t^e&n^t&n,E=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),v=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),I=new Uint32Array(64);class A extends m{constructor(){super(64,32,8,!1),this.A=0|v[0],this.B=0|v[1],this.C=0|v[2],this.D=0|v[3],this.E=0|v[4],this.F=0|v[5],this.G=0|v[6],this.H=0|v[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:s,G:o,H:a}=this;return[e,t,n,r,i,s,o,a]}set(e,t,n,r,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)I[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=I[e-15],n=I[e-2],r=f(t,7)^f(t,18)^t>>>3,i=f(n,17)^f(n,19)^n>>>10;I[e]=i+I[e-7]+r+I[e-16]|0}let{A:n,B:r,C:i,D:s,E:o,F:a,G:c,H:l}=this;for(let e=0;e<64;e++){const t=l+(f(o,6)^f(o,11)^f(o,25))+((u=o)&a^~u&c)+E[e]+I[e]|0,h=(f(n,2)^f(n,13)^f(n,22))+b(n,r,i)|0;l=c,c=a,a=o,o=s+t|0,s=i,i=r,r=n,n=t+h|0}var u;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,i,s,o,a,c,l)}roundClean(){I.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const C=y((()=>new A)),x=(BigInt(0),BigInt(1)),S=BigInt(2),T=e=>e instanceof Uint8Array,L=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function k(e){if(!T(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=L[e[n]];return t}function _(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}function N(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let t=0;t<n.length;t++){const r=2*t,i=e.slice(r,r+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[t]=s}return n}function M(e){return _(k(e))}function z(e){if(!T(e))throw new Error("Uint8Array expected");return _(k(Uint8Array.from(e).reverse()))}function O(e,t){return N(e.toString(16).padStart(2*t,"0"))}function U(e,t){return O(e,t).reverse()}function R(e,t,n){let r;if("string"==typeof t)try{r=N(t)}catch(n){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${n}`)}else{if(!T(t))throw new Error(`${e} must be hex string or Uint8Array`);r=Uint8Array.from(t)}const i=r.length;if("number"==typeof n&&i!==n)throw new Error(`${e} expected ${n} bytes, got ${i}`);return r}function P(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!T(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}const D=e=>(S<<BigInt(e-1))-x,B=e=>new Uint8Array(e),j=e=>Uint8Array.from(e);function F(e,t,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=B(e),i=B(e),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...e)=>n(i,r,...e),c=(e=B())=>{i=a(j([0]),e),r=a(),0!==e.length&&(i=a(j([1]),e),r=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=a();const t=r.slice();n.push(t),e+=r.length}return P(...n)};return(e,t)=>{let n;for(o(),c(e);!(n=t(l()));)c();return o(),n}}const H={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function $(e,t,n={}){const r=(t,n,r)=>{const i=H[n];if("function"!=typeof i)throw new Error(`Invalid validator "${n}", expected function`);const s=e[t];if(!(r&&void 0===s||i(s,e)))throw new Error(`Invalid param ${String(t)}=${s} (${typeof s}), expected ${n}`)};for(const[e,n]of Object.entries(t))r(e,n,!1);for(const[e,t]of Object.entries(n))r(e,t,!0);return e}const Z=BigInt(0),q=BigInt(1),V=BigInt(2),G=BigInt(3),W=BigInt(4),Y=BigInt(5),K=BigInt(8);BigInt(9),BigInt(16);function Q(e,t){const n=e%t;return n>=Z?n:t+n}function J(e,t,n){if(n<=Z||t<Z)throw new Error("Expected power/modulo > 0");if(n===q)return Z;let r=q;for(;t>Z;)t&q&&(r=r*e%n),e=e*e%n,t>>=q;return r}function X(e,t,n){let r=e;for(;t-- >Z;)r*=r,r%=n;return r}function ee(e,t){if(e===Z||t<=Z)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=Q(e,t),r=t,i=Z,s=q,o=q,a=Z;for(;n!==Z;){const e=r/n,t=r%n,c=i-o*e,l=s-a*e;r=n,n=t,i=o,s=a,o=c,a=l}if(r!==q)throw new Error("invert: does not exist");return Q(i,t)}function te(e){if(e%W===G){const t=(e+q)/W;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%K===Y){const t=(e-Y)/K;return function(e,n){const r=e.mul(n,V),i=e.pow(r,t),s=e.mul(n,i),o=e.mul(e.mul(s,V),i),a=e.mul(s,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(e){const t=(e-q)/V;let n,r,i;for(n=e-q,r=0;n%V===Z;n/=V,r++);for(i=V;i<e&&J(i,t,e)!==e-q;i++);if(1===r){const t=(e+q)/W;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const s=(n+q)/V;return function(e,o){if(e.pow(o,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,c=e.pow(e.mul(e.ONE,i),n),l=e.pow(o,s),u=e.pow(o,n);for(;!e.eql(u,e.ONE);){if(e.eql(u,e.ZERO))return e.ZERO;let t=1;for(let n=e.sqr(u);t<a&&!e.eql(n,e.ONE);t++)n=e.sqr(n);const n=e.pow(c,q<<BigInt(a-t-1));c=e.sqr(n),l=e.mul(l,n),u=e.mul(u,c),a=t}return l}}(e)}const ne=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function re(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function ie(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function se(e){const t=ie(e);return t+Math.ceil(t/2)}class oe extends g{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,a(e);const n=p(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return c(this),this.iHash.update(e),this}digestInto(e){c(this),o(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=r,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ae=(e,t,n)=>new oe(e,t).update(n).digest();ae.create=(e,t)=>new oe(e,t);const ce=BigInt(0),le=BigInt(1);function ue(e){return $(e.Fp,ne.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),$(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...re(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const{Ph:he,aT:de}=e,fe={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:t}=fe;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:he(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=fe,n="string"==typeof e?de(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:i,l:s}=fe._parseInt(n.subarray(2)),{d:o,l:a}=fe._parseInt(s);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,n=e=>{const t=e.toString(16);return 1&t.length?`0${t}`:t},r=t(n(e.s)),i=t(n(e.r)),s=r.length/2,o=i.length/2,a=n(s),c=n(o);return`30${n(o+s+4)}02${c}${i}02${a}${r}`}},pe=BigInt(0),ge=BigInt(1),ye=(BigInt(2),BigInt(3));BigInt(4);function we(e){const t=function(e){const t=ue(e);$(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=t.toBytes||((e,t,r)=>{const i=t.toAffine();return P(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),i=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function s(e){const{a:r,b:i}=t,s=n.sqr(e),o=n.mul(s,e);return n.add(n.add(o,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function o(e){return"bigint"==typeof e&&pe<e&&e<t.n}function a(e){if(!o(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:s}=t;if(n&&"bigint"!=typeof e){if(e instanceof Uint8Array&&(e=k(e)),"string"!=typeof e||!n.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*r,"0")}let o;try{o="bigint"==typeof e?e:M(R("private key",e,r))}catch(t){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof e}`)}return i&&(o=Q(o,s)),a(o),o}const l=new Map;function u(e){if(!(e instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof h)throw new Error("projective point not allowed");const i=e=>n.eql(e,n.ZERO);return i(t)&&i(r)?h.ZERO:new h(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(h.fromAffine)}static fromHex(e){const t=h.fromAffine(i(R("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return h.BASE.multiply(c(e))}_setWindowSize(e){this._WINDOW_SIZE=e,l.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:e,y:r}=this.toAffine();if(!n.isValid(e)||!n.isValid(r))throw new Error("bad point: x or y not FE");const i=n.sqr(r),o=s(e);if(!n.eql(i,o))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){u(e);const{px:t,py:r,pz:i}=this,{px:s,py:o,pz:a}=e,c=n.eql(n.mul(t,a),n.mul(s,i)),l=n.eql(n.mul(r,a),n.mul(o,i));return c&&l}negate(){return new h(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,i=n.mul(r,ye),{px:s,py:o,pz:a}=this;let c=n.ZERO,l=n.ZERO,u=n.ZERO,d=n.mul(s,s),f=n.mul(o,o),p=n.mul(a,a),g=n.mul(s,o);return g=n.add(g,g),u=n.mul(s,a),u=n.add(u,u),c=n.mul(e,u),l=n.mul(i,p),l=n.add(c,l),c=n.sub(f,l),l=n.add(f,l),l=n.mul(c,l),c=n.mul(g,c),u=n.mul(i,u),p=n.mul(e,p),g=n.sub(d,p),g=n.mul(e,g),g=n.add(g,u),u=n.add(d,d),d=n.add(u,d),d=n.add(d,p),d=n.mul(d,g),l=n.add(l,d),p=n.mul(o,a),p=n.add(p,p),d=n.mul(p,g),c=n.sub(c,d),u=n.mul(p,f),u=n.add(u,u),u=n.add(u,u),new h(c,l,u)}add(e){u(e);const{px:r,py:i,pz:s}=this,{px:o,py:a,pz:c}=e;let l=n.ZERO,d=n.ZERO,f=n.ZERO;const p=t.a,g=n.mul(t.b,ye);let y=n.mul(r,o),w=n.mul(i,a),m=n.mul(s,c),b=n.add(r,i),E=n.add(o,a);b=n.mul(b,E),E=n.add(y,w),b=n.sub(b,E),E=n.add(r,s);let v=n.add(o,c);return E=n.mul(E,v),v=n.add(y,m),E=n.sub(E,v),v=n.add(i,s),l=n.add(a,c),v=n.mul(v,l),l=n.add(w,m),v=n.sub(v,l),f=n.mul(p,E),l=n.mul(g,m),f=n.add(l,f),l=n.sub(w,f),f=n.add(w,f),d=n.mul(l,f),w=n.add(y,y),w=n.add(w,y),m=n.mul(p,m),E=n.mul(g,E),w=n.add(w,m),m=n.sub(y,m),m=n.mul(p,m),E=n.add(E,m),y=n.mul(w,E),d=n.add(d,y),y=n.mul(v,E),l=n.mul(b,l),l=n.sub(l,y),y=n.mul(b,w),f=n.mul(v,f),f=n.add(f,y),new h(l,d,f)}subtract(e){return this.add(e.negate())}is0(){return this.equals(h.ZERO)}wNAF(e){return f.wNAFCached(this,l,e,(e=>{const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(h.fromAffine)}))}multiplyUnsafe(e){const r=h.ZERO;if(e===pe)return r;if(a(e),e===ge)return this;const{endo:i}=t;if(!i)return f.unsafeLadder(this,e);let{k1neg:s,k1:o,k2neg:c,k2:l}=i.splitScalar(e),u=r,d=r,p=this;for(;o>pe||l>pe;)o&ge&&(u=u.add(p)),l&ge&&(d=d.add(p)),p=p.double(),o>>=ge,l>>=ge;return s&&(u=u.negate()),c&&(d=d.negate()),d=new h(n.mul(d.px,i.beta),d.py,d.pz),u.add(d)}multiply(e){a(e);let r,i,s=e;const{endo:o}=t;if(o){const{k1neg:e,k1:t,k2neg:a,k2:c}=o.splitScalar(s);let{p:l,f:u}=this.wNAF(t),{p:d,f:p}=this.wNAF(c);l=f.constTimeNegate(e,l),d=f.constTimeNegate(a,d),d=new h(n.mul(d.px,o.beta),d.py,d.pz),r=l.add(d),i=u.add(p)}else{const{p:e,f:t}=this.wNAF(s);r=e,i=t}return h.normalizeZ([r,i])[0]}multiplyAndAddUnsafe(e,t,n){const r=h.BASE,i=(e,t)=>t!==pe&&t!==ge&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),s=i(this,t).add(i(e,n));return s.is0()?void 0:s}toAffine(e){const{px:t,py:r,pz:i}=this,s=this.is0();null==e&&(e=s?n.ONE:n.inv(i));const o=n.mul(t,e),a=n.mul(r,e),c=n.mul(i,e);if(s)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:o,y:a}}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===ge)return!0;if(n)return n(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===ge?this:n?n(h,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),r(h,this,e)}toHex(e=!0){return k(this.toRawBytes(e))}}h.BASE=new h(t.Gx,t.Gy,n.ONE),h.ZERO=new h(n.ZERO,n.ONE,n.ZERO);const d=t.nBitLength,f=function(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,i=t;for(;n>ce;)n&le&&(r=r.add(i)),i=i.double(),n>>=le;return r},precomputeWindow(e,t){const{windows:n,windowSize:i}=r(t),s=[];let o=e,a=o;for(let e=0;e<n;e++){a=o,s.push(a);for(let e=1;e<i;e++)a=a.add(o),s.push(a);o=a.double()}return s},wNAF(t,i,s){const{windows:o,windowSize:a}=r(t);let c=e.ZERO,l=e.BASE;const u=BigInt(2**t-1),h=2**t,d=BigInt(t);for(let e=0;e<o;e++){const t=e*a;let r=Number(s&u);s>>=d,r>a&&(r-=h,s+=le);const o=t,f=t+Math.abs(r)-1,p=e%2!=0,g=r<0;0===r?l=l.add(n(p,i[o])):c=c.add(n(g,i[f]))}return{p:c,f:l}},wNAFCached(e,t,n,r){const i=e._WINDOW_SIZE||1;let s=t.get(e);return s||(s=this.precomputeWindow(e,i),1!==i&&t.set(e,r(s))),this.wNAF(i,s,n)}}}(h,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:h,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:o}}function me(e){const t=function(e){const t=ue(e);return $(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,i=n.BYTES+1,s=2*n.BYTES+1;function o(e){return Q(e,r)}function a(e){return ee(e,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:h}=we({...t,toBytes(e,t,r){const i=t.toAffine(),s=n.toBytes(i.x),o=P;return r?o(Uint8Array.from([t.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,n.toBytes(i.y))},fromBytes(e){const t=e.length,r=e[0],o=e.subarray(1);if(t!==i||2!==r&&3!==r){if(t===s&&4===r){return{x:n.fromBytes(o.subarray(0,n.BYTES)),y:n.fromBytes(o.subarray(n.BYTES,2*n.BYTES))}}throw new Error(`Point of length ${t} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}{const e=M(o);if(!(pe<(a=e)&&a<n.ORDER))throw new Error("Point is not on curve");const t=u(e);let i=n.sqrt(t);return!(1&~r)!==((i&ge)===ge)&&(i=n.neg(i)),{x:e,y:i}}var a}}),d=e=>k(O(e,t.nByteLength));function f(e){return e>r>>ge}const p=(e,t,n)=>M(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=R("compactSignature",e,2*n),new g(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=fe.toSig(R("DER",e));return new g(t,n)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r,s:i,recovery:s}=this,l=b(R("msgHash",e));if(null==s||![0,1,2,3].includes(s))throw new Error("recovery id invalid");const u=2===s||3===s?r+t.n:r;if(u>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const h=1&s?"03":"02",f=c.fromHex(h+d(u)),p=a(u),g=o(-l*p),y=o(i*p),w=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!w)throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return N(this.toDERHex())}toDERHex(){return fe.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return N(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(e){try{return l(e),!0}catch(e){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const e=se(t.n);return function(e,t,n=!1){const r=e.length,i=ie(t),s=se(t);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=Q(n?M(e):z(e),t-q)+q;return n?U(o,i):O(o,i)}(t.randomBytes(e),t.n)},precompute:(e=8,t=c.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function w(e){const t=e instanceof Uint8Array,n="string"==typeof e,r=(t||n)&&e.length;return t?r===i||r===s:n?r===2*i||r===2*s:e instanceof c}const m=t.bits2int||function(e){const n=M(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},b=t.bits2int_modN||function(e){return o(m(e))},E=D(t.nBitLength);function v(e){if("bigint"!=typeof e)throw new Error("bigint expected");if(!(pe<=e&&e<E))throw new Error(`bigint expected < 2^${t.nBitLength}`);return O(e,t.nByteLength)}function I(e,r,i=A){if(["recovered","canonical"].some((e=>e in i)))throw new Error("sign() legacy options not supported");const{hash:s,randomBytes:u}=t;let{lowS:d,prehash:p,extraEntropy:y}=i;null==d&&(d=!0),e=R("msgHash",e),p&&(e=R("prehashed msgHash",s(e)));const w=b(e),E=l(r),I=[v(E),v(w)];if(null!=y){const e=!0===y?u(n.BYTES):y;I.push(R("extraEntropy",e))}const C=P(...I),x=w;return{seed:C,k2sig:function(e){const t=m(e);if(!h(t))return;const n=a(t),r=c.BASE.multiply(t).toAffine(),i=o(r.x);if(i===pe)return;const s=o(n*o(x+i*E));if(s===pe)return;let l=(r.x===i?0:2)|Number(r.y&ge),u=s;return d&&f(s)&&(u=function(e){return f(e)?o(-e):e}(s),l^=1),new g(i,u,l)}}}const A={lowS:t.lowS,prehash:!1},C={lowS:t.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return c.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,n=!0){if(w(e))throw new Error("first arg must be private key");if(!w(t))throw new Error("second arg must be public key");return c.fromHex(t).multiply(l(e)).toRawBytes(n)},sign:function(e,n,r=A){const{seed:i,k2sig:s}=I(e,n,r),o=t;return F(o.hash.outputLen,o.nByteLength,o.hmac)(i,s)},verify:function(e,n,r,i=C){const s=e;if(n=R("msgHash",n),r=R("publicKey",r),"strict"in i)throw new Error("options.strict was renamed to lowS");const{lowS:l,prehash:u}=i;let h,d;try{if("string"==typeof s||s instanceof Uint8Array)try{h=g.fromDER(s)}catch(e){if(!(e instanceof fe.Err))throw e;h=g.fromCompact(s)}else{if("object"!=typeof s||"bigint"!=typeof s.r||"bigint"!=typeof s.s)throw new Error("PARSE");{const{r:e,s:t}=s;h=new g(e,t)}}d=c.fromHex(r)}catch(e){if("PARSE"===e.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(l&&h.hasHighS())return!1;u&&(n=t.hash(n));const{r:f,s:p}=h,y=b(n),w=a(p),m=o(y*w),E=o(f*w),v=c.BASE.multiplyAndAddUnsafe(d,m,E)?.toAffine();return!!v&&o(v.x)===f},ProjectivePoint:c,Signature:g,utils:y}}function be(e){return{hash:e,hmac:(t,...n)=>ae(e,t,function(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!h(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}(...n)),randomBytes:w}}const Ee=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),ve=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Ie=BigInt(1),Ae=BigInt(2),Ce=(e,t)=>(e+t/Ae)/t;function xe(e){const t=Ee,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=e*e*e%t,u=l*l*e%t,h=X(u,n,t)*u%t,d=X(h,n,t)*u%t,f=X(d,Ae,t)*l%t,p=X(f,i,t)*f%t,g=X(p,s,t)*p%t,y=X(g,a,t)*g%t,w=X(y,c,t)*y%t,m=X(w,a,t)*g%t,b=X(m,n,t)*u%t,E=X(b,o,t)*p%t,v=X(E,r,t)*l%t,I=X(v,Ae,t);if(!Se.eql(Se.sqr(I),e))throw new Error("Cannot find square root");return I}const Se=function(e,t,n=!1,r={}){if(e<=Z)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:i,nByteLength:s}=re(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=te(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:s,MASK:D(i),ZERO:Z,ONE:q,create:t=>Q(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return Z<=t&&t<e},is0:e=>e===Z,isOdd:e=>(e&q)===q,neg:t=>Q(-t,e),eql:(e,t)=>e===t,sqr:t=>Q(t*t,e),add:(t,n)=>Q(t+n,e),sub:(t,n)=>Q(t-n,e),mul:(t,n)=>Q(t*n,e),pow:(e,t)=>function(e,t,n){if(n<Z)throw new Error("Expected power > 0");if(n===Z)return e.ONE;if(n===q)return t;let r=e.ONE,i=t;for(;n>Z;)n&q&&(r=e.mul(r,i)),i=e.sqr(i),n>>=q;return r}(a,e,t),div:(t,n)=>Q(t*ee(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>ee(t,e),sqrt:r.sqrt||(e=>o(a,e)),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r))),e.ONE),i=e.inv(r);return t.reduceRight(((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r))),i),n}(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?U(e,s):O(e,s),fromBytes:e=>{if(e.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${e.length}`);return n?z(e):M(e)}});return Object.freeze(a)}(Ee,void 0,void 0,{sqrt:xe}),Te=function(e,t){const n=t=>me({...e,...be(t)});return Object.freeze({...n(t),create:n})}({a:BigInt(0),b:BigInt(7),Fp:Se,n:ve,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=ve,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Ie*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=Ce(s*e,t),c=Ce(-r*e,t);let l=Q(e-a*n-c*i,t),u=Q(-a*r-c*s,t);const h=l>o,d=u>o;if(h&&(l=t-l),d&&(u=t-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:l,k2neg:d,k2:u}}}},C),Le=BigInt(0),ke=e=>"bigint"==typeof e&&Le<e&&e<Ee,_e={};function Ne(e,...t){let n=_e[e];if(void 0===n){const t=C(Uint8Array.from(e,(e=>e.charCodeAt(0))));n=P(t,t),_e[e]=n}return C(P(n,...t))}const Me=e=>e.toRawBytes(!0).slice(1),ze=e=>O(e,32),Oe=e=>Q(e,Ee),Ue=e=>Q(e,ve),Re=Te.ProjectivePoint;function Pe(e){let t=Te.utils.normPrivateKeyToScalar(e),n=Re.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:Ue(-t),bytes:Me(n)}}function De(e){if(!ke(e))throw new Error("bad x: need 0 < x < p");const t=Oe(e*e);let n=xe(Oe(t*e+BigInt(7)));n%Ae!==Le&&(n=Oe(-n));const r=new Re(e,n,Ie);return r.assertValidity(),r}function Be(...e){return Ue(M(Ne("BIP0340/challenge",...e)))}function je(e){return Pe(e).bytes}function Fe(e,t,n=w(32)){const r=R("message",e),{bytes:i,scalar:s}=Pe(t),o=R("auxRand",n,32),a=ze(s^M(Ne("BIP0340/aux",o))),c=Ne("BIP0340/nonce",a,i,r),l=Ue(M(c));if(l===Le)throw new Error("sign failed: k is zero");const{bytes:u,scalar:h}=Pe(l),d=Be(u,i,r),f=new Uint8Array(64);if(f.set(u,0),f.set(ze(Ue(h+d*s)),32),!He(f,r,i))throw new Error("sign: Invalid signature produced");return f}function He(e,t,n){const r=R("signature",e,64),i=R("message",t),s=R("publicKey",n,32);try{const e=De(M(s)),t=M(r.subarray(0,32));if(!ke(t))return!1;const n=M(r.subarray(32,64));if(!("bigint"==typeof(l=n)&&Le<l&&l<ve))return!1;const u=Be(ze(t),Me(e),i),h=(o=e,a=n,c=Ue(-u),Re.BASE.multiplyAndAddUnsafe(o,a,c));return!(!h||!h.hasEvenY()||h.toAffine().x!==t)}catch(e){return!1}var o,a,c,l}const $e=(()=>({getPublicKey:je,sign:Fe,verify:He,utils:{randomPrivateKey:Te.utils.randomPrivateKey,lift_x:De,pointToBytes:Me,numberToBytesBE:O,bytesToNumberBE:M,taggedHash:Ne,mod:Q}}))(),Ze="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,qe=e=>e instanceof Uint8Array,Ve=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Ge=(e,t)=>e<<32-t|e>>>t;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");const We=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function Ye(e){if(!qe(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=We[e[n]];return t}function Ke(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let t=0;t<n.length;t++){const r=2*t,i=e.slice(r,r+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[t]=s}return n}function Qe(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!qe(e))throw new Error("expected Uint8Array, got "+typeof e);return e}function Je(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!qe(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}class Xe{clone(){return this._cloneInto()}}function et(e){const t=t=>e().update(Qe(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function tt(e=32){if(Ze&&"function"==typeof Ze.getRandomValues)return Ze.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function nt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function rt(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}const it={number:nt,bool:function(e){if("boolean"!=typeof e)throw new Error(`Expected boolean, not ${e}`)},bytes:rt,hash:function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");nt(e.outputLen),nt(e.blockLen)},exists:function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},output:function(e,t){rt(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}},st=it;class ot extends Xe{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ve(this.buffer)}update(e){st.exists(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=Qe(e)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=Ve(e);for(;r<=i-s;s+=r)this.process(t,s)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){st.exists(this),st.output(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let e=s;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const o=Ve(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,l[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:s,pos:o}=this;return e.length=r,e.pos=o,e.finished=i,e.destroyed=s,r%t&&e.buffer.set(n),e}}const at=(e,t,n)=>e&t^e&n^t&n,ct=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),lt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ut=new Uint32Array(64);class ht extends ot{constructor(){super(64,32,8,!1),this.A=0|lt[0],this.B=0|lt[1],this.C=0|lt[2],this.D=0|lt[3],this.E=0|lt[4],this.F=0|lt[5],this.G=0|lt[6],this.H=0|lt[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:s,G:o,H:a}=this;return[e,t,n,r,i,s,o,a]}set(e,t,n,r,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)ut[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=ut[e-15],n=ut[e-2],r=Ge(t,7)^Ge(t,18)^t>>>3,i=Ge(n,17)^Ge(n,19)^n>>>10;ut[e]=i+ut[e-7]+r+ut[e-16]|0}let{A:n,B:r,C:i,D:s,E:o,F:a,G:c,H:l}=this;for(let e=0;e<64;e++){const t=l+(Ge(o,6)^Ge(o,11)^Ge(o,25))+((u=o)&a^~u&c)+ct[e]+ut[e]|0,h=(Ge(n,2)^Ge(n,13)^Ge(n,22))+at(n,r,i)|0;l=c,c=a,a=o,o=s+t|0,s=i,i=r,r=n,n=t+h|0}var u;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,i,s,o,a,c,l)}roundClean(){ut.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class dt extends ht{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const ft=et((()=>new ht));et((()=>new dt));function pt(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function gt(...e){const t=(e,t)=>n=>e(t(n)),n=Array.from(e).reverse().reduce(((e,n)=>e?t(e,n.encode):n.encode),void 0),r=e.reduce(((e,n)=>e?t(e,n.decode):n.decode),void 0);return{encode:n,decode:r}}function yt(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("alphabet.encode input should be an array of numbers");return t.map((t=>{if(pt(t),t<0||t>=e.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${e.length})`);return e[t]}))},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("alphabet.decode input should be array of strings");return t.map((t=>{if("string"!=typeof t)throw new Error(`alphabet.decode: not string element=${t}`);const n=e.indexOf(t);if(-1===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n}))}}}function wt(e=""){if("string"!=typeof e)throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw new Error("join.decode input should be string");return t.split(e)}}}function mt(e,t="="){if(pt(e),"string"!=typeof t)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.encode: non-string input=${e}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.decode: non-string input=${e}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function bt(e){if("function"!=typeof e)throw new Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function Et(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const i=[],s=Array.from(e);for(s.forEach((e=>{if(pt(e),e<0||e>=t)throw new Error(`Wrong integer: ${e}`)}));;){let e=0,o=!0;for(let i=r;i<s.length;i++){const a=s[i],c=t*e+a;if(!Number.isSafeInteger(c)||t*e/t!==e||c-a!=t*e)throw new Error("convertRadix: carry overflow");if(e=c%n,s[i]=Math.floor(c/n),!Number.isSafeInteger(s[i])||s[i]*n+e!==c)throw new Error("convertRadix: carry overflow");o&&(s[i]?o=!1:r=i)}if(i.push(e),o)break}for(let t=0;t<e.length-1&&0===e[t];t++)i.push(0);return i.reverse()}const vt=(e,t)=>t?vt(t,e%t):e,It=(e,t)=>e+(t-vt(e,t));function At(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(It(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${It(t,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const r of e){if(pt(r),r>=2**t)throw new Error(`convertRadix2: invalid data word=${r} from=${t}`);if(i=i<<t|r,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=t)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function Ct(e){return pt(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Et(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Et(t,e,256))}}}function xt(e,t=!1){if(pt(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(It(8,e)>32||It(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return At(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(At(n,e,8,t))}}}function St(e){if("function"!=typeof e)throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(e){}}}const Tt=gt(xt(4),yt("0123456789ABCDEF"),wt("")),Lt=gt(xt(5),yt("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),mt(5),wt("")),kt=(gt(xt(5),yt("0123456789ABCDEFGHIJKLMNOPQRSTUV"),mt(5),wt("")),gt(xt(5),yt("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),wt(""),bt((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),gt(xt(6),yt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),mt(6),wt(""))),_t=gt(xt(6),yt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),mt(6),wt("")),Nt=e=>gt(Ct(58),yt(e),wt("")),Mt=Nt("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),zt=(Nt("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Nt("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),[0,2,3,5,6,7,9,10,11]),Ot={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=Mt.encode(r).padStart(zt[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),i=zt.indexOf(r.length),s=Mt.decode(r);for(let e=0;e<s.length-i;e++)if(0!==s[e])throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(t)}},Ut=gt(yt("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),wt("")),Rt=[996825010,642813549,513874426,1027748829,705979059];function Pt(e){const t=e>>25;let n=(33554431&e)<<5;for(let e=0;e<Rt.length;e++)1==(t>>e&1)&&(n^=Rt[e]);return n}function Dt(e,t,n=1){const r=e.length;let i=1;for(let t=0;t<r;t++){const n=e.charCodeAt(t);if(n<33||n>126)throw new Error(`Invalid prefix (${e})`);i=Pt(i)^n>>5}i=Pt(i);for(let t=0;t<r;t++)i=Pt(i)^31&e.charCodeAt(t);for(let e of t)i=Pt(i)^e;for(let e=0;e<6;e++)i=Pt(i);return i^=n,Ut.encode(At([i%2**30],30,5,!1))}function Bt(e){const t="bech32"===e?1:734539939,n=xt(5),r=n.decode,i=n.encode,s=St(r);function o(e,n=90){if("string"!=typeof e)throw new Error("bech32.decode input should be string, not "+typeof e);if(e.length<8||!1!==n&&e.length>n)throw new TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${n})`);const r=e.toLowerCase();if(e!==r&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=(e=r).lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const s=e.slice(0,i),o=e.slice(i+1);if(o.length<6)throw new Error("Data must be at least 6 characters long");const a=Ut.decode(o).slice(0,-6),c=Dt(s,a,t);if(!o.endsWith(c))throw new Error(`Invalid checksum in ${e}: expected "${c}"`);return{prefix:s,words:a}}return{encode:function(e,n,r=90){if("string"!=typeof e)throw new Error("bech32.encode prefix should be string, not "+typeof e);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const i=e.length+7+n.length;if(!1!==r&&i>r)throw new TypeError(`Length ${i} exceeds limit ${r}`);return`${e=e.toLowerCase()}1${Ut.encode(n)}${Dt(e,n,t)}`},decode:o,decodeToBytes:function(e){const{prefix:t,words:n}=o(e,!1);return{prefix:t,words:n,bytes:r(n)}},decodeUnsafe:St(o),fromWords:r,fromWordsUnsafe:s,toWords:i}}const jt=Bt("bech32"),Ft=(Bt("bech32m"),{encode:e=>(new TextDecoder).decode(e),decode:e=>(new TextEncoder).encode(e)});gt(xt(4),yt("0123456789abcdef"),wt(""),bt((e=>{if("string"!=typeof e||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})));function Ht(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function $t(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}function Zt(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function qt(e,...t){if(!Zt(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function Vt(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Gt(e,t){qt(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Wt=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),Yt=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Kt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function Qt(e){if("string"==typeof e)e=function(e){if("string"!=typeof e)throw new Error("string expected, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e);else{if(!Zt(e))throw new Error("Uint8Array expected, got "+typeof e);e=e.slice()}return e}function Jt(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n}const Xt=(e,t)=>(Object.assign(t,e),t);function en(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,a,r)}const tn=16,nn=new Uint8Array(16),rn=Yt(nn),sn=e=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255;class on{constructor(e,t){this.blockLen=tn,this.outputLen=tn,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,qt(e=Qt(e),16);const n=Kt(e);let r=n.getUint32(0,!1),i=n.getUint32(4,!1),s=n.getUint32(8,!1),o=n.getUint32(12,!1);const a=[];for(let e=0;e<128;e++)a.push({s0:sn(r),s1:sn(i),s2:sn(s),s3:sn(o)}),({s0:r,s1:i,s2:s,s3:o}={s3:(u=s)<<31|(h=o)>>>1,s2:(l=i)<<31|u>>>1,s1:(c=r)<<31|l>>>1,s0:c>>>1^225<<24&-(1&h)});var c,l,u,h;const d=(e=>e>65536?8:e>1024?4:2)(t||1024);if(![1,2,4,8].includes(d))throw new Error(`ghash: wrong window size=${d}, should be 2, 4 or 8`);this.W=d;const f=128/d,p=this.windowSize=2**d,g=[];for(let e=0;e<f;e++)for(let t=0;t<p;t++){let n=0,r=0,i=0,s=0;for(let o=0;o<d;o++){if(!(t>>>d-o-1&1))continue;const{s0:c,s1:l,s2:u,s3:h}=a[d*e+o];n^=c,r^=l,i^=u,s^=h}g.push({s0:n,s1:r,s2:i,s3:s})}this.t=g}_updateBlock(e,t,n,r){e^=this.s0,t^=this.s1,n^=this.s2,r^=this.s3;const{W:i,t:s,windowSize:o}=this;let a=0,c=0,l=0,u=0;const h=(1<<i)-1;let d=0;for(const f of[e,t,n,r])for(let e=0;e<4;e++){const t=f>>>8*e&255;for(let e=8/i-1;e>=0;e--){const n=t>>>i*e&h,{s0:r,s1:f,s2:p,s3:g}=s[d*o+n];a^=r,c^=f,l^=p,u^=g,d+=1}}this.s0=a,this.s1=c,this.s2=l,this.s3=u}update(e){e=Qt(e),Vt(this);const t=Yt(e),n=Math.floor(e.length/tn),r=e.length%tn;for(let e=0;e<n;e++)this._updateBlock(t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]);return r&&(nn.set(e.subarray(n*tn)),this._updateBlock(rn[0],rn[1],rn[2],rn[3]),rn.fill(0)),this}destroy(){const{t:e}=this;for(const t of e)t.s0=0,t.s1=0,t.s2=0,t.s3=0}digestInto(e){Vt(this),Gt(e,this),this.finished=!0;const{s0:t,s1:n,s2:r,s3:i}=this,s=Yt(e);return s[0]=t,s[1]=n,s[2]=r,s[3]=i,e}digest(){const e=new Uint8Array(tn);return this.digestInto(e),this.destroy(),e}}class an extends on{constructor(e,t){const n=function(e){e.reverse();const t=1&e[15];let n=0;for(let t=0;t<e.length;t++){const r=e[t];e[t]=r>>>1|n,n=(1&r)<<7}return e[0]^=225&-t,e}((e=Qt(e)).slice());super(n,t),n.fill(0)}update(e){e=Qt(e),Vt(this);const t=Yt(e),n=e.length%tn,r=Math.floor(e.length/tn);for(let e=0;e<r;e++)this._updateBlock(sn(t[4*e+3]),sn(t[4*e+2]),sn(t[4*e+1]),sn(t[4*e+0]));return n&&(nn.set(e.subarray(r*tn)),this._updateBlock(sn(rn[3]),sn(rn[2]),sn(rn[1]),sn(rn[0])),rn.fill(0)),this}digestInto(e){Vt(this),Gt(e,this),this.finished=!0;const{s0:t,s1:n,s2:r,s3:i}=this,s=Yt(e);return s[0]=t,s[1]=n,s[2]=r,s[3]=i,e.reverse()}}function cn(e){const t=(t,n)=>e(n,t.length).update(Qt(t)).digest(),n=e(new Uint8Array(16),0);return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=(t,n)=>e(t,n),t}const ln=cn(((e,t)=>new on(e,t))),un=cn(((e,t)=>new an(e,t))),hn=16,dn=new Uint8Array(hn);function fn(e){return e<<1^283&-(e>>7)}function pn(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(1&t),e=fn(e);return n}const gn=(()=>{let e=new Uint8Array(256);for(let t=0,n=1;t<256;t++,n^=fn(n))e[t]=n;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return t})(),yn=gn.map(((e,t)=>gn.indexOf(t))),wn=e=>e<<8|e>>>24;function mn(e,t){if(256!==e.length)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((n,r)=>t(e[r]))),r=n.map(wn),i=r.map(wn),s=i.map(wn),o=new Uint32Array(65536),a=new Uint32Array(65536),c=new Uint16Array(65536);for(let t=0;t<256;t++)for(let l=0;l<256;l++){const u=256*t+l;o[u]=n[t]^r[l],a[u]=i[t]^s[l],c[u]=e[t]<<8|e[l]}return{sbox:e,sbox2:c,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const bn=mn(gn,(e=>pn(e,3)<<24|e<<16|e<<8|pn(e,2))),En=mn(yn,(e=>pn(e,11)<<24|pn(e,13)<<16|pn(e,9)<<8|pn(e,14))),vn=(()=>{const e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=fn(n))e[t]=n;return e})();function In(e){qt(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=bn,r=Yt(e),i=r.length,s=e=>xn(n,e,e,e,e),o=new Uint32Array(t+28);o.set(r);for(let e=i;e<o.length;e++){let t=o[e-1];e%i==0?t=s((a=t)<<24|a>>>8)^vn[e/i-1]:i>6&&e%i==4&&(t=s(t)),o[e]=o[e-i]^t}var a;return o}function An(e){const t=In(e),n=t.slice(),r=t.length,{sbox2:i}=bn,{T0:s,T1:o,T2:a,T3:c}=En;for(let e=0;e<r;e+=4)for(let i=0;i<4;i++)n[e+i]=t[r-e-4+i];t.fill(0);for(let e=4;e<r-4;e++){const t=n[e],r=xn(i,t,t,t,t);n[e]=s[255&r]^o[r>>>8&255]^a[r>>>16&255]^c[r>>>24]}return n}function Cn(e,t,n,r,i,s){return e[n<<8&65280|r>>>8&255]^t[i>>>8&65280|s>>>24&255]}function xn(e,t,n,r,i){return e[255&t|65280&n]|e[r>>>16&255|i>>>16&65280]<<16}function Sn(e,t,n,r,i){const{sbox2:s,T01:o,T23:a}=bn;let c=0;t^=e[c++],n^=e[c++],r^=e[c++],i^=e[c++];const l=e.length/4-2;for(let s=0;s<l;s++){const s=e[c++]^Cn(o,a,t,n,r,i),l=e[c++]^Cn(o,a,n,r,i,t),u=e[c++]^Cn(o,a,r,i,t,n),h=e[c++]^Cn(o,a,i,t,n,r);t=s,n=l,r=u,i=h}return{s0:e[c++]^xn(s,t,n,r,i),s1:e[c++]^xn(s,n,r,i,t),s2:e[c++]^xn(s,r,i,t,n),s3:e[c++]^xn(s,i,t,n,r)}}function Tn(e,t,n,r,i){const{sbox2:s,T01:o,T23:a}=En;let c=0;t^=e[c++],n^=e[c++],r^=e[c++],i^=e[c++];const l=e.length/4-2;for(let s=0;s<l;s++){const s=e[c++]^Cn(o,a,t,i,r,n),l=e[c++]^Cn(o,a,n,t,i,r),u=e[c++]^Cn(o,a,r,n,t,i),h=e[c++]^Cn(o,a,i,r,n,t);t=s,n=l,r=u,i=h}return{s0:e[c++]^xn(s,t,i,r,n),s1:e[c++]^xn(s,n,t,i,r),s2:e[c++]^xn(s,r,n,t,i),s3:e[c++]^xn(s,i,r,n,t)}}function Ln(e,t){if(!t)return new Uint8Array(e);if(qt(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function kn(e,t,n,r){qt(t,hn),qt(n);const i=n.length;r=Ln(i,r);const s=t,o=Yt(s);let{s0:a,s1:c,s2:l,s3:u}=Sn(e,o[0],o[1],o[2],o[3]);const h=Yt(n),d=Yt(r);for(let t=0;t+4<=h.length;t+=4){d[t+0]=h[t+0]^a,d[t+1]=h[t+1]^c,d[t+2]=h[t+2]^l,d[t+3]=h[t+3]^u;let n=1;for(let e=s.length-1;e>=0;e--)n=n+(255&s[e])|0,s[e]=255&n,n>>>=8;({s0:a,s1:c,s2:l,s3:u}=Sn(e,o[0],o[1],o[2],o[3]))}const f=hn*Math.floor(h.length/4);if(f<i){const e=new Uint32Array([a,c,l,u]),t=Wt(e);for(let e=f,s=0;e<i;e++,s++)r[e]=n[e]^t[s]}return r}function _n(e,t,n,r,i){qt(n,hn),qt(r),i=Ln(r.length,i);const s=n,o=Yt(s),a=Kt(s),c=Yt(r),l=Yt(i),u=t?0:12,h=r.length;let d=a.getUint32(u,t),{s0:f,s1:p,s2:g,s3:y}=Sn(e,o[0],o[1],o[2],o[3]);for(let n=0;n+4<=c.length;n+=4)l[n+0]=c[n+0]^f,l[n+1]=c[n+1]^p,l[n+2]=c[n+2]^g,l[n+3]=c[n+3]^y,d=d+1>>>0,a.setUint32(u,d,t),({s0:f,s1:p,s2:g,s3:y}=Sn(e,o[0],o[1],o[2],o[3]));const w=hn*Math.floor(c.length/4);if(w<h){const e=new Uint32Array([f,p,g,y]),t=Wt(e);for(let e=w,n=0;e<h;e++,n++)i[e]=r[e]^t[n]}return i}Xt({blockSize:16,nonceLength:16},(function(e,t){function n(n,r){const i=In(e),s=t.slice(),o=kn(i,s,n,r);return i.fill(0),s.fill(0),o}return qt(e),qt(t,hn),{encrypt:(e,t)=>n(e,t),decrypt:(e,t)=>n(e,t)}}));function Nn(e){if(qt(e),e.length%hn!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}function Mn(e,t,n){let r=e.length;const i=r%hn;if(!t&&0!==i)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=Yt(e);if(t){let e=hn-i;e||(e=hn),r+=e}const o=Ln(r,n);return{b:s,o:Yt(o),out:o}}function zn(e,t){if(!t)return e;const n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=e[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=e.subarray(0,-r);for(let t=0;t<r;t++)if(e[n-t-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function On(e){const t=new Uint8Array(16),n=Yt(t);t.set(e);const r=hn-e.length;for(let e=hn-r;e<hn;e++)t[e]=r;return n}Xt({blockSize:16},(function(e,t={}){qt(e);const n=!t.disablePadding;return{encrypt:(t,r)=>{qt(t);const{b:i,o:s,out:o}=Mn(t,n,r),a=In(e);let c=0;for(;c+4<=i.length;){const{s0:e,s1:t,s2:n,s3:r}=Sn(a,i[c+0],i[c+1],i[c+2],i[c+3]);s[c++]=e,s[c++]=t,s[c++]=n,s[c++]=r}if(n){const e=On(t.subarray(4*c)),{s0:n,s1:r,s2:i,s3:o}=Sn(a,e[0],e[1],e[2],e[3]);s[c++]=n,s[c++]=r,s[c++]=i,s[c++]=o}return a.fill(0),o},decrypt:(t,r)=>{Nn(t);const i=An(e),s=Ln(t.length,r),o=Yt(t),a=Yt(s);for(let e=0;e+4<=o.length;){const{s0:t,s1:n,s2:r,s3:s}=Tn(i,o[e+0],o[e+1],o[e+2],o[e+3]);a[e++]=t,a[e++]=n,a[e++]=r,a[e++]=s}return i.fill(0),zn(s,n)}}}));const Un=Xt({blockSize:16,nonceLength:16},(function(e,t,n={}){qt(e),qt(t,16);const r=!n.disablePadding;return{encrypt:(n,i)=>{const s=In(e),{b:o,o:a,out:c}=Mn(n,r,i),l=Yt(t);let u=l[0],h=l[1],d=l[2],f=l[3],p=0;for(;p+4<=o.length;)u^=o[p+0],h^=o[p+1],d^=o[p+2],f^=o[p+3],({s0:u,s1:h,s2:d,s3:f}=Sn(s,u,h,d,f)),a[p++]=u,a[p++]=h,a[p++]=d,a[p++]=f;if(r){const e=On(n.subarray(4*p));u^=e[0],h^=e[1],d^=e[2],f^=e[3],({s0:u,s1:h,s2:d,s3:f}=Sn(s,u,h,d,f)),a[p++]=u,a[p++]=h,a[p++]=d,a[p++]=f}return s.fill(0),c},decrypt:(n,i)=>{Nn(n);const s=An(e),o=Yt(t),a=Ln(n.length,i),c=Yt(n),l=Yt(a);let u=o[0],h=o[1],d=o[2],f=o[3];for(let e=0;e+4<=c.length;){const t=u,n=h,r=d,i=f;u=c[e+0],h=c[e+1],d=c[e+2],f=c[e+3];const{s0:o,s1:a,s2:p,s3:g}=Tn(s,u,h,d,f);l[e++]=o^t,l[e++]=a^n,l[e++]=p^r,l[e++]=g^i}return s.fill(0),zn(a,r)}}}));Xt({blockSize:16,nonceLength:16},(function(e,t){function n(n,r,i){const s=In(e),o=n.length;i=Ln(o,i);const a=Yt(n),c=Yt(i),l=r?c:a,u=Yt(t);let h=u[0],d=u[1],f=u[2],p=u[3];for(let e=0;e+4<=a.length;){const{s0:t,s1:n,s2:r,s3:i}=Sn(s,h,d,f,p);c[e+0]=a[e+0]^t,c[e+1]=a[e+1]^n,c[e+2]=a[e+2]^r,c[e+3]=a[e+3]^i,h=l[e++],d=l[e++],f=l[e++],p=l[e++]}const g=hn*Math.floor(a.length/4);if(g<o){({s0:h,s1:d,s2:f,s3:p}=Sn(s,h,d,f,p));const e=Wt(new Uint32Array([h,d,f,p]));for(let t=g,r=0;t<o;t++,r++)i[t]=n[t]^e[r];e.fill(0)}return s.fill(0),i}return qt(e),qt(t,16),{encrypt:(e,t)=>n(e,!0,t),decrypt:(e,t)=>n(e,!1,t)}}));function Rn(e,t,n,r,i){const s=e.create(n,r.length+(i?.length||0));i&&s.update(i),s.update(r);const o=new Uint8Array(16),a=Kt(o);return i&&en(a,0,BigInt(8*i.length),t),en(a,8,BigInt(8*r.length),t),s.update(o),s.digest()}Xt({blockSize:16,nonceLength:12,tagLength:16},(function(e,t,n){if(qt(t),0===t.length)throw new Error("aes/gcm: empty nonce");const r=16;function i(e,t,r){const i=Rn(ln,!1,e,r,n);for(let e=0;e<t.length;e++)i[e]^=t[e];return i}function s(){const n=In(e),r=dn.slice(),i=dn.slice();if(_n(n,!1,i,i,r),12===t.length)i.set(t);else{const e=dn.slice();en(Kt(e),8,BigInt(8*t.length),!1),ln.create(r).update(t).update(e).digestInto(i)}return{xk:n,authKey:r,counter:i,tagMask:_n(n,!1,i,dn)}}return{encrypt:e=>{qt(e);const{xk:t,authKey:n,counter:o,tagMask:a}=s(),c=new Uint8Array(e.length+r);_n(t,!1,o,e,c);const l=i(n,a,c.subarray(0,c.length-r));return c.set(l,e.length),t.fill(0),c},decrypt:e=>{if(qt(e),e.length<r)throw new Error("aes/gcm: ciphertext less than tagLen (16)");const{xk:t,authKey:n,counter:o,tagMask:a}=s(),c=e.subarray(0,-16),l=e.subarray(-16);if(!Jt(i(n,a,c),l))throw new Error("aes/gcm: invalid ghash tag");const u=_n(t,!1,o,c);return n.fill(0),a.fill(0),t.fill(0),u}}}));const Pn=(e,t,n)=>r=>{if(!Number.isSafeInteger(r)||t>r||r>n)throw new Error(`${e}: invalid value=${r}, must be [${t}..${n}]`)};Xt({blockSize:16,nonceLength:12,tagLength:16},(function(e,t,n){const r=Pn("AAD",0,2**36),i=Pn("plaintext",0,2**36),s=Pn("nonce",12,12),o=Pn("ciphertext",16,2**36+16);function a(){const n=e.length;if(16!==n&&24!==n&&32!==n)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${n} bytes`);const r=In(e),i=new Uint8Array(n),s=new Uint8Array(16),o=Yt(t);let a=0,c=o[0],l=o[1],u=o[2],h=0;for(const e of[s,i].map(Yt)){const t=Yt(e);for(let e=0;e<t.length;e+=2){const{s0:n,s1:i}=Sn(r,a,c,l,u);t[e+0]=n,t[e+1]=i,a=++h}}return r.fill(0),{authKey:s,encKey:In(i)}}function c(e,r,i){const s=Rn(un,!0,r,i,n);for(let e=0;e<12;e++)s[e]^=t[e];s[15]&=127;const o=Yt(s);let a=o[0],c=o[1],l=o[2],u=o[3];return({s0:a,s1:c,s2:l,s3:u}=Sn(e,a,c,l,u)),o[0]=a,o[1]=c,o[2]=l,o[3]=u,s}function l(e,t,n){let r=t.slice();return r[15]|=128,_n(e,!0,r,n)}return qt(t),s(t.length),n&&(qt(n),r(n.length)),{encrypt:e=>{qt(e),i(e.length);const{encKey:t,authKey:n}=a(),r=c(t,n,e),s=new Uint8Array(e.length+16);return s.set(r,e.length),s.set(l(t,r,e)),t.fill(0),n.fill(0),s},decrypt:e=>{qt(e),o(e.length);const t=e.subarray(-16),{encKey:n,authKey:r}=a(),i=l(n,t,e.subarray(0,-16)),s=c(n,r,i);if(n.fill(0),r.fill(0),!Jt(t,s))throw new Error("invalid polyval tag");return i}}}));const Dn=(e,t)=>255&e[t++]|(255&e[t++])<<8;class Bn{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,qt(e=Qt(e),32);const t=Dn(e,0),n=Dn(e,2),r=Dn(e,4),i=Dn(e,6),s=Dn(e,8),o=Dn(e,10),a=Dn(e,12),c=Dn(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|n<<3),this.r[2]=7939&(n>>>10|r<<6),this.r[3]=8191&(r>>>7|i<<9),this.r[4]=255&(i>>>4|s<<12),this.r[5]=s>>>1&8190,this.r[6]=8191&(s>>>14|o<<2),this.r[7]=8065&(o>>>11|a<<5),this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127;for(let t=0;t<8;t++)this.pad[t]=Dn(e,16+2*t)}process(e,t,n=!1){const r=n?0:2048,{h:i,r:s}=this,o=s[0],a=s[1],c=s[2],l=s[3],u=s[4],h=s[5],d=s[6],f=s[7],p=s[8],g=s[9],y=Dn(e,t+0),w=Dn(e,t+2),m=Dn(e,t+4),b=Dn(e,t+6),E=Dn(e,t+8),v=Dn(e,t+10),I=Dn(e,t+12),A=Dn(e,t+14);let C=i[0]+(8191&y),x=i[1]+(8191&(y>>>13|w<<3)),S=i[2]+(8191&(w>>>10|m<<6)),T=i[3]+(8191&(m>>>7|b<<9)),L=i[4]+(8191&(b>>>4|E<<12)),k=i[5]+(E>>>1&8191),_=i[6]+(8191&(E>>>14|v<<2)),N=i[7]+(8191&(v>>>11|I<<5)),M=i[8]+(8191&(I>>>8|A<<8)),z=i[9]+(A>>>5|r),O=0,U=O+C*o+x*(5*g)+S*(5*p)+T*(5*f)+L*(5*d);O=U>>>13,U&=8191,U+=k*(5*h)+_*(5*u)+N*(5*l)+M*(5*c)+z*(5*a),O+=U>>>13,U&=8191;let R=O+C*a+x*o+S*(5*g)+T*(5*p)+L*(5*f);O=R>>>13,R&=8191,R+=k*(5*d)+_*(5*h)+N*(5*u)+M*(5*l)+z*(5*c),O+=R>>>13,R&=8191;let P=O+C*c+x*a+S*o+T*(5*g)+L*(5*p);O=P>>>13,P&=8191,P+=k*(5*f)+_*(5*d)+N*(5*h)+M*(5*u)+z*(5*l),O+=P>>>13,P&=8191;let D=O+C*l+x*c+S*a+T*o+L*(5*g);O=D>>>13,D&=8191,D+=k*(5*p)+_*(5*f)+N*(5*d)+M*(5*h)+z*(5*u),O+=D>>>13,D&=8191;let B=O+C*u+x*l+S*c+T*a+L*o;O=B>>>13,B&=8191,B+=k*(5*g)+_*(5*p)+N*(5*f)+M*(5*d)+z*(5*h),O+=B>>>13,B&=8191;let j=O+C*h+x*u+S*l+T*c+L*a;O=j>>>13,j&=8191,j+=k*o+_*(5*g)+N*(5*p)+M*(5*f)+z*(5*d),O+=j>>>13,j&=8191;let F=O+C*d+x*h+S*u+T*l+L*c;O=F>>>13,F&=8191,F+=k*a+_*o+N*(5*g)+M*(5*p)+z*(5*f),O+=F>>>13,F&=8191;let H=O+C*f+x*d+S*h+T*u+L*l;O=H>>>13,H&=8191,H+=k*c+_*a+N*o+M*(5*g)+z*(5*p),O+=H>>>13,H&=8191;let $=O+C*p+x*f+S*d+T*h+L*u;O=$>>>13,$&=8191,$+=k*l+_*c+N*a+M*o+z*(5*g),O+=$>>>13,$&=8191;let Z=O+C*g+x*p+S*f+T*d+L*h;O=Z>>>13,Z&=8191,Z+=k*u+_*l+N*c+M*a+z*o,O+=Z>>>13,Z&=8191,O=(O<<2)+O|0,O=O+U|0,U=8191&O,O>>>=13,R+=O,i[0]=U,i[1]=R,i[2]=P,i[3]=D,i[4]=B,i[5]=j,i[6]=F,i[7]=H,i[8]=$,i[9]=Z}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let r=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=r,r=e[t]>>>13,e[t]&=8191;e[0]+=5*r,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,n[0]=e[0]+5,r=n[0]>>>13,n[0]&=8191;for(let t=1;t<10;t++)n[t]=e[t]+r,r=n[t]>>>13,n[t]&=8191;n[9]-=8192;let i=(1^r)-1;for(let e=0;e<10;e++)n[e]&=i;i=~i;for(let t=0;t<10;t++)e[t]=e[t]&i|n[t];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let s=e[0]+t[0];e[0]=65535&s;for(let n=1;n<8;n++)s=(e[n]+t[n]|0)+(s>>>16)|0,e[n]=65535&s}update(e){Vt(this);const{buffer:t,blockLen:n}=this,r=(e=Qt(e)).length;for(let i=0;i<r;){const s=Math.min(n-this.pos,r-i);if(s!==n)t.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(t,0,!1),this.pos=0);else for(;n<=r-i;i+=n)this.process(e,i)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){Vt(this),Gt(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:r}=this;if(r){for(t[r++]=1;r<16;r++)t[r]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let t=0;t<8;t++)e[i++]=n[t]>>>0,e[i++]=n[t]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}const jn=function(e){const t=(t,n)=>e(n).update(Qt(t)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=t=>e(t),t}((e=>new Bn(e))),Fn=e=>Uint8Array.from(e.split("").map((e=>e.charCodeAt(0)))),Hn=Fn("expand 16-byte k"),$n=Fn("expand 32-byte k"),Zn=Yt(Hn),qn=Yt($n);qn.slice();function Vn(e,t){return e<<t|e>>>32-t}function Gn(e){return e.byteOffset%4==0}const Wn=2**32-1,Yn=new Uint32Array;function Kn(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=function(e,t){if(null==t||"object"!=typeof t)throw new Error("options must be defined");return Object.assign(e,t)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw new Error("core must be a function");return Ht(i),Ht(o),$t(s),$t(n),(t,a,c,l,u=0)=>{qt(t),qt(a),qt(c);const h=c.length;if(l||(l=new Uint8Array(h)),qt(l),Ht(u),u<0||u>=Wn)throw new Error("arx: counter overflow");if(l.length<h)throw new Error(`arx: output (${l.length}) is shorter than data (${h})`);const d=[];let f,p,g=t.length;if(32===g)f=t.slice(),d.push(f),p=qn;else{if(16!==g||!n)throw new Error(`arx: invalid 32-byte key, got length=${g}`);f=new Uint8Array(32),f.set(t),f.set(t,16),p=Zn,d.push(f)}Gn(a)||(a=a.slice(),d.push(a));const y=Yt(f);if(r){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");r(p,y,Yt(a.subarray(0,16)),y),a=a.subarray(16)}const w=16-i;if(w!==a.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(12!==w){const e=new Uint8Array(12);e.set(a,s?0:12-a.length),a=e,d.push(a)}const m=Yt(a);for(!function(e,t,n,r,i,s,o,a){const c=i.length,l=new Uint8Array(64),u=Yt(l),h=Gn(i)&&Gn(s),d=h?Yt(i):Yn,f=h?Yt(s):Yn;for(let p=0;p<c;o++){if(e(t,n,r,u,o,a),o>=Wn)throw new Error("arx: counter overflow");const g=Math.min(64,c-p);if(h&&64===g){const e=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let t,n=0;n<16;n++)t=e+n,f[t]=d[t]^u[n];p+=64}else{for(let e,t=0;t<g;t++)e=p+t,s[e]=i[e]^l[t];p+=g}}}(e,p,y,m,c,l,u,o);d.length>0;)d.pop().fill(0);return l}}function Qn(e,t,n,r,i,s=20){let o=e[0],a=e[1],c=e[2],l=e[3],u=t[0],h=t[1],d=t[2],f=t[3],p=t[4],g=t[5],y=t[6],w=t[7],m=i,b=n[0],E=n[1],v=n[2],I=o,A=a,C=c,x=l,S=u,T=h,L=d,k=f,_=p,N=g,M=y,z=w,O=m,U=b,R=E,P=v;for(let e=0;e<s;e+=2)I=I+S|0,O=Vn(O^I,16),_=_+O|0,S=Vn(S^_,12),I=I+S|0,O=Vn(O^I,8),_=_+O|0,S=Vn(S^_,7),A=A+T|0,U=Vn(U^A,16),N=N+U|0,T=Vn(T^N,12),A=A+T|0,U=Vn(U^A,8),N=N+U|0,T=Vn(T^N,7),C=C+L|0,R=Vn(R^C,16),M=M+R|0,L=Vn(L^M,12),C=C+L|0,R=Vn(R^C,8),M=M+R|0,L=Vn(L^M,7),x=x+k|0,P=Vn(P^x,16),z=z+P|0,k=Vn(k^z,12),x=x+k|0,P=Vn(P^x,8),z=z+P|0,k=Vn(k^z,7),I=I+T|0,P=Vn(P^I,16),M=M+P|0,T=Vn(T^M,12),I=I+T|0,P=Vn(P^I,8),M=M+P|0,T=Vn(T^M,7),A=A+L|0,O=Vn(O^A,16),z=z+O|0,L=Vn(L^z,12),A=A+L|0,O=Vn(O^A,8),z=z+O|0,L=Vn(L^z,7),C=C+k|0,U=Vn(U^C,16),_=_+U|0,k=Vn(k^_,12),C=C+k|0,U=Vn(U^C,8),_=_+U|0,k=Vn(k^_,7),x=x+S|0,R=Vn(R^x,16),N=N+R|0,S=Vn(S^N,12),x=x+S|0,R=Vn(R^x,8),N=N+R|0,S=Vn(S^N,7);let D=0;r[D++]=o+I|0,r[D++]=a+A|0,r[D++]=c+C|0,r[D++]=l+x|0,r[D++]=u+S|0,r[D++]=h+T|0,r[D++]=d+L|0,r[D++]=f+k|0,r[D++]=p+_|0,r[D++]=g+N|0,r[D++]=y+M|0,r[D++]=w+z|0,r[D++]=m+O|0,r[D++]=b+U|0,r[D++]=E+R|0,r[D++]=v+P|0}const Jn=Kn(Qn,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Xn=Kn(Qn,{counterRight:!1,counterLength:8,extendNonceFn:function(e,t,n,r){let i=e[0],s=e[1],o=e[2],a=e[3],c=t[0],l=t[1],u=t[2],h=t[3],d=t[4],f=t[5],p=t[6],g=t[7],y=n[0],w=n[1],m=n[2],b=n[3];for(let e=0;e<20;e+=2)i=i+c|0,y=Vn(y^i,16),d=d+y|0,c=Vn(c^d,12),i=i+c|0,y=Vn(y^i,8),d=d+y|0,c=Vn(c^d,7),s=s+l|0,w=Vn(w^s,16),f=f+w|0,l=Vn(l^f,12),s=s+l|0,w=Vn(w^s,8),f=f+w|0,l=Vn(l^f,7),o=o+u|0,m=Vn(m^o,16),p=p+m|0,u=Vn(u^p,12),o=o+u|0,m=Vn(m^o,8),p=p+m|0,u=Vn(u^p,7),a=a+h|0,b=Vn(b^a,16),g=g+b|0,h=Vn(h^g,12),a=a+h|0,b=Vn(b^a,8),g=g+b|0,h=Vn(h^g,7),i=i+l|0,b=Vn(b^i,16),p=p+b|0,l=Vn(l^p,12),i=i+l|0,b=Vn(b^i,8),p=p+b|0,l=Vn(l^p,7),s=s+u|0,y=Vn(y^s,16),g=g+y|0,u=Vn(u^g,12),s=s+u|0,y=Vn(y^s,8),g=g+y|0,u=Vn(u^g,7),o=o+h|0,w=Vn(w^o,16),d=d+w|0,h=Vn(h^d,12),o=o+h|0,w=Vn(w^o,8),d=d+w|0,h=Vn(h^d,7),a=a+c|0,m=Vn(m^a,16),f=f+m|0,c=Vn(c^f,12),a=a+c|0,m=Vn(m^a,8),f=f+m|0,c=Vn(c^f,7);let E=0;r[E++]=i,r[E++]=s,r[E++]=o,r[E++]=a,r[E++]=y,r[E++]=w,r[E++]=m,r[E++]=b},allowShortKeys:!1}),er=new Uint8Array(16),tr=(e,t)=>{e.update(t);const n=t.length%16;n&&e.update(er.subarray(n))},nr=new Uint8Array(32);function rr(e,t,n,r,i){const s=e(t,n,nr),o=jn.create(s);i&&tr(o,i),tr(o,r);const a=new Uint8Array(16),c=Kt(a);en(c,0,BigInt(i?i.length:0),!0),en(c,8,BigInt(r.length),!0),o.update(a);const l=o.digest();return s.fill(0),l}const ir=e=>(t,n,r)=>{const i=16;return qt(t,32),qt(n),{encrypt:(s,o)=>{const a=s.length,c=a+i;o?qt(o,c):o=new Uint8Array(c),e(t,n,s,o,1);const l=rr(e,t,n,o.subarray(0,-16),r);return o.set(l,a),o},decrypt:(s,o)=>{const a=s.length,c=a-i;if(a<i)throw new Error("encrypted data must be at least 16 bytes");o?qt(o,c):o=new Uint8Array(c);const l=s.subarray(0,-16);if(!Jt(s.subarray(-16),rr(e,t,n,l,r)))throw new Error("invalid tag");return e(t,n,l,o,1),o}}};ir(Jn),ir(Xn);class sr extends Xe{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,st.hash(e);const n=Qe(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return st.exists(this),this.iHash.update(e),this}digestInto(e){st.exists(this),st.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=r,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const or=(e,t,n)=>new sr(e,t).update(n).digest();function ar(e,t,n){return st.hash(e),void 0===n&&(n=new Uint8Array(e.outputLen)),or(e,Qe(n),Qe(t))}or.create=(e,t)=>new sr(e,t);const cr=new Uint8Array([0]),lr=new Uint8Array;function ur(e,t,n,r=32){if(st.hash(e),st.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/e.outputLen);void 0===n&&(n=lr);const s=new Uint8Array(i*e.outputLen),o=or.create(e,t),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let t=0;t<i;t++)cr[0]=t+1,a.update(0===t?lr:c).update(n).update(cr).digestInto(c),s.set(c,e.outputLen*t),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),cr.fill(0),s.slice(0,r)}var hr=Object.defineProperty,dr=(e,t)=>{for(var n in t)hr(e,n,{get:t[n],enumerable:!0})},fr=Symbol("verified"),pr=e=>e instanceof Object;function gr(e){if(!pr(e))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}function yr(e){return e.sort(((e,t)=>e.created_at!==t.created_at?t.created_at-e.created_at:e.id.localeCompare(t.id)))}var wr={};dr(wr,{Queue:()=>xr,QueueNode:()=>Cr,binarySearch:()=>Ar,insertEventIntoAscendingList:()=>Ir,insertEventIntoDescendingList:()=>vr,normalizeURL:()=>Er,utf8Decoder:()=>mr,utf8Encoder:()=>br});var mr=new TextDecoder("utf-8"),br=new TextEncoder;function Er(e){-1===e.indexOf("://")&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),("80"===t.port&&"ws:"===t.protocol||"443"===t.port&&"wss:"===t.protocol)&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}function vr(e,t){const[n,r]=Ar(e,(e=>t.id===e.id?0:t.created_at===e.created_at?-1:e.created_at-t.created_at));return r||e.splice(n,0,t),e}function Ir(e,t){const[n,r]=Ar(e,(e=>t.id===e.id?0:t.created_at===e.created_at?-1:t.created_at-e.created_at));return r||e.splice(n,0,t),e}function Ar(e,t){let n=0,r=e.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=t(e[i]);if(0===s)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var Cr=class{value;next=null;prev=null;constructor(e){this.value=e}},xr=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){const t=new Cr(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const e=this.first;return this.first=e.next,e.value}};function Sr(e){if(!gr(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Tr(e){return Ye(ft(br.encode(Sr(e))))}var Lr=new class{generateSecretKey(){return $e.utils.randomPrivateKey()}getPublicKey(e){return Ye($e.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=Ye($e.getPublicKey(t)),n.id=Tr(n),n.sig=Ye($e.sign(Tr(n),t)),n[fr]=!0,n}verifyEvent(e){if("boolean"==typeof e[fr])return e[fr];const t=Tr(e);if(t!==e.id)return e[fr]=!1,!1;try{const n=$e.verify(e.sig,t,e.pubkey);return e[fr]=n,n}catch(t){return e[fr]=!1,!1}}},kr=Lr.generateSecretKey,_r=Lr.getPublicKey,Nr=Lr.finalizeEvent,Mr=Lr.verifyEvent,zr={};function Or(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function Ur(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function Rr(e){return 2e4<=e&&e<3e4}function Pr(e){return 3e4<=e&&e<4e4}function Dr(e){return Or(e)?"regular":Ur(e)?"replaceable":Rr(e)?"ephemeral":Pr(e)?"parameterized":"unknown"}function Br(e,t){const n=t instanceof Array?t:[t];return gr(e)&&n.includes(e.kind)||!1}dr(zr,{Application:()=>Qi,BadgeAward:()=>Wr,BadgeDefinition:()=>Zi,BlockedRelaysList:()=>xi,BookmarkList:()=>Ii,Bookmarksets:()=>Fi,Calendar:()=>is,CalendarEventRSVP:()=>ss,ChannelCreation:()=>Jr,ChannelHideMessage:()=>ti,ChannelMessage:()=>ei,ChannelMetadata:()=>Xr,ChannelMuteUser:()=>ni,ClassifiedListing:()=>es,ClientAuth:()=>zi,CommunitiesList:()=>Ai,CommunityDefinition:()=>cs,CommunityPostApproval:()=>hi,Contacts:()=>$r,CreateOrUpdateProduct:()=>Gi,CreateOrUpdateStall:()=>Vi,Curationsets:()=>Hi,Date:()=>ns,DirectMessageRelaysList:()=>ki,DraftClassifiedListing:()=>ts,DraftLong:()=>Yi,Emojisets:()=>Ki,EncryptedDirectMessage:()=>Zr,EventDeletion:()=>qr,FileMetadata:()=>si,FileServerPreference:()=>_i,Followsets:()=>Di,GenericRepost:()=>Qr,Genericlists:()=>Bi,GiftWrap:()=>ii,HTTPAuth:()=>Pi,Handlerinformation:()=>as,Handlerrecommendation:()=>os,Highlights:()=>mi,InterestsList:()=>Ti,Interestsets:()=>qi,JobFeedback:()=>pi,JobRequest:()=>di,JobResult:()=>fi,Label:()=>ui,LightningPubRPC:()=>Mi,LiveChatMessage:()=>oi,LiveEvent:()=>Ji,LongFormArticle:()=>Wi,Metadata:()=>jr,Mutelist:()=>bi,NWCWalletInfo:()=>Ni,NWCWalletRequest:()=>Oi,NWCWalletResponse:()=>Ui,NostrConnect:()=>Ri,OpenTimestamps:()=>ri,Pinlist:()=>Ei,PrivateDirectMessage:()=>Kr,ProblemTracker:()=>ai,ProfileBadges:()=>$i,PublicChatsList:()=>Ci,Reaction:()=>Gr,RecommendRelay:()=>Hr,RelayList:()=>vi,Relaysets:()=>ji,Report:()=>ci,Reporting:()=>li,Repost:()=>Vr,Seal:()=>Yr,SearchRelaysList:()=>Si,ShortTextNote:()=>Fr,Time:()=>rs,UserEmojiList:()=>Li,UserStatuses:()=>Xi,Zap:()=>wi,ZapGoal:()=>gi,ZapRequest:()=>yi,classifyKind:()=>Dr,isEphemeralKind:()=>Rr,isKind:()=>Br,isParameterizedReplaceableKind:()=>Pr,isRegularKind:()=>Or,isReplaceableKind:()=>Ur});var jr=0,Fr=1,Hr=2,$r=3,Zr=4,qr=5,Vr=6,Gr=7,Wr=8,Yr=13,Kr=14,Qr=16,Jr=40,Xr=41,ei=42,ti=43,ni=44,ri=1040,ii=1059,si=1063,oi=1311,ai=1971,ci=1984,li=1984,ui=1985,hi=4550,di=5999,fi=6999,pi=7e3,gi=9041,yi=9734,wi=9735,mi=9802,bi=1e4,Ei=10001,vi=10002,Ii=10003,Ai=10004,Ci=10005,xi=10006,Si=10007,Ti=10015,Li=10030,ki=10050,_i=10096,Ni=13194,Mi=21e3,zi=22242,Oi=23194,Ui=23195,Ri=24133,Pi=27235,Di=3e4,Bi=30001,ji=30002,Fi=30003,Hi=30004,$i=30008,Zi=30009,qi=30015,Vi=30017,Gi=30018,Wi=30023,Yi=30024,Ki=30030,Qi=30078,Ji=30311,Xi=30315,es=30402,ts=30403,ns=31922,rs=31923,is=31924,ss=31925,os=31989,as=31990,cs=34550;function ls(e,t){if(e.ids&&-1===e.ids.indexOf(t.id))return!1;if(e.kinds&&-1===e.kinds.indexOf(t.kind))return!1;if(e.authors&&-1===e.authors.indexOf(t.pubkey))return!1;for(let n in e)if("#"===n[0]){let r=e[`#${n.slice(1)}`];if(r&&!t.tags.find((([e,t])=>e===n.slice(1)&&-1!==r.indexOf(t))))return!1}return!(e.since&&t.created_at<e.since)&&!(e.until&&t.created_at>e.until)}function us(e,t){for(let n=0;n<e.length;n++)if(ls(e[n],t))return!0;return!1}function hs(...e){let t={};for(let n=0;n<e.length;n++){let r=e[n];Object.entries(r).forEach((([e,n])=>{if("kinds"===e||"ids"===e||"authors"===e||"#"===e[0]){t[e]=t[e]||[];for(let r=0;r<n.length;r++){let i=n[r];t[e].includes(i)||t[e].push(i)}}})),r.limit&&(!t.limit||r.limit>t.limit)&&(t.limit=r.limit),r.until&&(!t.until||r.until>t.until)&&(t.until=r.until),r.since&&(!t.since||r.since<t.since)&&(t.since=r.since)}return t}function ds(e){if(e.ids&&!e.ids.length)return 0;if(e.kinds&&!e.kinds.length)return 0;if(e.authors&&!e.authors.length)return 0;for(const[t,n]of Object.entries(e))if("#"===t[0]&&Array.isArray(n)&&!n.length)return 0;return Math.min(Math.max(0,e.limit??1/0),e.ids?.length??1/0,e.authors?.length&&e.kinds?.every((e=>Ur(e)))?e.authors.length*e.kinds.length:1/0,e.authors?.length&&e.kinds?.every((e=>Pr(e)))&&e["#d"]?.length?e.authors.length*e.kinds.length*e["#d"].length:1/0)}var fs={};function ps(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,i=e.slice(r).indexOf('"')+r+1;return e.slice(i,i+64)}function gs(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,i=e.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function ys(e){let t=e.slice(0,22).indexOf('"EVENT"');if(-1===t)return null;let n=e.slice(t+7+1).indexOf('"');if(-1===n)return null;let r=t+7+1+n,i=e.slice(r+1,80).indexOf('"');if(-1===i)return null;let s=r+1+i;return e.slice(r+1,s)}function ws(e,t){return t===ps(e,"id")}function ms(e,t){return t===ps(e,"pubkey")}function bs(e,t){return t===gs(e,"kind")}dr(fs,{getHex64:()=>ps,getInt:()=>gs,getSubscriptionId:()=>ys,matchEventId:()=>ws,matchEventKind:()=>bs,matchEventPubkey:()=>ms});var Es={};function vs(e,t){return{kind:zi,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function Is(){return new Promise((e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()}))}dr(Es,{makeAuthEvent:()=>vs});var As,Cs=e=>(e[fr]=!0,!0),xs=class{url;_connected=!1;onclose=null;onnotice=e=>{};_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new xr;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(e,t){this.url=Er(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket}static async connect(e,t){const n=new xs(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((e,t)=>{this.connectionTimeoutHandle=setTimeout((()=>{t("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(e){return void t(e)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=e=>{t(e.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;!1!==this.handleNext();)await Is();this.queueRunning=!1}handleNext(){const e=this.incomingMessageQueue.dequeue();if(!e)return!1;const t=ys(e);if(t){const n=this.openSubs.get(t);if(!n)return;const r=ps(e,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let t=JSON.parse(e);switch(t[0]){case"EVENT":{const e=this.openSubs.get(t[1]),n=t[2];return void(this.verifyEvent(n)&&us(e.filters,n)&&e.onevent(n))}case"COUNT":{const e=t[1],n=t[2],r=this.openCountRequests.get(e);return void(r&&(r.resolve(n.count),this.openCountRequests.delete(e)))}case"EOSE":{const e=this.openSubs.get(t[1]);if(!e)return;return void e.receivedEose()}case"OK":{const e=t[1],n=t[2],r=t[3],i=this.openEventPublishes.get(e);return void(i&&(n?i.resolve(r):i.reject(new Error(r)),this.openEventPublishes.delete(e)))}case"CLOSED":{const e=t[1],n=this.openSubs.get(e);if(!n)return;return n.closed=!0,void n.close(t[2])}case"NOTICE":return void this.onnotice(t[1]);case"AUTH":return this.challenge=t[1],void this._onauth?.(t[1])}}catch(e){return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(e)}))}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const t=await e(vs(this.url,this.challenge)),n=new Promise(((e,n)=>{this.openEventPublishes.set(t.id,{resolve:e,reject:n})}));return this.send('["AUTH",'+JSON.stringify(t)+"]"),n}async publish(e){const t=new Promise(((t,n)=>{this.openEventPublishes.set(e.id,{resolve:t,reject:n})}));return this.send('["EVENT",'+JSON.stringify(e)+"]"),setTimeout((()=>{const t=this.openEventPublishes.get(e.id);t&&(t.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))}),this.publishTimeout),t}async count(e,t){this.serial++;const n=t?.id||"count:"+this.serial,r=new Promise(((e,t)=>{this.openCountRequests.set(n,{resolve:e,reject:t})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||"sub:"+this.serial,r=new Ss(this,n,e,t);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},Ss=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(e,t,n,r){this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||e.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(e=>{})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(e="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(e)}};try{As=WebSocket}catch{}var Ts,Ls=class extends xs{constructor(e){super(e,{verifyEvent:Mr,websocketImplementation:As})}static async connect(e){const t=new Ls(e);return await t.connect(),t}},ks=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(e){this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation}async ensureRelay(e,t){e=Er(e);let n=this.relays.get(e);return n||(n=new xs(e,{verifyEvent:this.trustedRelayURLs.has(e)?Cs:this.verifyEvent,websocketImplementation:this._WebSocket}),t?.connectionTimeout&&(n.connectionTimeout=t.connectionTimeout),this.relays.set(e,n)),await n.connect(),n}close(e){e.map(Er).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(e,t,n){return this.subscribeManyMap(Object.fromEntries(e.map((e=>[e,t]))),n)}subscribeManyMap(e,t){this.trackRelays&&(t.receivedEvent=(e,t)=>{let n=this.seenOn.get(t);n||(n=new Set,this.seenOn.set(t,n)),n.add(e)});const n=new Set,r=[],i=Object.keys(e).length,s=[];let o=e=>{s[e]=!0,s.filter((e=>e)).length===i&&(t.oneose?.(),o=()=>{})};const a=[];let c=(e,n)=>{o(e),a[e]=n,a.filter((e=>e)).length===i&&(t.onclose?.(a),c=()=>{})};const l=e=>{if(t.alreadyHaveEvent?.(e))return!0;const r=n.has(e);return n.add(e),r},u=Promise.all(Object.entries(e).map((async(e,n,i)=>{if(i.indexOf(e)!==n)return void c(n,"duplicate url");let s,[a,u]=e;a=Er(a);try{s=await this.ensureRelay(a,{connectionTimeout:t.maxWait?Math.max(.8*t.maxWait,t.maxWait-1e3):void 0})}catch(e){return void c(n,e?.message||String(e))}let h=s.subscribe(u,{...t,oneose:()=>o(n),onclose:e=>c(n,e),alreadyHaveEvent:l,eoseTimeout:t.maxWait});r.push(h)})));return{async close(){await u,r.forEach((e=>{e.close()}))}}}subscribeManyEose(e,t,n){const r=this.subscribeMany(e,t,{...n,oneose(){r.close()}});return r}async querySync(e,t,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(e,[t],{...n,onevent(e){i.push(e)},onclose(e){r(i)}})}))}async get(e,t,n){t.limit=1;const r=await this.querySync(e,t,n);return r.sort(((e,t)=>t.created_at-e.created_at)),r[0]||null}publish(e,t){return e.map(Er).map((async(e,n,r)=>{if(r.indexOf(e)!==n)return Promise.reject("duplicate url");let i=await this.ensureRelay(e);return i.publish(t).then((e=>{if(this.trackRelays){let e=this.seenOn.get(t.id);e||(e=new Set,this.seenOn.set(t.id,e)),e.add(i)}return e}))}))}listConnectionStatus(){const e=new Map;return this.relays.forEach(((t,n)=>e.set(n,t.connected))),e}destroy(){this.relays.forEach((e=>e.close())),this.relays=new Map}};try{Ts=WebSocket}catch{}var _s=class extends ks{constructor(){super({verifyEvent:Mr,websocketImplementation:Ts})}},Ns={};dr(Ns,{BECH32_REGEX:()=>Os,Bech32MaxSize:()=>zs,NostrTypeGuard:()=>Ms,decode:()=>Us,encodeBytes:()=>Fs,naddrEncode:()=>Zs,neventEncode:()=>$s,noteEncode:()=>Bs,nprofileEncode:()=>Hs,npubEncode:()=>Ds,nsecEncode:()=>Ps});var Ms={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},zs=5e3,Os=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function Us(e){let{prefix:t,words:n}=jt.decode(e,zs),r=new Uint8Array(jt.fromWords(n));switch(t){case"nprofile":{let e=Rs(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Ye(e[0][0]),relays:e[1]?e[1].map((e=>mr.decode(e))):[]}}}case"nevent":{let e=Rs(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for nevent");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(e[2]&&32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(e[3]&&4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Ye(e[0][0]),relays:e[1]?e[1].map((e=>mr.decode(e))):[],author:e[2]?.[0]?Ye(e[2][0]):void 0,kind:e[3]?.[0]?parseInt(Ye(e[3][0]),16):void 0}}}case"naddr":{let e=Rs(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!e[2]?.[0])throw new Error("missing TLV 2 for naddr");if(32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!e[3]?.[0])throw new Error("missing TLV 3 for naddr");if(4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:mr.decode(e[0][0]),pubkey:Ye(e[2][0]),kind:parseInt(Ye(e[3][0]),16),relays:e[1]?e[1].map((e=>mr.decode(e))):[]}}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:Ye(r)};default:throw new Error(`unknown prefix ${t}`)}}function Rs(e){let t={},n=e;for(;n.length>0;){let e=n[0],r=n[1],i=n.slice(2,2+r);if(n=n.slice(2+r),i.length<r)throw new Error(`not enough data to read on TLV ${e}`);t[e]=t[e]||[],t[e].push(i)}return t}function Ps(e){return Fs("nsec",e)}function Ds(e){return Fs("npub",Ke(e))}function Bs(e){return Fs("note",Ke(e))}function js(e,t){let n=jt.toWords(t);return jt.encode(e,n,zs)}function Fs(e,t){return js(e,t)}function Hs(e){return js("nprofile",qs({0:[Ke(e.pubkey)],1:(e.relays||[]).map((e=>br.encode(e)))}))}function $s(e){let t;return void 0!==e.kind&&(t=function(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=255&e,t}(e.kind)),js("nevent",qs({0:[Ke(e.id)],1:(e.relays||[]).map((e=>br.encode(e))),2:e.author?[Ke(e.author)]:[],3:t?[new Uint8Array(t)]:[]}))}function Zs(e){let t=new ArrayBuffer(4);return new DataView(t).setUint32(0,e.kind,!1),js("naddr",qs({0:[br.encode(e.identifier)],1:(e.relays||[]).map((e=>br.encode(e))),2:[Ke(e.pubkey)],3:[new Uint8Array(t)]}))}function qs(e){let t=[];return Object.entries(e).reverse().forEach((([e,n])=>{n.forEach((n=>{let r=new Uint8Array(n.length+2);r.set([parseInt(e)],0),r.set([n.length],1),r.set(n,2),t.push(r)}))})),Je(...t)}var Vs=/\bnostr:((note|npub|naddr|nevent|nprofile)1\w+)\b|#\[(\d+)\]/g;function Gs(e){let t=[];for(let n of e.content.matchAll(Vs))if(n[2])try{let{type:e,data:r}=Us(n[1]);switch(e){case"npub":t.push({text:n[0],profile:{pubkey:r,relays:[]}});break;case"nprofile":t.push({text:n[0],profile:r});break;case"note":t.push({text:n[0],event:{id:r,relays:[]}});break;case"nevent":t.push({text:n[0],event:r});break;case"naddr":t.push({text:n[0],address:r})}}catch(e){}else if(n[3]){let r=parseInt(n[3],10),i=e.tags[r];if(!i)continue;switch(i[0]){case"p":t.push({text:n[0],profile:{pubkey:i[1],relays:i[2]?[i[2]]:[]}});break;case"e":t.push({text:n[0],event:{id:i[1],relays:i[2]?[i[2]]:[]}});break;case"a":try{let[e,r,s]=i[1].split(":");t.push({text:n[0],address:{identifier:s,pubkey:r,kind:parseInt(e,10),relays:i[2]?[i[2]]:[]}})}catch(e){}}}return t}var Ws={};async function Ys(e,t,n){const r=e instanceof Uint8Array?Ye(e):e,i=Qs(Te.getSharedSecret(r,"02"+t));let s=Uint8Array.from(tt(16)),o=br.encode(n),a=Un(i,s).encrypt(o);return`${kt.encode(new Uint8Array(a))}?iv=${kt.encode(new Uint8Array(s.buffer))}`}async function Ks(e,t,n){const r=e instanceof Uint8Array?Ye(e):e;let[i,s]=n.split("?iv="),o=Qs(Te.getSharedSecret(r,"02"+t)),a=kt.decode(s),c=kt.decode(i),l=Un(o,a).decrypt(c);return mr.decode(l)}function Qs(e){return e.slice(1,33)}dr(Ws,{decrypt:()=>Ks,encrypt:()=>Ys});var Js={};dr(Js,{NIP05_REGEX:()=>eo,isNip05:()=>to,isValid:()=>so,queryProfile:()=>io,searchDomain:()=>ro,useFetchImplementation:()=>no});var Xs,eo=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,to=e=>eo.test(e||"");try{Xs=fetch}catch(e){}function no(e){Xs=e}async function ro(e,t=""){try{const n=`https://${e}/.well-known/nostr.json?name=${t}`,r=await Xs(n,{redirect:"manual"});if(200!==r.status)throw Error("Wrong response code");return(await r.json()).names}catch(e){return{}}}async function io(e){const t=e.match(eo);if(!t)return null;const[,n="_",r]=t;try{const e=`https://${r}/.well-known/nostr.json?name=${n}`,t=await Xs(e,{redirect:"manual"});if(200!==t.status)throw Error("Wrong response code");const i=await t.json(),s=i.names[n];return s?{pubkey:s,relays:i.relays?.[s]}:null}catch(e){return null}}async function so(e,t){const n=await io(t);return!!n&&n.pubkey===e}var oo={};function ao(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=e.tags.length-1;i>=0;i--){const s=e.tags[i];if("e"===s[0]&&s[1]){const[e,i,o,a,c]=s,l={id:i,relays:o?[o]:[],author:c};if("root"===a){t.root=l;continue}if("reply"===a){t.reply=l;continue}if("mention"===a){t.mentions.push(l);continue}n?r=l:n=l,t.mentions.push(l)}else{if("q"===s[0]&&s[1]){const[e,n,r]=s;t.quotes.push({id:n,relays:r?[r]:[]})}"p"===s[0]&&s[1]&&t.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]})}}return t.root||(t.root=r||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach((e=>{if(!e)return;let n=t.mentions.indexOf(e);if(-1!==n&&t.mentions.splice(n,1),e.author){let n=t.profiles.find((t=>t.pubkey===e.author));n&&n.relays&&(e.relays||(e.relays=[]),n.relays.forEach((t=>{-1===e.relays?.indexOf(t)&&e.relays.push(t)})),n.relays=e.relays)}})),t.mentions.forEach((e=>{if(e.author){let n=t.profiles.find((t=>t.pubkey===e.author));n&&n.relays&&(e.relays||(e.relays=[]),n.relays.forEach((t=>{-1===e.relays.indexOf(t)&&e.relays.push(t)})),n.relays=e.relays)}})),t}dr(oo,{parse:()=>ao});var co={};dr(co,{fetchRelayInformation:()=>uo,useFetchImplementation:()=>lo});try{fetch}catch{}function lo(e){0}async function uo(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var ho={};function fo(e){let t=0;for(let n=0;n<64;n+=8){const r=parseInt(e.substring(n,n+8),16);if(0!==r){t+=Math.clz32(r);break}t+=32}return t}function po(e,t){let n=0;const r=e,i=["nonce",n.toString(),t.toString()];for(r.tags.push(i);;){const e=Math.floor((new Date).getTime()/1e3);if(e!==r.created_at&&(n=0,r.created_at=e),i[1]=(++n).toString(),r.id=go(r),fo(r.id)>=t)break}return r}function go(e){return Ye(ft(br.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}dr(ho,{fastEventHash:()=>go,getPow:()=>fo,minePow:()=>po});var yo={};function wo(e,t,n,r){return Nr({kind:Vr,tags:[...e.tags??[],["e",t.id,n],["p",t.pubkey]],content:""===e.content?"":JSON.stringify(t),created_at:e.created_at},r)}function mo(e){if(e.kind!==Vr)return;let t,n;for(let r=e.tags.length-1;r>=0&&(void 0===t||void 0===n);r--){const i=e.tags[r];i.length>=2&&("e"===i[0]&&void 0===t?t=i:"p"===i[0]&&void 0===n&&(n=i))}return void 0!==t?{id:t[1],relays:[t[2],n?.[2]].filter((e=>"string"==typeof e)),author:n?.[1]}:void 0}function bo(e,{skipVerification:t}={}){const n=mo(e);if(void 0===n||""===e.content)return;let r;try{r=JSON.parse(e.content)}catch(e){return}return r.id===n.id&&(t||Mr(r))?r:void 0}dr(yo,{finishRepostEvent:()=>wo,getRepostedEvent:()=>bo,getRepostedEventPointer:()=>mo});var Eo={};dr(Eo,{NOSTR_URI_REGEX:()=>vo,parse:()=>Ao,test:()=>Io});var vo=new RegExp(`nostr:(${Os.source})`);function Io(e){return"string"==typeof e&&new RegExp(`^${vo.source}$`).test(e)}function Ao(e){const t=e.match(new RegExp(`^${vo.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:Us(t[1])}}var Co={};function xo(e,t,n){const r=t.tags.filter((e=>e.length>=2&&("e"===e[0]||"p"===e[0])));return Nr({...e,kind:Gr,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function So(e){if(e.kind!==Gr)return;let t,n;for(let r=e.tags.length-1;r>=0&&(void 0===t||void 0===n);r--){const i=e.tags[r];i.length>=2&&("e"===i[0]&&void 0===t?t=i:"p"===i[0]&&void 0===n&&(n=i))}return void 0!==t&&void 0!==n?{id:t[1],relays:[t[2],n[2]].filter((e=>void 0!==e)),author:n[1]}:void 0}dr(Co,{finishReactionEvent:()=>xo,getReactedEventPointer:()=>So});var To={};dr(To,{matchAll:()=>ko,regex:()=>Lo,replaceAll:()=>_o});var Lo=()=>new RegExp(`\\b${vo.source}\\b`,"g");function*ko(e){const t=e.matchAll(Lo());for(const e of t)try{const[t,n]=e;yield{uri:t,value:n,decoded:Us(n),start:e.index,end:e.index+t.length}}catch(e){}}function _o(e,t){return e.replaceAll(Lo(),((e,n)=>t({uri:e,value:n,decoded:Us(n)})))}var No={};dr(No,{channelCreateEvent:()=>Mo,channelHideMessageEvent:()=>Uo,channelMessageEvent:()=>Oo,channelMetadataEvent:()=>zo,channelMuteUserEvent:()=>Ro});var Mo=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return Nr({kind:Jr,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},zo=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return Nr({kind:Xr,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Oo=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),Nr({kind:ei,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},Uo=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return Nr({kind:ti,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Ro=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return Nr({kind:ni,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)},Po={};dr(Po,{EMOJI_SHORTCODE_REGEX:()=>Do,matchAll:()=>jo,regex:()=>Bo,replaceAll:()=>Fo});var Do=/:(\w+):/,Bo=()=>new RegExp(`\\B${Do.source}\\B`,"g");function*jo(e){const t=e.matchAll(Bo());for(const e of t)try{const[t,n]=e;yield{shortcode:t,name:n,start:e.index,end:e.index+t.length}}catch(e){}}function Fo(e,t){return e.replaceAll(Bo(),((e,n)=>t({shortcode:e,name:n})))}var Ho,$o={};dr($o,{useFetchImplementation:()=>Zo,validateGithub:()=>qo});try{Ho=fetch}catch{}function Zo(e){Ho=e}async function qo(e,t,n){try{return await(await Ho(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch(e){return!1}}var Vo={};dr(Vo,{decrypt:()=>ta,encrypt:()=>ea,getConversationKey:()=>Yo,v2:()=>na});var Go=1,Wo=65535;function Yo(e,t){const n=Te.getSharedSecret(e,"02"+t).subarray(1,33);return ar(ft,n,"nip44-v2")}function Ko(e,t){const n=ur(ft,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function Qo(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function Jo(e){const t=br.encode(e),n=t.length;return Je(function(e){if(!Number.isSafeInteger(e)||e<Go||e>Wo)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}(n),t,new Uint8Array(Qo(n)-n))}function Xo(e,t,n){if(32!==n.length)throw new Error("AAD associated data must be 32 bytes");const r=Je(n,t);return or(ft,e,r)}function ea(e,t,n=tt(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=Ko(t,n),o=Jo(e),a=Jn(r,i,o),c=Xo(s,a,n);return kt.encode(Je(new Uint8Array([2]),n,a,c))}function ta(e,t){const{nonce:n,ciphertext:r,mac:i}=function(e){if("string"!=typeof e)throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if("#"===e[0])throw new Error("unknown encryption version");let n;try{n=kt.decode(e)}catch(e){throw new Error("invalid base64: "+e.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(2!==i)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}(e),{chacha_key:s,chacha_nonce:o,hmac_key:a}=Ko(t,n);if(!Jt(Xo(a,r,n),i))throw new Error("invalid MAC");return function(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<Go||t>Wo||n.length!==t||e.length!==2+Qo(t))throw new Error("invalid padding");return mr.decode(n)}(Jn(s,o,r))}var na={utils:{getConversationKey:Yo,calcPaddedLen:Qo},encrypt:ea,decrypt:ta},ra={};function ia(e){const{pathname:t,searchParams:n}=new URL(e),r=t,i=n.get("relay"),s=n.get("secret");if(!r||!i||!s)throw new Error("invalid connection string");return{pubkey:r,relay:i,secret:s}}async function sa(e,t,n){const r={method:"pay_invoice",params:{invoice:n}},i=await Ys(t,e,JSON.stringify(r)),s={kind:Oi,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e]]};return Nr(s,t)}dr(ra,{makeNwcRequestEvent:()=>sa,parseConnectionString:()=>ia});var oa,aa={};dr(aa,{getZapEndpoint:()=>la,makeZapReceipt:()=>da,makeZapRequest:()=>ua,useFetchImplementation:()=>ca,validateZapRequest:()=>ha});try{oa=fetch}catch{}function ca(e){oa=e}async function la(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(n){let{words:e}=jt.decode(n,1e3),r=jt.fromWords(e);t=mr.decode(r)}else{if(!r)return null;{let[e,n]=r.split("@");t=new URL(`/.well-known/lnurlp/${e}`,`https://${n}`).toString()}}let i=await oa(t),s=await i.json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch(e){}return null}function ua({profile:e,event:t,amount:n,relays:r,comment:i=""}){if(!n)throw new Error("amount not given");if(!e)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e],["amount",n.toString()],["relays",...r]]};return t&&s.tags.push(["e",t]),s}function ha(e){let t;try{t=JSON.parse(e)}catch(e){return"Invalid zap request JSON."}if(!gr(t))return"Zap request is not a valid Nostr event.";if(!Mr(t))return"Invalid signature on zap request.";let n=t.tags.find((([e,t])=>"p"===e&&t));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find((([e,t])=>"e"===e&&t));return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find((([e,t])=>"relays"===e&&t))?null:"Zap request doesn't have a 'relays' tag."}function da({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let i=JSON.parse(e),s=i.tags.filter((([e])=>"e"===e||"p"===e||"a"===e)),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",e]]};return t&&o.tags.push(["preimage",t]),o}var fa={};dr(fa,{createRumor:()=>ba,createSeal:()=>Ea,createWrap:()=>va,unwrapEvent:()=>Ca,unwrapManyEvents:()=>xa,wrapEvent:()=>Ia,wrapManyEvents:()=>Aa});var pa=()=>Math.round(Date.now()/1e3),ga=()=>Math.round(pa()-172800*Math.random()),ya=(e,t)=>Yo(e,t),wa=(e,t,n)=>ea(JSON.stringify(e),ya(t,n)),ma=(e,t)=>JSON.parse(ta(e.content,ya(t,e.pubkey)));function ba(e,t){const n={created_at:pa(),content:"",tags:[],...e,pubkey:_r(t)};return n.id=Tr(n),n}function Ea(e,t,n){return Nr({kind:Yr,content:wa(e,t,n),created_at:ga(),tags:[]},t)}function va(e,t){const n=kr();return Nr({kind:ii,content:wa(e,n,t),created_at:ga(),tags:[["p",t]]},n)}function Ia(e,t,n){return va(Ea(ba(e,t),t,n),n)}function Aa(e,t,n){if(!n||0===n.length)throw new Error("At least one recipient is required.");const r=_r(t),i=[Ia(e,t,r)];return n.forEach((n=>{i.push(Ia(e,t,n))})),i}function Ca(e,t){const n=ma(e,t);return ma(n,t)}function xa(e,t){let n=[];return e.forEach((e=>{n.push(Ca(e,t))})),n.sort(((e,t)=>e.created_at-t.created_at)),n}var Sa={};dr(Sa,{getToken:()=>La,hashPayload:()=>Ua,unpackEventFromToken:()=>_a,validateEvent:()=>Pa,validateEventKind:()=>Ma,validateEventMethodTag:()=>Oa,validateEventPayloadTag:()=>Ra,validateEventTimestamp:()=>Na,validateEventUrlTag:()=>za,validateToken:()=>ka});var Ta="Nostr ";async function La(e,t,n,r=!1,i){const s={kind:Pi,tags:[["u",e],["method",t]],created_at:Math.round((new Date).getTime()/1e3),content:""};i&&s.tags.push(["payload",Ua(i)]);const o=await n(s);return(r?Ta:"")+kt.encode(br.encode(JSON.stringify(o)))}async function ka(e,t,n){const r=await _a(e).catch((e=>{throw e}));return await Pa(r,t,n).catch((e=>{throw e}))}async function _a(e){if(!e)throw new Error("Missing token");e=e.replace(Ta,"");const t=mr.decode(kt.decode(e));if(!t||0===t.length||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function Na(e){return!!e.created_at&&Math.round((new Date).getTime()/1e3)-e.created_at<60}function Ma(e){return e.kind===Pi}function za(e,t){const n=e.tags.find((e=>"u"===e[0]));return!!n&&(n.length>0&&n[1]===t)}function Oa(e,t){const n=e.tags.find((e=>"method"===e[0]));return!!n&&(n.length>0&&n[1].toLowerCase()===t.toLowerCase())}function Ua(e){return Ye(ft(br.encode(JSON.stringify(e))))}function Ra(e,t){const n=e.tags.find((e=>"payload"===e[0]));if(!n)return!1;const r=Ua(t);return n.length>0&&n[1]===r}async function Pa(e,t,n,r){if(!Mr(e))throw new Error("Invalid nostr event, signature invalid");if(!Ma(e))throw new Error("Invalid nostr event, kind invalid");if(!Na(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!za(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!Oa(e,n))throw new Error("Invalid nostr event, method tag invalid");if(Boolean(r)&&"object"==typeof r&&Object.keys(r).length>0&&!Ra(e,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const Da={LIBRARIES:{decodeBolt11:i.decode,NostrTools:t},DEFAULT_OPTIONS:{theme:"light",colorMode:!0},BATCH_SIZE:5,REQ_CONFIG:{INITIAL_LOAD_COUNT:15,ADDITIONAL_LOAD_COUNT:20},LOAD_TIMEOUT:1e4,BUFFER_INTERVAL:500,BUFFER_MIN_INTERVAL:100,INFINITE_SCROLL:{ROOT_MARGIN:"400px",THRESHOLD:.1,DEBOUNCE_TIME:500,RETRY_DELAY:500},ZAP_CONFIG:{DEFAULT_LIMIT:1,DEFAULT_COLOR_MODE:!0,ERRORS:{DIALOG_NOT_FOUND:"Zap dialog not found",BUTTON_NOT_FOUND:"Fetch button not found",DECODE_FAILED:"Failed to decode identifier"}},ZAP_AMOUNT_CONFIG:{DEFAULT_COLOR_MODE:!0,THRESHOLDS:[{value:1e4,className:"zap-amount-10k"},{value:5e3,className:"zap-amount-5k"},{value:2e3,className:"zap-amount-2k"},{value:1e3,className:"zap-amount-1k"},{value:500,className:"zap-amount-500"},{value:200,className:"zap-amount-200"},{value:100,className:"zap-amount-100"}],DEFAULT_CLASS:"zap-amount-default",DISABLED_CLASS:""},DIALOG_CONFIG:{DEFAULT_TITLE:"To ",NO_ZAPS_MESSAGE:"No Zaps yet!<br>Send the first Zap!",DEFAULT_NO_ZAPS_DELAY:1500,ZAP_LIST:{INITIAL_BATCH:30,REMAINING_BATCH:30,PROFILE_BATCH:30,MIN_HEIGHT:"100px"}},REQUEST_CONFIG:{METADATA_TIMEOUT:2e4,REQUEST_TIMEOUT:2e3,CACHE_DURATION:3e5},PROFILE_CONFIG:{BATCH_SIZE:20,BATCH_DELAY:100,RELAYS:["wss://relay.nostr.band","wss://purplepag.es","wss://relay.damus.io","wss://nostr.wine","wss://directory.yabu.me"]},BATCH_CONFIG:{REFERENCE_PROCESSOR:{BATCH_SIZE:20,BATCH_DELAY:100},SUPPORTED_EVENT_KINDS:[1,30023,30030,30009,40,42,31990]},BATCH_PROCESSOR_CONFIG:{DEFAULT_BATCH_SIZE:20,DEFAULT_BATCH_DELAY:100,DEFAULT_MAX_CACHE_AGE:18e5,DEFAULT_RELAY_URLS:[],TIMEOUT_DURATION:500}};class Ba{constructor(e,t,n=null){this.identifier=e,this.relayUrls=t,this.isColorModeEnabled=null===n?Da.ZAP_CONFIG.DEFAULT_COLOR_MODE:"true"===String(n).toLowerCase()}static determineColorMode(e){if(!e)return Da.ZAP_CONFIG.DEFAULT_COLOR_MODE;if(!e.hasAttribute("data-zap-color-mode"))return Da.ZAP_CONFIG.DEFAULT_COLOR_MODE;const t=e.getAttribute("data-zap-color-mode");return"true"!==t.toLowerCase()&&"false"!==t.toLowerCase()||"true"===t.toLowerCase()}static fromButton(e){if(!e)throw new Error(Da.ZAP_CONFIG.ERRORS.BUTTON_NOT_FOUND);const t=Ba.determineColorMode(e);return new Ba(e.getAttribute("data-nzv-id"),e.getAttribute("data-relay-urls").split(","),t)}}class ja{constructor(e=1e3){this.cache=new Map,this.maxSize=e,this.accessOrder=new Map}set(e,t){if(this.cache.size>=this.maxSize&&!this.cache.has(e)){const e=this.accessOrder.keys().next().value;this.cache.delete(e),this.accessOrder.delete(e)}return this.cache.set(e,t),this.accessOrder.delete(e),this.accessOrder.set(e,Date.now()),t}get(e){if(!this.cache.has(e))return;const t=this.cache.get(e);return this.accessOrder.set(e,Date.now()),t}has(e){return this.cache.has(e)}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}}class Fa extends ja{#e=new Map;setProfile(e,t){if(!e||!t)return;const n=this.get(e);n&&n._eventCreatedAt&&t._eventCreatedAt&&!(t._eventCreatedAt>n._eventCreatedAt)||(this.set(e,t),this.#t(e,t))}#t(e,t){this.#e.forEach((n=>{try{n(e,t)}catch(e){}}))}subscribe(e){if("function"!=typeof e)return null;const t=Math.random().toString(36).substr(2,9);return this.#e.set(t,e),()=>this.#e.delete(t)}clearSubscriptions(){this.#e.clear()}}class Ha extends ja{#n=new Map;initializeView(e){this.#n.set(e,{isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1,batchProcessing:!1})}getViewState(e){return this.#n.get(e)||this.initializeView(e)}updateViewState(e,t){const n=this.getViewState(e);return this.#n.set(e,{...n,...t}),this.#n.get(e)}getEvents(e){return this.get(e)||[]}setEvents(e,t,n=!1){const r=n?this.getEvents(e):[],i=new Map(t.map((e=>[e.id,e]))),s=[...r.filter((e=>!i.has(e.id))),...t];this.set(e,s)}addEvent(e,t){if(!t?.id)return!1;const n=this.getEvents(e);return!this.#r(n,t)&&(n.push(t),n.sort(((e,t)=>t.created_at-e.created_at)),this.setEvents(e,n,!0),!0)}#r(e,t){return e.some((e=>e.id===t.id||e.kind===t.kind&&e.pubkey===t.pubkey&&e.content===t.content&&e.created_at===t.created_at))}}class $a extends ja{#i=new Map;#s=new Map;async getOrFetch(e,t){const n=this.get(e);if(n)return n;const r=this.#i.get(e);if(r)return r;const i=t().then((t=>(t&&this.set(e,t),this.#i.delete(e),t))).catch((t=>(this.#i.delete(e),null)));return this.#i.set(e,i),i}clearPendingFetches(){this.#i.clear()}setComponent(e,t){this.#s.set(e,t)}getComponent(e){return this.#s.get(e)}clearComponents(){this.#s.clear()}clear(){super.clear(),this.clearPendingFetches(),this.clearComponents()}}class Za extends ja{#o=new Map;#a=new Map;setCached(e,t,n){const r=`${e}:${t}`;this.set(r,{stats:n,timestamp:Date.now()}),this.updateViewStats(e,n)}getCached(e,t){const n=`${e}:${t}`;return this.get(n)}updateViewStats(e,t){t&&this.#o.set(e,{...t,lastUpdate:Date.now()})}getViewStats(e){return this.#o.get(e)}clearViewStats(e){this.#o.delete(e)}setNoZapsState(e,t){this.#a.set(e,t)}hasNoZaps(e){return this.#a.get(e)||!1}clearNoZapsState(e){this.#a.delete(e)}clear(){super.clear(),this.#o.clear(),this.#a.clear()}}class qa extends ja{hasDecoded(e){return this.has(e)}setDecoded(e,t){this.set(e,t)}getDecoded(e){return this.get(e)}}class Va extends ja{initializeLoadState(e){const t={isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1,currentCount:0};return this.set(e,t),t}getLoadState(e){return this.has(e)?this.get(e):this.initializeLoadState(e)}updateLoadState(e,t){const n={...this.getLoadState(e),...t};return this.set(e,n),n}canLoadMore(e){const t=this.getLoadState(e);return t&&!t.isLoading&&t.lastEventTime}updateLoadProgress(e,t){const n=this.getLoadState(e);return n.currentCount+=t,this.updateLoadState(e,{currentCount:n.currentCount}),n.currentCount}}class Ga extends ja{setZapInfo(e,t){this.set(e,t)}getZapInfo(e){return this.get(e)}clearZapInfo(e){this.delete(e)}}class Wa extends Fa{setImage(e,t){e&&t&&this.set(e,{image:t,timestamp:Date.now()})}getImage(e){const t=this.get(e);return t?.image}hasImage(e){return this.has(e)}clearExpired(e=36e5){const t=Date.now();for(const[n,r]of this.cache.entries())t-r.timestamp>e&&this.delete(n)}}class Ya extends Fa{#c=new Map;setNip05(e,t){e&&this.set(e,{value:t,timestamp:Date.now(),verified:!0})}getNip05(e){const t=this.get(e);return t?.value}setPendingVerification(e,t){this.#c.set(e,t)}getPendingVerification(e){return this.#c.get(e)}deletePendingVerification(e){this.#c.delete(e)}clearPendingVerifications(){this.#c.clear()}clear(){super.clear(),this.clearPendingVerifications()}}class Ka{static#l=null;#u=null;#h={};constructor(){if(Ka.#l)return Ka.#l;this.profileCache=new Fa,this.zapEventCache=new Ha,this.referenceCache=new $a,this.statsCache=new Za,this.decodedCache=new qa,this.loadStateCache=new Va,this.zapInfoCache=new Ga,this.imageCache=new Wa,this.nip05Cache=new Ya,this.nip05PendingCache=new ja;this.#h=["zapInfo","uiComponent","decoded","nip05","nip05PendingFetches","zapLoadStates","imageCache","isEventIdentifier"].reduce(((e,t)=>(e[t]=new ja,e)),{}),this.viewStats=new Map,this.viewStates=new Map,Ka.#l=this}setProfile(e,t){return this.profileCache.setProfile(e,t)}getProfile(e){return this.profileCache.get(e)}subscribeToProfileUpdates(e){return this.profileCache.subscribe(e)}initializeZapView(e){return this.zapEventCache.initializeView(e)}getZapEvents(e){return this.zapEventCache.getEvents(e)}setZapEvents(e,t,n){return this.zapEventCache.setEvents(e,t,n)}addZapEvent(e,t){return this.zapEventCache.addEvent(e,t)}getZapViewState(e){return this.zapEventCache.getViewState(e)}updateZapViewState(e,t){return this.zapEventCache.updateViewState(e,t)}setReference(e,t){return this.referenceCache.set(e,t)}getReference(e){return this.referenceCache.get(e)}getOrFetchReference(e,t){return this.referenceCache.getOrFetch(e,t)}getReferenceComponent(e){return this.referenceCache.getComponent(e)}setReferenceComponent(e,t){return this.referenceCache.setComponent(e,t)}getCachedStats(e,t){return this.statsCache.getCached(e,t)}updateStatsCache(e,t,n){this.statsCache.setCached(e,t,n),this.statsCache.updateViewStats(e,n)}getViewStats(e){return this.statsCache.getViewStats(e)}setNoZapsState(e,t){return this.statsCache.setNoZapsState(e,t)}hasNoZaps(e){return this.statsCache.hasNoZaps(e)}async processCachedData(e,t){this.setRelayUrls(t.relayUrls);const n=this.getZapEvents(e),r=n.some((e=>this.getReference(e.id)));return{stats:(await Promise.all([this.getCachedStats(e,t.identifier)]))[0],hasEnoughCachedEvents:n.length>=Da.REQ_CONFIG.INITIAL_LOAD_COUNT,hasReferences:r}}hasDecoded(e){return this.decodedCache.hasDecoded(e)}setDecoded(e,t){return this.decodedCache.setDecoded(e,t)}getDecoded(e){return this.decodedCache.getDecoded(e)}initializeLoadState(e){return this.loadStateCache.initializeLoadState(e)}getLoadState(e){return this.loadStateCache.getLoadState(e)}updateLoadState(e,t){return this.loadStateCache.updateLoadState(e,t)}canLoadMore(e){return this.loadStateCache.canLoadMore(e)}updateLoadProgress(e,t){return this.loadStateCache.updateLoadProgress(e,t)}setZapInfo(e,t){return this.zapInfoCache.setZapInfo(e,t)}getZapInfo(e){return this.zapInfoCache.getZapInfo(e)}clearZapInfo(e){return this.zapInfoCache.clearZapInfo(e)}setImageCache(e,t){return this.imageCache.setImage(e,t)}getImageCache(e){return this.imageCache.getImage(e)}hasImageCache(e){return this.imageCache.hasImage(e)}setNip05(e,t){return this.nip05Cache.setNip05(e,t)}getNip05(e){return this.nip05Cache.getNip05(e)}setNip05PendingFetch(e,t){this.nip05Cache.setPendingVerification(e,t)}getNip05PendingFetch(e){return this.nip05Cache.getPendingVerification(e)}deleteNip05PendingFetch(e){this.nip05Cache.deletePendingVerification(e)}getOrCreateViewState(e,t={}){return this.viewStates.has(e)||this.viewStates.set(e,{currentStats:null,...t}),this.viewStates.get(e)}getViewState(e){return this.getOrCreateViewState(e)}updateViewState(e,t){const n=this.getOrCreateViewState(e);return this.viewStates.set(e,{...n,...t}),this.viewStates.get(e)}setCacheItem(e,t,n){const r=this.#h[e];if(r&&void 0!==t){return r.set(t,n)}return null}getCacheItem(e,t){const n=this.#h[e];return n&&void 0!==t?n.get(t):null}setRelayUrls(e){this.#u=e}getRelayUrls(){return this.#u}clearAll(){this.profileCache.clear(),this.profileCache.clearSubscriptions(),this.zapEventCache.clear(),this.referenceCache.clear(),this.referenceCache.clearPendingFetches(),this.referenceCache.clearComponents(),this.statsCache.clear(),this.decodedCache.clear(),this.loadStateCache.clear(),this.zapInfoCache.clear(),this.imageCache.clear(),this.nip05Cache.clear(),this.nip05Cache.clearPendingVerifications(),Object.values(this.#h).forEach((e=>e.clear())),this.viewStats.clear(),this.viewStates.clear()}}const Qa=new Ka,Ja="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMDYuMzMgMjA2LjMzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICA8ZGVmcz4KICAgICAgPHN0eWxlPgogICAgICAgICAuY2xzLTEgewogICAgICAgICAgICBmaWxsOiBub25lOwogICAgICAgICB9CgogICAgICAgICAuY2xzLTIgewogICAgICAgICAgICBmaWxsOiAjZmZmOwogICAgICAgICB9CgogICAgICAgICAuY2xzLTMgewogICAgICAgICAgICBmaWxsOiAjNjY2OwogICAgICAgICB9CiAgICAgIDwvc3R5bGU+CiAgIDwvZGVmcz4KICAgPHBhdGggY2xhc3M9ImNscy0yIgogICAgICBkPSJtMjA2LjMzIDEzNC4zOWMwIDIwLjcxIDAgMzEuMDctMy41MyA0Mi4yMi00LjQzIDEyLjE3LTE0LjAyIDIxLjc2LTI2LjE5IDI2LjE5LTExLjE1IDMuNTMtMjEuNSAzLjUzLTQyLjIyIDMuNTNoLTYyLjQ2Yy0yMC43MSAwLTMxLjA2IDAtNDIuMjEtMy41My0xMi4xNy00LjQzLTIxLjc2LTE0LjAyLTI2LjE5LTI2LjE5LTMuNTMtMTEuMTUtMy41My0yMS41LTMuNTMtNDIuMjJ2LTYyLjQ2YzAtMjAuNzEgMC0zMS4wNyAzLjUzLTQyLjIyIDQuNDMtMTIuMTcgMTQuMDItMjEuNzYgMjYuMTktMjYuMTkgMTEuMTUtMy41MiAyMS41LTMuNTIgNDIuMjEtMy41Mmg2Mi40NmMyMC43MSAwIDMxLjA3IDAgNDIuMjIgMy41MiAxMi4xNyA0LjQzIDIxLjc2IDE0LjAyIDI2LjE5IDI2LjE5IDMuNTMgMTEuMTUgMy41MyAyMS41IDMuNTMgNDIuMjJ6IiAvPgogICA8cGF0aCBjbGFzcz0iY2xzLTMiCiAgICAgIGQ9Im0xODUuOTggOTEuMXY4My4yM2MwIDMuMTMtMi41NCA1LjY3LTUuNjcgNS42N2gtNjguMDRjLTMuMTMgMC01LjY3LTIuNTQtNS42Ny01LjY3di0xNS41YzAuMzEtMTkgMi4zMi0zNy4yIDYuNTQtNDUuNDggMi41My00Ljk4IDYuNy03LjY5IDExLjQ5LTkuMTQgOS4wNS0yLjcyIDI0LjkzLTAuODYgMzEuNjctMS4xOCAwIDAgMjAuMzYgMC44MSAyMC4zNi0xMC43MiAwLTkuMjgtOS4xLTguNTUtOS4xLTguNTUtMTAuMDMgMC4yNi0xNy42Ny0wLjQyLTIyLjYyLTIuMzctOC4yOS0zLjI2LTguNTctOS4yNC04LjYtMTEuMjQtMC40MS0yMy4xLTM0LjQ3LTI1Ljg3LTY0LjQ4LTIwLjE0LTMyLjgxIDYuMjQgMC4zNiA1My4yNyAwLjM2IDExNi4wNXY4LjM4Yy0wLjA2IDMuMDgtMi41NSA1LjU3LTUuNjUgNS41N2gtMzMuNjljLTMuMTMgMC01LjY3LTIuNTQtNS42Ny01LjY3di0xNDMuOTVjMC0zLjEzIDIuNTQtNS42NyA1LjY3LTUuNjdoMzEuNjdjMy4xMyAwIDUuNjcgMi41NCA1LjY3IDUuNjcgMCA0LjY1IDUuMjMgNy4yNCA5LjAxIDQuNTMgMTEuMzktOC4xNiAyNi4wMS0xMi41MSA0Mi4zNy0xMi41MSAzNi42NSAwIDY0LjM2IDIxLjM2IDY0LjM2IDY4LjY5em0tNjAuODQtMTYuODljMC02LjctNS40My0xMi4xMy0xMi4xMy0xMi4xM3MtMTIuMTMgNS40My0xMi4xMyAxMi4xMyA1LjQzIDEyLjEzIDEyLjEzIDEyLjEzIDEyLjEzLTUuNDMgMTIuMTMtMTIuMTN6IiAvPgo8L3N2Zz4=",Xa=e=>"string"==typeof e&&e.length>0,ec=e=>{try{return window.NostrTools.nip19.decode(e)}catch(e){return null}},tc=(e,t,n)=>{const r={npub:()=>({kinds:[9735],"#p":[t]}),note:()=>({kinds:[9735],"#e":[t]}),nprofile:()=>({kinds:[9735],"#p":[t.pubkey]}),nevent:()=>({kinds:[9735],"#e":[t.id]})}[e];if(!r)return null;const i=r();return i.limit=n?Da.REQ_CONFIG.ADDITIONAL_LOAD_COUNT:Da.REQ_CONFIG.INITIAL_LOAD_COUNT,n&&(i.until=n),{req:i}};function nc(e,t=null){const n=`${e}:${t}`;if(Qa.hasDecoded(n))return Qa.getDecoded(n);if(!Xa(e))throw new Error(Da.ZAP_CONFIG.ERRORS.DECODE_FAILED);const r=ec(e);if(!r)return null;const i=tc(r.type,r.data,t);return i&&Qa.setDecoded(n,i),i}function rc(e){return e?.display_name||e?.name||"nameless"}async function ic(e,t){if(!e||!t)return null;try{const n=await window.NostrTools.nip05.queryProfile(e);return n?.pubkey===t?e:null}catch(e){return null}}function sc(e){return(new Intl.NumberFormat).format(e)}function oc(e){if(!e||"string"!=typeof e)return"unknown";try{return`${window.NostrTools.nip19.decode(e).type.toLowerCase()}1${e.slice(5,11)}...${e.slice(-4)}`}catch(e){return"unknown"}}function ac(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function cc(e){try{return window.NostrTools.nip19.npubEncode(e)}catch(e){return null}}function lc(e){if(!e||"string"!=typeof e)return!1;const t=`isEventIdentifier:${e}`,n=Qa.getCacheItem("isEventIdentifier",t);if(void 0!==n)return n;const r=e.startsWith("note1")||e.startsWith("nevent1");return Qa.setCacheItem("isEventIdentifier",t,r),r}async function uc(e){const{pubkey:t,content:n}=function(e){const t=e.tags.find((e=>"description"===e[0]))?.[1];if(!t)return{pubkey:null,content:""};try{const e=hc(t);let n;try{n=JSON.parse(e)}catch{const t=e.match(/"pubkey"\s*:\s*"([^"]+)"|"content"\s*:\s*"([^"]+)"/g);if(!t)throw new Error("Invalid JSON structure");n={},t.forEach((e=>{const[t,r]=e.split(":").map((e=>e.trim().replace(/"/g,"")));n[t]=r}))}let r=null;n.pubkey&&(r="string"==typeof n.pubkey?n.pubkey:String(n.pubkey));return{pubkey:r,content:"string"==typeof n.content?n.content.trim():""}}catch(e){return{pubkey:null,content:""}}}(e),r=await async function(e){const t=e.tags.find((e=>"bolt11"===e[0].toLowerCase()))?.[1];if(!t)return"Amount: Unknown";try{const e=window.decodeBolt11(t),n=e.sections.find((e=>"amount"===e.name))?.value;return n?`${sc(Math.floor(n/1e3))} sats`:"Amount: Unknown"}catch(e){return"Amount: Unknown"}}(e);return{pubkey:t,content:n,satsText:r}}function hc(e){return e.replace(/[\u0000-\u001F\u007F-\u009F]/g,"").replace(/\\\\/g,"\\").replace(/\\(?!(["\\\/bfnrt]|u[0-9a-fA-F]{4}))/g,"").replace(/\\+(["\\/bfnrt])/g,"\\$1").replace(/\\u(?![0-9a-fA-F]{4})/g,"")}class dc{constructor(e){this.root=e}displayStats(e){requestAnimationFrame((()=>{const t=this.root?.querySelector(".zap-stats");if(t)try{let n;n=e?e.skeleton?this.#d():e.error?this.createTimeoutStats():this.createNormalStats(e):this.createTimeoutStats(),t.innerHTML=n}catch(e){t.innerHTML=this.createTimeoutStats()}}))}#d(){return'\n      <div class="stats-item">Total Count</div>\n      <div class="stats-item"><span class="number skeleton">...</span></div>\n      <div class="stats-item">times</div>\n      <div class="stats-item">Total Amount</div>\n      <div class="stats-item"><span class="number skeleton">...</span></div>\n      <div class="stats-item">sats</div>\n      <div class="stats-item">Max Amount</div>\n      <div class="stats-item"><span class="number skeleton">...</span></div>\n      <div class="stats-item">sats</div>\n    '}createTimeoutStats(){return'\n      <div class="stats-item">Total Count</div>\n      <div class="stats-item"><span class="number text-muted">nostr.band</span></div>\n      <div class="stats-item">times</div>\n      <div class="stats-item">Total Amount</div>\n      <div class="stats-item"><span class="number text-muted">Stats</span></div>\n      <div class="stats-item">sats</div>\n      <div class="stats-item">Max Amount</div>\n      <div class="stats-item"><span class="number text-muted">Unavailable</span></div>\n      <div class="stats-item">sats</div>\n    '}createNormalStats(e){return`\n      <div class="stats-item">Total Count</div>\n      <div class="stats-item"><span class="number">${sc(e.count)}</span></div>\n      <div class="stats-item">times</div>\n      <div class="stats-item">Total Amount</div>\n      <div class="stats-item"><span class="number">${sc(Math.floor(e.msats/1e3))}</span></div>\n      <div class="stats-item">sats</div>\n      <div class="stats-item">Max Amount</div>\n      <div class="stats-item"><span class="number">${sc(Math.floor(e.maxMsats/1e3))}</span></div>\n      <div class="stats-item">sats</div>\n    `}}class fc{constructor(e={}){this._validateOptions(e),this._initializeProperties(e)}_validateOptions(e){if(!e.pool?.ensureRelay)throw new Error("Invalid pool object: ensureRelay method is required")}_initializeProperties(e){this.pool=e.pool,this.batchSize=e.batchSize||Da.BATCH_PROCESSOR_CONFIG.DEFAULT_BATCH_SIZE,this.batchDelay=e.batchDelay||Da.BATCH_PROCESSOR_CONFIG.DEFAULT_BATCH_DELAY,this.relayUrls=e.relayUrls||Da.BATCH_PROCESSOR_CONFIG.DEFAULT_RELAY_URLS,this.batchQueue=new Set,this.pendingFetches=new Map,this.resolvers=new Map,this.processingItems=new Set,this.batchTimer=null,this.eventCache=new Map,this.maxCacheAge=e.maxCacheAge||Da.BATCH_PROCESSOR_CONFIG.DEFAULT_MAX_CACHE_AGE}getOrCreateFetchPromise(e){if(this.pendingFetches.has(e))return this.pendingFetches.get(e);const t=new Promise((t=>{this.resolvers.set(e,t)}));return this.pendingFetches.set(e,t),this.batchQueue.add(e),this._scheduleBatchProcess(),t}_scheduleBatchProcess(){this.batchTimer||(this.batchTimer=setTimeout((()=>{this.batchTimer=null,this._processBatchQueue()}),this.batchDelay))}async _processBatchQueue(){if(0===this.batchQueue.size)return;const e=this._getBatchItems();await this._processBatch(e),this.batchQueue.size>0&&this._scheduleBatchProcess()}_getBatchItems(){const e=Array.from(this.batchQueue).slice(0,this.batchSize);return e.forEach((e=>{this.batchQueue.delete(e),this.processingItems.add(e)})),e}async _processBatch(e){try{await this.onBatchProcess(e)}catch(t){this._handleBatchError(e,t)}finally{this._cleanupBatchItems(e)}}_handleBatchError(e,t){e.forEach((e=>this.resolveItem(e,null)))}_cleanupBatchItems(e){e.forEach((e=>{this.processingItems.delete(e),this.pendingFetches.delete(e),this.resolvers.delete(e)}))}resolveItem(e,t){const n=this.resolvers.get(e);n&&(n(t),this.resolvers.delete(e))}async onBatchProcess(e){throw new Error("onBatchProcess must be implemented by derived class")}onBatchError(e,t){e.forEach((e=>this.resolveItem(e,null)))}_cleanup(e,t,n,r){clearTimeout(e),t&&t.close(),n.forEach((e=>{!r.has(e)&&this.resolvers.has(e)&&this.resolveItem(e,null)}))}_getSubscriptionPool(){return this.pool}async _createSubscriptionPromise(e,t,n,r){if(t?.length)return new Promise((i=>{const s=new Set,o=Da.BATCH_PROCESSOR_CONFIG.TIMEOUT_DURATION;let a,c,l=!1;const u=()=>{l||(l=!0,a&&clearTimeout(a),c&&c.close(),e.forEach((e=>{s.has(e)||this.resolveItem(e,null)})),i())};c=this.pool.subscribeMany(t,n,{onevent:t=>{try{l||(r(t,s),s.size===e.length&&u())}catch(e){}},oneose:()=>{setTimeout(u,100)},onerror:e=>{}}),a=setTimeout((()=>{l||u()}),o)}));e.forEach((e=>this.resolveItem(e,null)))}setRelayUrls(e){this.relayUrls=Array.isArray(e)?e:[]}getCachedItem(e){const t=this.eventCache.get(e);return this._isValidCache(t)?t.event:(this.eventCache.delete(e),null)}_isValidCache(e){return!!e&&Date.now()-e.timestamp<=this.maxCacheAge}setCachedItem(e,t){this.eventCache.set(e,{event:t,timestamp:Date.now()})}}class pc extends fc{constructor(e={}){super(e)}async onBatchProcess(e){if(!e?.length)return;const t=[{ids:e.slice(0,this.batchSize)}];await this._createSubscriptionPromise(e,this.relayUrls,t,((t,n)=>{if(e.includes(t.id)){const e=this.getCachedItem(t.id);(!e||t.created_at>e.created_at)&&(this.setCachedItem(t.id,t),this.resolveItem(t.id,t),n.add(t.id))}}))}}class gc extends fc{constructor(e={}){super(e)}_parseAtagValue(e){const t=e.split(":");return 3!==t.length?null:{kind:parseInt(t[0]),pubkey:t[1],identifier:t[2]}}async onBatchProcess(e){if(!e?.length)return;const t=[],n={kinds:[],authors:[],"#d":[]};if(e.slice(0,this.batchSize).forEach((e=>{const r=this._parseAtagValue(e);r?(n.kinds.push(r.kind),n.authors.push(r.pubkey),n["#d"].push(r.identifier),t.push(e)):this.resolveItem(e,null)})),0===t.length)return;const r=[n];await this._createSubscriptionPromise(t,this.relayUrls,r,((e,n)=>{const r=t.find((t=>{const n=this._parseAtagValue(t);return n&&e.kind===n.kind&&e.pubkey===n.pubkey&&e.tags.some((e=>"d"===e[0]&&e[1]===n.identifier))}));if(r){const t=this.getCachedItem(r);(!t||e.created_at>t.created_at)&&(this.setCachedItem(r,e),this.resolveItem(r,e),n.add(r))}}))}}class yc extends fc{constructor(e={}){const{simplePool:t,config:n}=e;super({pool:t,batchSize:n.BATCH_SIZE||Da.PROFILE_CONFIG.BATCH_SIZE,batchDelay:n.BATCH_DELAY||Da.PROFILE_CONFIG.BATCH_DELAY,relayUrls:n.RELAYS||Da.PROFILE_CONFIG.RELAYS,maxCacheAge:Da.BATCH_PROCESSOR_CONFIG.DEFAULT_MAX_CACHE_AGE}),this.config=n}async onBatchProcess(e){if(!this.config.RELAYS?.length)throw new Error("No relays configured for profile fetch");const t=e.filter((e=>{const t=this.getCachedItem(e);return!t||(this.resolveItem(e,t),!1)}));if(0===t.length)return;const n=[{kinds:[0],authors:t}],r=new Map,i=(e,t)=>{const n=r.get(e.pubkey);(!n||e.created_at>n.created_at)&&(r.set(e.pubkey,e),this.setCachedItem(e.pubkey,e)),t.add(e.pubkey)};try{await this._createSubscriptionPromise(t,this.config.RELAYS,n,i),t.forEach((e=>{const t=r.get(e);this.resolveItem(e,t||null)}))}catch(t){this.onBatchError(e,t)}}}var wc=Symbol("verified");function mc(e){if(!(e instanceof Object))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}new TextDecoder("utf-8");var bc=new TextEncoder;function Ec(e){-1===e.indexOf("://")&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),("80"===t.port&&"ws:"===t.protocol||"443"===t.port&&"wss:"===t.protocol)&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}var vc=class{value;next=null;prev=null;constructor(e){this.value=e}},Ic=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){const t=new vc(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const e=this.first;return this.first=e.next,e.value}};function Ac(e){return Ye(ft(bc.encode(function(e){if(!mc(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}(e))))}var Cc=new class{generateSecretKey(){return $e.utils.randomPrivateKey()}getPublicKey(e){return Ye($e.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=Ye($e.getPublicKey(t)),n.id=Ac(n),n.sig=Ye($e.sign(Ac(n),t)),n[wc]=!0,n}verifyEvent(e){if("boolean"==typeof e[wc])return e[wc];const t=Ac(e);if(t!==e.id)return e[wc]=!1,!1;try{const n=$e.verify(e.sig,t,e.pubkey);return e[wc]=n,n}catch(t){return e[wc]=!1,!1}}},xc=(Cc.generateSecretKey,Cc.getPublicKey,Cc.finalizeEvent,Cc.verifyEvent);function Sc(e,t){if(e.ids&&-1===e.ids.indexOf(t.id))return!1;if(e.kinds&&-1===e.kinds.indexOf(t.kind))return!1;if(e.authors&&-1===e.authors.indexOf(t.pubkey))return!1;for(let n in e)if("#"===n[0]){let r=e[`#${n.slice(1)}`];if(r&&!t.tags.find((([e,t])=>e===n.slice(1)&&-1!==r.indexOf(t))))return!1}return!(e.since&&t.created_at<e.since)&&!(e.until&&t.created_at>e.until)}async function Tc(){return new Promise((e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()}))}var Lc,kc=e=>(e[wc]=!0,!0),_c=class{url;_connected=!1;onclose=null;onnotice=e=>{};_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new Ic;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(e,t){this.url=Ec(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket}static async connect(e,t){const n=new _c(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((e,t)=>{this.connectionTimeoutHandle=setTimeout((()=>{t("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(e){return void t(e)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=e=>{t(e.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;!1!==this.handleNext();)await Tc();this.queueRunning=!1}handleNext(){const e=this.incomingMessageQueue.dequeue();if(!e)return!1;const t=function(e){let t=e.slice(0,22).indexOf('"EVENT"');if(-1===t)return null;let n=e.slice(t+7+1).indexOf('"');if(-1===n)return null;let r=t+7+1+n,i=e.slice(r+1,80).indexOf('"');if(-1===i)return null;let s=r+1+i;return e.slice(r+1,s)}(e);if(t){const n=this.openSubs.get(t);if(!n)return;const r=function(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,i=e.slice(r).indexOf('"')+r+1;return e.slice(i,i+64)}(e,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let t=JSON.parse(e);switch(t[0]){case"EVENT":{const e=this.openSubs.get(t[1]),n=t[2];return void(this.verifyEvent(n)&&function(e,t){for(let n=0;n<e.length;n++)if(Sc(e[n],t))return!0;return!1}(e.filters,n)&&e.onevent(n))}case"COUNT":{const e=t[1],n=t[2],r=this.openCountRequests.get(e);return void(r&&(r.resolve(n.count),this.openCountRequests.delete(e)))}case"EOSE":{const e=this.openSubs.get(t[1]);if(!e)return;return void e.receivedEose()}case"OK":{const e=t[1],n=t[2],r=t[3],i=this.openEventPublishes.get(e);return void(i&&(n?i.resolve(r):i.reject(new Error(r)),this.openEventPublishes.delete(e)))}case"CLOSED":{const e=t[1],n=this.openSubs.get(e);if(!n)return;return n.closed=!0,void n.close(t[2])}case"NOTICE":return void this.onnotice(t[1]);case"AUTH":return this.challenge=t[1],void this._onauth?.(t[1])}}catch(e){return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(e)}))}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const t=await e(function(e,t){return{kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}(this.url,this.challenge)),n=new Promise(((e,n)=>{this.openEventPublishes.set(t.id,{resolve:e,reject:n})}));return this.send('["AUTH",'+JSON.stringify(t)+"]"),n}async publish(e){const t=new Promise(((t,n)=>{this.openEventPublishes.set(e.id,{resolve:t,reject:n})}));return this.send('["EVENT",'+JSON.stringify(e)+"]"),setTimeout((()=>{const t=this.openEventPublishes.get(e.id);t&&(t.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))}),this.publishTimeout),t}async count(e,t){this.serial++;const n=t?.id||"count:"+this.serial,r=new Promise(((e,t)=>{this.openCountRequests.set(n,{resolve:e,reject:t})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||"sub:"+this.serial,r=new Nc(this,n,e,t);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},Nc=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(e,t,n,r){this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||e.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(e=>{})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(e="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(e)}},Mc=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(e){this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation}async ensureRelay(e,t){e=Ec(e);let n=this.relays.get(e);return n||(n=new _c(e,{verifyEvent:this.trustedRelayURLs.has(e)?kc:this.verifyEvent,websocketImplementation:this._WebSocket}),t?.connectionTimeout&&(n.connectionTimeout=t.connectionTimeout),this.relays.set(e,n)),await n.connect(),n}close(e){e.map(Ec).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(e,t,n){return this.subscribeManyMap(Object.fromEntries(e.map((e=>[e,t]))),n)}subscribeManyMap(e,t){this.trackRelays&&(t.receivedEvent=(e,t)=>{let n=this.seenOn.get(t);n||(n=new Set,this.seenOn.set(t,n)),n.add(e)});const n=new Set,r=[],i=Object.keys(e).length,s=[];let o=e=>{s[e]=!0,s.filter((e=>e)).length===i&&(t.oneose?.(),o=()=>{})};const a=[];let c=(e,n)=>{o(e),a[e]=n,a.filter((e=>e)).length===i&&(t.onclose?.(a),c=()=>{})};const l=e=>{if(t.alreadyHaveEvent?.(e))return!0;const r=n.has(e);return n.add(e),r},u=Promise.all(Object.entries(e).map((async(e,n,i)=>{if(i.indexOf(e)!==n)return void c(n,"duplicate url");let s,[a,u]=e;a=Ec(a);try{s=await this.ensureRelay(a,{connectionTimeout:t.maxWait?Math.max(.8*t.maxWait,t.maxWait-1e3):void 0})}catch(e){return void c(n,e?.message||String(e))}let h=s.subscribe(u,{...t,oneose:()=>o(n),onclose:e=>c(n,e),alreadyHaveEvent:l,eoseTimeout:t.maxWait});r.push(h)})));return{async close(){await u,r.forEach((e=>{e.close()}))}}}subscribeManyEose(e,t,n){const r=this.subscribeMany(e,t,{...n,oneose(){r.close()}});return r}async querySync(e,t,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(e,[t],{...n,onevent(e){i.push(e)},onclose(e){r(i)}})}))}async get(e,t,n){t.limit=1;const r=await this.querySync(e,t,n);return r.sort(((e,t)=>t.created_at-e.created_at)),r[0]||null}publish(e,t){return e.map(Ec).map((async(e,n,r)=>{if(r.indexOf(e)!==n)return Promise.reject("duplicate url");let i=await this.ensureRelay(e);return i.publish(t).then((e=>{if(this.trackRelays){let e=this.seenOn.get(t.id);e||(e=new Set,this.seenOn.set(t.id,e)),e.add(i)}return e}))}))}listConnectionStatus(){const e=new Map;return this.relays.forEach(((t,n)=>e.set(n,t.connected))),e}destroy(){this.relays.forEach((e=>e.close())),this.relays=new Map}};try{Lc=WebSocket}catch{}var zc=class extends Mc{constructor(){super({verifyEvent:xc,websocketImplementation:Lc})}};class Oc{static instance=null;#f;#p;#g=!0;#y;constructor(){return Oc.instance?Oc.instance:(this.#w(),Oc.instance=this,this)}#w(){if(this.#f=Da.PROFILE_CONFIG,this.#p=new zc,!this.#p?.ensureRelay)throw new Error("Failed to initialize SimplePool");this.#y=new yc({simplePool:this.#p,config:{...this.#f,RELAYS:this.#f.RELAYS||[]}})}get isInitialized(){return this.#g}async fetchProfiles(e){if(!Array.isArray(e)||0===e.length)return[];const t=Date.now(),n=new Array(e.length),r=e.reduce(((e,r,i)=>{const s=Qa.getProfile(r);return this.#m(s,t)?n[i]=s:e.push({index:i,pubkey:r}),e}),[]);return r.length>0&&await this.#b(r,n,e),n}async processBatchProfiles(e){const t=this.#E(e);if(0!==t.length)try{await Promise.all([this.fetchProfiles(t),...t.map((e=>this.verifyNip05Async(e)))])}catch(e){}}async verifyNip05Async(e){const t=Qa.getNip05(e);if(void 0!==t)return t;const n=Qa.getNip05PendingFetch(e);if(n)return n;const r=this.#v(e);return Qa.setNip05PendingFetch(e,r),r}getNip05(e){return Qa.getNip05(e)}clearCache(){Qa.clearAll(),this.#y.clearPendingFetches()}#m(e,t){return e&&e._lastUpdated&&t-e._lastUpdated<18e5}#E(e){return[...new Set(e?.map((e=>e?.pubkey))?.filter((e=>e&&"string"==typeof e&&64===e.length)))]||[]}async#b(e,t,n){if(!e.length)return;const r=Date.now(),i=e.filter((({pubkey:e})=>e&&"string"==typeof e&&64===e.length));if(0===i.length)return;const s=await Promise.all(i.map((({pubkey:e})=>this.#I(e,r))));i.forEach((({index:e},r)=>{e>=0&&e<t.length&&(t[e]=s[r],n[e]&&Qa.setProfile(n[e],s[r]))}))}async#I(e,t){if(!e||"string"!=typeof e||64!==e.length)return this.#A();try{const n={kinds:[0],authors:[e],limit:1},r=await this.#y.getOrCreateFetchPromise(e,n);if(!r?.content)return this.#A();let i;try{i=JSON.parse(r.content)}catch(e){return this.#A()}return{...i,name:rc(i)||"nameless",_lastUpdated:t,_eventCreatedAt:r.created_at}}catch(e){return this.#A()}}async#v(e){try{const[t]=await this.fetchProfiles([e]);if(!t?.nip05)return Qa.setNip05(e,null),null;const n=await Promise.race([ic(t.nip05,e),new Promise(((e,t)=>setTimeout((()=>t(new Error("NIP-05 timeout"))),5e3)))]);if(!n)return Qa.setNip05(e,null),null;const r=ac(n.startsWith("_@")?n.slice(1):n);return Qa.setNip05(e,r),r}catch(t){return Qa.setNip05(e,null),null}finally{Qa.deleteNip05PendingFetch(e)}}#A(){return{name:"anonymous",display_name:"anonymous"}}}const Uc=new Oc;class Rc{async loadAndUpdate(e,t){if(e)try{const n=t.querySelector(".sender-name"),r=t.querySelector(".zap-placeholder-name"),i=t.querySelector(".sender-icon"),s=i?.querySelector(".zap-placeholder-icon"),o=t.querySelector(".sender-pubkey");let a=Qa.getProfile(e);const c=a?rc(a)||"nameless":"anonymous",l=a?.picture?function(e){if(!e||"string"!=typeof e)return null;try{const t=new URL(e);return["http:","https:"].includes(t.protocol)?t.href:null}catch{return null}}(a.picture):null;this.#C(r,n,c),this.#x(s,i,l,c),this.#S(o,e)}catch(e){this.#T(t)}}#C(e,t,n){e?e.replaceWith(Object.assign(document.createElement("span"),{className:"sender-name",textContent:n})):t&&(t.textContent=n)}#L(e,t="anonymous user's icon"){const n=`https://robohash.org/${e}.png?set=set5&bgset=bg2&size=128x128`,r=Qa.getImageCache(n),i=Object.assign(document.createElement("img"),{alt:t,loading:"lazy",className:"profile-icon"});if(r)return i.src=n,i;const s=new Image;return s.onerror=()=>{i.src=Ja,Qa.setImageCache(n,Ja)},s.onload=()=>{Qa.setImageCache(n,s)},s.src=n,i.src=n,i}#x(e,t,n,r){if(e&&t){const i=n=>{e.remove();const i=t.querySelector("img"),s=t.querySelector("a");i&&i.remove(),s&&s.remove();const o="robohash"===n?this.#L(t.closest("[data-pubkey]")?.dataset.pubkey,`${ac(r)}'s icon`):Object.assign(document.createElement("img"),{src:n,alt:`${ac(r)}'s icon`,loading:"lazy",className:"profile-icon"}),a=t.closest("[data-pubkey]")?.dataset.pubkey;if(a){const e=function(e,t=[]){try{return window.NostrTools.nip19.nprofileEncode({pubkey:e,relays:t})}catch(e){return null}}(a),n=Object.assign(document.createElement("a"),{href:`https://njump.me/${e}`,target:"_blank",rel:"noopener noreferrer"});n.appendChild(o),t.appendChild(n)}else t.appendChild(o)};if(n){const e=new Image;e.onload=()=>{Qa.setImageCache(n,e),i(n)},e.onerror=()=>{i("robohash")},e.src=n}else i("robohash")}}#S(e,t){if(e&&!e.getAttribute("data-nip05-updated")){const n=Uc.getNip05(t);n?(e.textContent=n,e.setAttribute("data-nip05-updated","true")):Uc.verifyNip05Async(t).then((t=>{t&&(e.textContent=t,e.setAttribute("data-nip05-updated","true"))}))}}#T(e){const t=e.querySelector(".zap-placeholder-icon");if(t){const n=t.parentElement,r=e.closest("[data-pubkey]")?.dataset.pubkey;t.remove(),n.appendChild(this.#L(r))}}async updateProfileElement(e,t){if(!e||!t)return;const n=e.querySelector(".sender-icon img, .zap-placeholder-icon");if(n)if(t.picture){const r=document.createElement("img");r.alt=t.name||"Profile Picture",r.width=32,r.height=32,r.className="profile-icon",r.onerror=()=>{const n=e.getAttribute("data-pubkey");if(n){const e=this.#L(n,t.name||"anonymous user");r.parentElement&&r.parentElement.replaceChild(e,r)}},r.src=t.picture,n.parentElement&&n.parentElement.replaceChild(r,n)}else{const r=e.getAttribute("data-pubkey");if(r){const e=this.#L(r,t.name||"anonymous user");n.parentElement&&n.parentElement.replaceChild(e,n)}}const r=e.querySelector(".sender-name, .zap-placeholder-name");if(r&&(r.textContent=t.display_name||t.name||"anonymous",r.className="sender-name"),t.nip05){const t=e.getAttribute("data-pubkey");if(t){const n=e.querySelector('[data-nip05-target="true"]');n&&await this.updateNip05Display(t,n)}}}}class Pc{static#k={1:"content",30023:"title",30030:"title",30009:"name",40:"content",42:"name",31990:"alt"};static#_={UI_COMPONENTS:"Failed to create UI components:",ZAP_ITEM:"Failed to create zap item HTML:",REFERENCE:"Reference component creation failed:"};static createUIComponents(e,t,n){try{const r=this.viewConfigs?.get(t),i=n||r?.identifier,s=lc(i)?null:this.#N(e);return{iconComponent:this.#M(),nameComponent:this.#z(e),pubkeyComponent:this.#O(e,i),referenceComponent:this.#U(s)}}catch(e){return this.#R()}}static#M(){return'<div class="zap-placeholder-icon skeleton"></div>'}static#R(){return{iconComponent:'<div class="zap-placeholder-icon skeleton"></div>',nameComponent:'<div class="zap-placeholder-name skeleton"></div>',pubkeyComponent:"",referenceComponent:""}}static createReferenceComponent(e){return this.#U(this.#N({reference:e}))}static addReferenceToElement(e,t){if(!this.#P(e,t))return;const n=e.querySelector(".zap-content");this.#D(n,t)}static#P(e,t){return e&&t&&e.querySelector(".zap-content")}static#D(e,t){e.querySelectorAll(".zap-reference").forEach((e=>e.remove()));const n=this.createReferenceComponent({reference:t});e.insertAdjacentHTML("beforeend",n)}static getDialogTemplate(){return'\n      <dialog class="dialog">\n        <h2 class="dialog-title"><a href="#" target="_blank"></a></h2>\n        <button class="close-dialog-button">X</button>\n        <div class="zap-stats"></div>\n        <ul class="dialog-zap-list"></ul>\n      </dialog>\n    '}static createZapItemHTML(e,t,n,r){try{const i=this.createUIComponents(e,n,r);return this.#B(e,t,i)}catch(e){return""}}static createNoZapsMessageHTML(e){return`\n      <div class="no-zaps-container">\n        <div class="no-zaps-message">${e}</div>\n      </div>\n    `}static#B(e,t,n){const[r,i]=e.satsText.split(" "),s=(o=e.created_at,Math.floor(Date.now()/1e3)-o<86400);var o;return`\n      <div class="zap-content">\n        <div class="zap-sender${e.comment?" with-comment":""}" data-pubkey="${e.pubkey}">\n          <div class="sender-icon${s?" is-new":""}">\n            ${n.iconComponent}\n          </div>\n          <div class="sender-info">\n            ${n.nameComponent}\n            ${n.pubkeyComponent}\n          </div>\n          <div class="zap-amount ${t}"><span class="number">${r}</span> ${i}</div>\n        </div>\n        ${e.comment?`<div class="zap-details"><span class="zap-comment">${ac(e.comment)}</span></div>`:""}\n        ${n.referenceComponent}\n      </div>\n    `}static#N(e){if(!e)return null;if(this.#j(e))return e;if(e.reference&&"object"==typeof e.reference){if(e.reference.reference&&this.#j(e.reference.reference))return e.reference.reference;if(this.#j(e.reference))return e.reference}return null}static#j(e){return e&&"object"==typeof e&&"id"in e&&"tags"in e&&Array.isArray(e.tags)&&"content"in e&&"kind"in e}static#z({senderName:e}){return e?`<span class="sender-name">${ac(e)}</span>`:'<div class="zap-placeholder-name skeleton"></div>'}static#O({pubkey:e,displayIdentifier:t,reference:n},r){const i=!lc(r),s=`class="sender-pubkey" data-pubkey="${e}"`;return n&&i?`<span ${s}>${t}</span>`:`<span ${s} data-nip05-target="true">${t}</span>`}static#U(e){if(!this.#j(e))return"";const t=e.id,n=Qa.getReferenceComponent(t);if(n)return n;try{const n=this.#F(e),r=this.#H(e),i=this.#$(n,r);return Qa.setReferenceComponent(t,i),i}catch(e){return""}}static#F(e){if(!e?.tags)return"";if(31990===e.kind)return this.#Z(e)||"";const t=Array.isArray(e.tags)?e.tags.find((e=>Array.isArray(e)&&"d"===e[0])):null;return t?`https://njump.me/${function(e,t,n,r=[]){try{return window.NostrTools.nip19.naddrEncode({kind:e,pubkey:t,identifier:n,relays:r})}catch(e){return null}}(e.kind,e.pubkey,t[1])}`:e.id?`https://njump.me/${function(e,t,n,r=[]){try{return window.NostrTools.nip19.neventEncode({id:e,kind:t,pubkey:n,relays:r})}catch(e){return null}}(e.id,e.kind,e.pubkey)}`:""}static#Z(e){const t=e.tags.filter((e=>"r"===e[0])),n=t.find((e=>!e.includes("source")))||t[0];return n?.[1]}static#H(e){if(!e)return"";const t=Pc.#k[e.kind];if(t){const n=e.tags.find((e=>Array.isArray(e)&&e[0]===t));if(n&&n[1])return n[1]}if(40===e.kind)try{return JSON.parse(e.content).name||e.content}catch{}return e.content||""}static#$(e,t){return`\n      <div class="zap-reference">\n        <div class="reference-icon">\n          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjODg4Ij4NCiAgICA8cGF0aCBkPSJtNTYwLTEyMC01Ny01NyAxNDQtMTQzSDIwMHYtNDgwaDgwdjQwMGgzNjdMNTAzLTU0NGw1Ni01NyAyNDEgMjQxLTI0MCAyNDBaIiAvPg0KPC9zdmc+" alt="Reference" width="16" height="16" />\n        </div>\n        <div class="reference-content">\n          <div class="reference-text">${ac(t)}</div>\n          <a href="${e}" target="_blank" class="reference-link">\n            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjODg4Ij4NCiAgICA8cGF0aA0KICAgICAgICBkPSJNNDQwLTI4MEgyODBxLTgzIDAtMTQxLjUtNTguNVQ4MC00ODBxMC04MyA1OC41LTE0MS41VDI4MC02ODBoMTYwdjgwSDI4MHEtNTAgMC04NSAzNXQtMzUgODVxMCA1MCAzNSA4NXQ4NSAzNWgxNjB2ODBaTTMyMC00NDB2LTgwaDMyMHY4MEgzMjBabTIwMCAxNjB2LTgwaDE2MHE1MCAwIDg1LTM1dDM1LTg1cTAtNTAtMzUtODV0LTg1LTM1SDUyMHYtODBoMTYwcTgzIDAgMTQxLjUgNTguNVQ4ODAtNDgwcTAgODMtNTguNSAxNDEuNVQ2ODAtMjgwSDUyMFoiIC8+DQo8L3N2Zz4=" alt="Quick Reference" width="16" height="16" />\n          </a>\n        </div>\n      </div>\n    `}static ZapInfo=class{#q;constructor(e){this.#q=e}static async createFromEvent(e,t={}){const n=new Pc.ZapInfo(e);return await n.extractInfo(t)}static getAmountColorClass(e,t){return(void 0===t?Da.ZAP_AMOUNT_CONFIG.DEFAULT_COLOR_MODE:!!t)?this.#V(e):Da.ZAP_AMOUNT_CONFIG.DISABLED_CLASS}static#V(e){const{THRESHOLDS:t,DEFAULT_CLASS:n}=Da.ZAP_AMOUNT_CONFIG;return t.find((t=>e>=t.value))?.className||n}async extractInfo(e={}){const t=this.#q.id,n=Qa.getZapInfo(t);if(n)return n.colorClass=Pc.ZapInfo.getAmountColorClass(n.satsAmount,e.isColorModeEnabled),n;try{const{pubkey:n,content:r,satsText:i}=await uc(this.#q),s=parseInt(i.replace(/,/g,"").split(" ")[0],10),o="string"==typeof n?n:null,a=this.#q.reference||null,c={satsText:i,satsAmount:s,comment:r||"",pubkey:o||"",created_at:this.#q.created_at,displayIdentifier:o?oc(cc(o)):"anonymous",senderName:null,senderIcon:null,reference:a,colorClass:Pc.ZapInfo.getAmountColorClass(s,e?.isColorModeEnabled)};return Qa.setZapInfo(t,c),c}catch(e){const n={satsText:"Amount: Unknown",satsAmount:0,comment:"",pubkey:"",created_at:this.#q.created_at,displayIdentifier:"anonymous",senderName:"anonymous",senderIcon:r,reference:null};return Qa.setZapInfo(t,n),n}var r}static async batchExtractInfo(e,t=!0){const n=new Map;return await Promise.all(e.map((async e=>{const r=new Pc.ZapInfo(e),i=await r.extractInfo({isColorModeEnabled:t});n.set(e.id,i)}))),n}};static viewConfigs=new Map}class Dc{constructor(e,t){this.viewId=e,this.config=t}async createListItem(e){const t=await Pc.ZapInfo.createFromEvent(e,{isColorModeEnabled:this.config?.isColorModeEnabled}),n=document.createElement("li");return n.className=`zap-list-item ${t.colorClass}${t.comment?" with-comment":""}`,n.setAttribute("data-pubkey",t.pubkey),e?.id&&n.setAttribute("data-event-id",e.id),n.innerHTML=Pc.createZapItemHTML(t,t.colorClass,this.viewId),n.setAttribute("data-timestamp",e.created_at.toString()),{li:n,zapInfo:t}}}class Bc{constructor(e,t,n,r){if(!e)throw new Error("shadowRoot is required");if(!r)throw new Error("config is required");this.shadowRoot=e,this.profileUI=t,this.viewId=n,this.config=r,this.itemBuilder=new Dc(n,this.config),this.profileUpdateUnsubscribe=null,this.#G()}destroy(){this.profileUpdateUnsubscribe&&(this.profileUpdateUnsubscribe(),this.profileUpdateUnsubscribe=null);const e=this.#W(".dialog-zap-list");e&&(e.innerHTML="")}#W(e){return this.shadowRoot.querySelector(e)}getElementByEventId(e){return this.#W(`.zap-list-item[data-event-id="${e}"]`)}async#Y(e){const t=this.#W(".dialog-zap-list");if(t)try{this.#K(t);return await e(t)}catch(e){0===t.children.length&&this.showNoZapsMessage()}}#Q(e,t){const n=e.querySelector(".load-more-trigger");n&&n.remove(),Array.from(t.children).forEach((t=>{const n=t.getAttribute("data-event-id"),r=parseInt(t.getAttribute("data-timestamp"));let i=null;const s=Array.from(e.children);for(let e=0;e<s.length;e++){if(r>parseInt(s[e].getAttribute("data-timestamp"))){i=s[e];break}}e.querySelector(`.zap-list-item[data-event-id="${n}"]`)||(i?e.insertBefore(t,i):e.appendChild(t))})),n&&e.appendChild(n)}#K(e){const t=e.querySelector(".no-zaps-message");t&&t.remove()}async#J(e,t){return this.#Y((async n=>{const{li:r,zapInfo:i}=await this.itemBuilder.createListItem(e);return t(n,r),await this.#X(i.pubkey,r),{li:r,zapInfo:i}}))}async renderZapListFromCache(e){if(!e?.length)return Qa.setNoZapsState(this.viewId,!1),this.showNoZapsMessage();await this.#Y((async t=>{const{initialBatch:n,remainingBatch:r}=this.#ee(e),{fragment:i,profileUpdates:s}=await this.#te(n);this.#Q(t,i),r.length>0?this.#ne(r,t,s):await this.#re(s)}))}#ee(e){const t=this.#ie(e),n=Da.DIALOG_CONFIG.ZAP_LIST.INITIAL_BATCH;return{initialBatch:t.slice(0,n),remainingBatch:t.slice(n)}}async#te(e){const t=document.createDocumentFragment(),n=[];for(const r of e){const{li:e,zapInfo:i}=await this.itemBuilder.createListItem(r);this.#se(r.id,e),t.appendChild(e),i.pubkey&&n.push({pubkey:i.pubkey,element:e})}return{fragment:t,profileUpdates:n}}#ne(e,t,n){if(!e.length)return;const r=Da.DIALOG_CONFIG.ZAP_LIST.REMAINING_BATCH;let i=0;const s=async()=>{if(i>=e.length)return void await this.#re(n);const o=e.slice(i,i+r);await this.#oe(o,t,n),i+=r,setTimeout((()=>s()),0)};requestIdleCallback((()=>s()))}async#oe(e,t,n){const r=document.createDocumentFragment();await Promise.all(e.map((async e=>{const{li:t,zapInfo:i}=await this.itemBuilder.createListItem(e);this.#se(e.id,t),r.appendChild(t),i.pubkey&&n.push({pubkey:i.pubkey,element:t})})));const i=t.querySelector(".load-more-trigger");i&&i.remove(),t.appendChild(r),i&&t.appendChild(i),await new Promise((e=>requestAnimationFrame(e)))}async prependZap(e){return this.#J(e,((e,t)=>e.prepend(t)))}async appendZap(e){return this.#J(e,((t,n)=>{const r=this.#ae(t,e.created_at);r?t.insertBefore(n,r):t.appendChild(n)}))}async replacePlaceholderWithZap(e,t){const n=this.#W(`[data-index="${t}"]`);if(this.#ce(n))try{const{zapInfo:t}=await this.itemBuilder.createListItem(e);this.#le(n,t,e.id),await this.#X(t.pubkey,n)}catch(e){n.remove()}}async showNoZapsMessage(){const e=this.#W(".dialog-zap-list");if(!e)return;if(Qa.hasNoZaps(this.viewId))return void this.#ue(e);await this.#he()||(this.#ue(e),Qa.setNoZapsState(this.viewId,!0))}async#he(){const e=this.config.noZapsDelay||Da.DIALOG_CONFIG.DEFAULT_NO_ZAPS_DELAY;await new Promise((t=>setTimeout(t,e)));const t=Qa.getZapEvents(this.viewId);return!!t?.length&&(await this.renderZapListFromCache(t),!0)}#ue(e){const t=this.config.noZapsMessage||Da.DIALOG_CONFIG.NO_ZAPS_MESSAGE;e.innerHTML=Pc.createNoZapsMessageHTML(t),e.style.minHeight=Da.DIALOG_CONFIG.ZAP_LIST.MIN_HEIGHT}async batchUpdate(e,t={}){const n=this.#W(".dialog-zap-list");if(n)try{const r=new Map(Array.from(n.querySelectorAll(".zap-list-item")).map((e=>[e.getAttribute("data-event-id"),e]))),i=this.#ie(e),s=lc(this.config.identifier),o=i.filter((e=>{const t=r.get(e.id);return s?!t:!t||e.reference&&!t.querySelector(".zap-reference")}));if(0===o.length&&!t.isFullUpdate)return;const a=document.createDocumentFragment();for(const e of o){const{li:t,zapInfo:n}=await this.itemBuilder.createListItem(e);!s&&e.reference&&this.updateZapReference(e),a.appendChild(t),n.pubkey&&await this.#X(n.pubkey,t)}this.#Q(n,a)}catch(e){}}#ae(e,t){return Array.from(e.children).find((e=>{const n=parseInt(e.getAttribute("data-timestamp")||"0");return t>n}))}updateZapReference(e){if(e?.id&&e?.reference)try{const t=this.getElementByEventId(e.id);if(!t)return;Pc.addReferenceToElement(t,e.reference),Qa.setReference(e.id,e.reference)}catch(e){}}#G(){this.profileUpdateUnsubscribe=Qa.subscribeToProfileUpdates(this.#de.bind(this))}async#de(e,t){const n=this.shadowRoot.querySelectorAll(`[data-pubkey="${e}"]`);await Promise.allSettled(Array.from(n).map((e=>this.profileUI.updateProfileElement(e,t))))}async#re(e){const t=Da.DIALOG_CONFIG.ZAP_LIST.PROFILE_BATCH;for(let n=0;n<e.length;n+=t){const r=e.slice(n,n+t);await Promise.all(r.map((({pubkey:e,element:t})=>this.#X(e,t)))),await new Promise((e=>requestAnimationFrame(e)))}}async#X(e,t){e&&await this.#fe(e,t)}async#fe(e,t){if(e&&t)try{await this.profileUI.loadAndUpdate(e,t)}catch(e){}}#ie(e){return[...new Map(e.map((e=>[e.id,e]))).values()].sort(((e,t)=>t.created_at-e.created_at))}#se(e,t){if(lc(this.config.identifier))return;const n=Qa.getReference(e);n&&Pc.addReferenceToElement(t,n)}#ce(e){return e&&e.classList.contains("placeholder")}#le(e,t,n){const r=this.itemBuilder.getAmountColorClass(t.satsAmount);e.className=`zap-list-item ${r}${t.comment?" with-comment":""}`,e.setAttribute("data-pubkey",t.pubkey),e.setAttribute("data-event-id",n),e.innerHTML=Pc.createZapItemHTML(t,r,this.viewId),e.removeAttribute("data-index")}}var jc=n(0),Fc=n.n(jc);const Hc=new class{#pe=new Map;#ge=new Map;constructor(){}async getZapStats(e,t){const n=await this.#ye(t,e);if(n)return n;const r=await this.fetchStats(e);return r&&Qa.updateStatsCache(t,e,r),r}async fetchStats(e){try{const t=await this._fetchFromApi(e);return this._formatStats(t)||this.createTimeoutError()}catch(e){return this.handleFetchError(e)}}createTimeoutError(){return{error:!0,timeout:!0}}handleFetchError(e){return{error:!0,timeout:"STATS_TIMEOUT"===e.message}}async _fetchFromApi(e){const t=function(e){try{return window.NostrTools.nip19.decode(e)}catch(e){return null}}(e);if(!t)return null;const n=`https://api.nostr.band/v0/stats/${"npub"===t.type||"nprofile"===t.type?"profile":"event"}/${e}`,r=new AbortController,i=setTimeout((()=>r.abort()),Da.REQUEST_CONFIG.REQUEST_TIMEOUT);try{const e=await fetch(n,{signal:r.signal});return await e.json()}catch(e){if("AbortError"===e.name)throw new Error("STATS_TIMEOUT");throw e}finally{clearTimeout(i)}}_formatStats(e){if(!e?.stats)return null;const t=Object.values(e.stats)[0];if(!t)return null;return{count:parseInt(t.zaps_received?.count||t.zaps?.count||0,10),msats:parseInt(t.zaps_received?.msats||t.zaps?.msats||0,10),maxMsats:parseInt(t.zaps_received?.max_msats||t.zaps?.max_msats||0,10)}}async initializeStats(e,t,n=!1){if(n&&this.displayStats({skeleton:!0},t),this.#ge.has(t))return this.#ge.get(t);const r=(async()=>{try{const n=await this.getZapStats(e,t);return n&&(this.displayStats(n,t),this.#pe.set(t,n)),n}catch(e){return null}finally{this.#ge.delete(t)}})();return this.#ge.set(t,r),r}async#ye(e,t){const n=Qa.getCachedStats(e,t),r=Date.now();return n&&r-n.timestamp<Da.REQUEST_CONFIG.CACHE_DURATION?n.stats:null}getCurrentStats(e){return this.#pe.get(e)}async handleZapEvent(e,t,n){if(e?.isRealTimeEvent)try{const r=e.tags.find((e=>"bolt11"===e[0].toLowerCase()))?.[1],i=this.extractAmountFromBolt11(r);if(i<=0)return;const s=Qa.getViewStats(t),o={count:s?.count||0,msats:s?.msats||0,maxMsats:s?.maxMsats||0},a={count:o.count+1,msats:o.msats+i,maxMsats:Math.max(o.maxMsats,i)};Qa.updateStatsCache(t,n,a),this.#pe.set(t,a),await this.displayStats(a,t),e.isStatsCalculated=!0,e.amountMsats=i}catch(e){}}extractAmountFromBolt11(e){try{const t=window.decodeBolt11(e);return parseInt(t.sections.find((e=>"amount"===e.name))?.value??"0",10)}catch(e){return 0}}async displayStats(e,t){try{await Wc(e,t)}catch(e){}}};const $c=new class{#we;#me;#be;#Ee;#ve;#Ie;#Ae;constructor(){this.#we=new zc,this.#Ce(),this.#xe()}#Ce(){this.#be=new Map,this.#Ee=new Map,this.#ve=new Map,this.#me=!1}#xe(){const e={pool:this.#we,batchSize:Da.BATCH_CONFIG.REFERENCE_PROCESSOR.BATCH_SIZE,batchDelay:Da.BATCH_CONFIG.REFERENCE_PROCESSOR.BATCH_DELAY};this.#Ie=new pc(e),this.#Ae=new gc(e)}#Se(e){this.#be.has(e)||this.#be.set(e,{zap:null}),this.#Ee.has(e)||this.#Ee.set(e,{isZapClosed:!1})}#Te(e,t,n,r){this.#be.get(e).zap=this.#we.subscribeMany(t.relayUrls,[n.req],r)}#Le(e){return e&&e.id&&Array.isArray(e.tags)}#ke(e,t){return e&&this.#ve.delete(e),null}async connectToRelays(e){if(this.#me)return;[this.#Ie,this.#Ae].forEach((t=>t.setRelayUrls(e))),this.#me=!0}subscribeToZaps(e,t,n,r){try{this.#_e(n),this.#Se(e);this.#Ee.get(e).isZapClosed=!1,this.#Te(e,t,n,this.#Ne(r))}catch(e){this.#Me("Subscription error",e)}}#_e(e){if(!e?.req?.kinds||!Array.isArray(e.req.kinds))throw new Error("Invalid subscription settings")}async fetchReference(e,t,n){try{if(!this.#Le(t))return null;const e=t.tags.find((e=>Array.isArray(e)&&e[0]===n));if(!e)return null;const r="e"===n?e[1]:`${e[1]}`,i=Qa.getReference(r);if(i)return i;const s=this.#ve.get(r);if(s)return s;const o="e"===n?this.#Ie:this.#Ae;try{const e=await o.getOrCreateFetchPromise(r);return e&&Qa.setReference(r,e),this.#ve.delete(r),e}finally{this.#ve.delete(r)}}catch(e){return this.#ke(t?.id,e)}}#Ne(e){const t=Math.floor(Date.now()/1e3);return{...e,onevent:n=>{n.isRealTimeEvent=n.created_at>=t,e.onevent(n)},oneose:e.oneose}}#Me(e,t){throw t}get zapPool(){return this.#we}},{zapPool:Zc}=$c;const qc=new class{constructor(){this.viewConfigs=new Map,this.configStore=new Map,this.observers=new Map,this.#be=new Map,this.#Ee=new Map}#be;#Ee;setZapListUI(e){this.zapListUI=e}setViewConfig(e,t){this.viewConfigs.set(e,t),Pc.viewConfigs.set(e,t),Qa.initializeZapView(e)}getViewConfig(e){return this.viewConfigs.get(e)}async updateEventReference(e,t){try{const n=this.getViewConfig(t);if(!n?.relayUrls?.length)return!1;if(lc(n?.identifier||""))return!1;const r=await this._fetchEventReference(e,n);return!!r&&(e.reference=r,!0)}catch(e){return!1}}async _fetchEventReference(e,t){const n=async()=>{if(!e?.tags||!Array.isArray(e.tags))return null;try{const n=e.tags.find((e=>Array.isArray(e)&&"a"===e[0]));if(n?.[1])return await $c.fetchReference(t.relayUrls,e,"a");const r=e.tags.find((e=>Array.isArray(e)&&"e"===e[0]));return r?.[1]&&/^[0-9a-f]{64}$/.test(r[1].toLowerCase())?await $c.fetchReference(t.relayUrls,e,"e"):null}catch(e){return null}};try{return await Qa.getOrFetchReference(e.id,n)}catch(e){return null}}async updateEventReferenceBatch(e,t){const n=this.getViewConfig(t);if(!n?.relayUrls?.length)return;if(lc(n?.identifier||""))return;const r=e.map((e=>this.updateEventReference(e,t)));await Promise.allSettled(r)}updateUIReferences(e){this.zapListUI&&e.forEach((e=>{e.reference&&this.zapListUI.updateZapReference(e)}))}async initializeSubscriptions(e,t){try{if(!this._isValidFilter(e))throw new Error("Invalid filter settings");const n=nc(e.identifier);if(!n)throw new Error(Da.ZAP_CONFIG.ERRORS.DECODE_FAILED);this._initializeLoadState(t),this._showInitialLoadingSpinner(t);const{batchEvents:r,lastEventTime:i}=await this._collectInitialEvents(t,e,n);r?.length>0&&this._processBatchEvents(r,t).catch(console.error),await this.finalizeInitialization(t,i)}catch(e){throw e}}_showInitialLoadingSpinner(e){const t=this._getListElement(e);if(t){const e=this._createLoadTrigger();t.appendChild(e)}}async finalizeInitialization(e,t){const n=Qa.getZapEvents(e),r=this._getListElement(e),i=Qa.updateLoadState(e,{isInitialFetchComplete:!0,lastEventTime:t});await Promise.all([i,0===n.length?this.zapListUI?.showNoZapsMessage():null,n.length>=Da.REQ_CONFIG.INITIAL_LOAD_COUNT?this.setupInfiniteScroll(e):null]),r?.querySelector(".load-more-trigger")?.remove()}_initializeLoadState(e){Qa.updateLoadState(e,{isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1})}_isValidFilter(e){return e&&e.relayUrls&&Array.isArray(e.relayUrls)&&e.relayUrls.length>0&&e.identifier}setupInfiniteScroll(e){try{this._cleanupInfiniteScroll(e);const t=this._getListElement(e);if(!t)return;const n=this._createLoadTrigger();t.appendChild(n),this._observeLoadTrigger(n,e,t)}catch(e){}}_createLoadTrigger(){const e=document.createElement("div");e.className="load-more-trigger";const t=document.createElement("div");return t.className="loading-spinner",e.appendChild(t),e}_observeLoadTrigger(e,t,n){const r=new IntersectionObserver((e=>this._handleIntersection(e[0],t)),{root:n,rootMargin:Da.INFINITE_SCROLL.ROOT_MARGIN,threshold:Da.INFINITE_SCROLL.THRESHOLD});r.observe(e),this.observers.set(t,r)}async _handleIntersection(e,t){if(!e.isIntersecting)return;Qa.getLoadState(t).isLoading?setTimeout((()=>{e.isIntersecting&&this._handleIntersection(e,t)}),Da.INFINITE_SCROLL.RETRY_DELAY):this.loadMoreZaps(t).then((e=>{0===e&&this._cleanupInfiniteScroll(t)})).catch((e=>{this._cleanupInfiniteScroll(t)}))}_cleanupInfiniteScroll(e){const t=this.observers.get(e);if(!t)return;t.disconnect();const n=this._getListElement(e);n?.querySelector(".load-more-trigger")?.remove(),this.observers.delete(e)}_getListElement(e){return document.querySelector(`nzv-dialog[data-view-id="${e}"]`)?.shadowRoot?.querySelector(".dialog-zap-list")}async loadMoreZaps(e){const t=Qa.getLoadState(e),n=this.getViewConfig(e);if(!this._canLoadMore(t,n))return 0;t.isLoading=!0;try{const r=await this._executeLoadMore(e,t,n);if(r>0){const t=Qa.getZapEvents(e).slice(-r);await this.updateEventReferenceBatch(t,e),this.updateUIReferences(t)}return r}finally{t.isLoading=!1}}async _executeLoadMore(e,t,n){const r=nc(n.identifier,t.lastEventTime);if(!r)return 0;const i=[],s=setTimeout((()=>{0===i.length&&this._cleanupInfiniteScroll(e)}),Da.LOAD_TIMEOUT);try{return await this._collectEvents(e,n,r,i,Da.REQ_CONFIG.ADDITIONAL_LOAD_COUNT,t),i.length>0&&await this._processBatchEvents(i,e),i.length}catch(e){return 0}finally{clearTimeout(s)}}async _collectEvents(e,t,n,r,i,s){return new Promise(((o,a)=>{const c=setTimeout((()=>a(new Error("Load timeout"))),Da.LOAD_TIMEOUT);$c.subscribeToZaps(e,t,n,{onevent:e=>{e.created_at<s.lastEventTime&&(r.push(e),s.lastEventTime=Math.min(s.lastEventTime,e.created_at),r.length>=i&&(clearTimeout(c),o()))},oneose:()=>{clearTimeout(c),o()}})}))}async _collectInitialEvents(e,t,n){const r=[];let i=null;return new Promise((s=>{const o=this._setupBufferInterval(r,e),a=$c.subscribeToZaps(e,t,n,{onevent:t=>{const n=this._handleInitialEvent(t,r,i,e);null!==n&&(i=n)},oneose:()=>{clearInterval(o),s({batchEvents:[...r],lastEventTime:i})}});this.#be.set(e,{zap:a})}))}_handleInitialEvent(e,t,n,r){const i=Math.min(n||e.created_at,e.created_at);if(Qa.addZapEvent(r,e)){if(t.push(e),this.updateEventReference(e,r).then((t=>{t&&this.zapListUI&&e.reference&&this.zapListUI.updateZapReference(e)})),e.isRealTimeEvent){const t=this.getViewConfig(r);Hc.handleZapEvent(e,r,t?.identifier),this.zapListUI&&this.zapListUI.prependZap(e).catch(console.error)}t.length>=Da.BATCH_SIZE&&this.zapListUI&&this.zapListUI.batchUpdate(Qa.getZapEvents(r)).catch(console.error)}return i}async _processBatchEvents(e,t){if(e?.length){e.sort(((e,t)=>t.created_at-e.created_at)),e.forEach((e=>Qa.addZapEvent(t,e)));try{await Promise.all([Uc.processBatchProfiles(e)])}catch(e){}await this._updateUI(e,t)}}async _updateUI(e,t){this.zapListUI&&await this.zapListUI.batchUpdate(e,{isFullUpdate:!0})}_setupBufferInterval(e,t){let n=0;const r=Da.BUFFER_MIN_INTERVAL;return setInterval((()=>{const i=Date.now();e.length>0&&i-n>=r&&this.zapListUI&&(this.zapListUI.batchUpdate(Qa.getZapEvents(t),{isBufferUpdate:!0}).catch(console.error),n=i)}),Da.BUFFER_INTERVAL)}_canLoadMore(e,t){return t&&!e.isLoading&&e.lastEventTime}unsubscribe(e){try{const t=this.#be.get(e);t?.zap&&(t.zap(),t.zap=null),this.#Ee.set(e,{isZapClosed:!0}),this._cleanupInfiniteScroll(e)}catch(e){}}};class Vc extends HTMLElement{#Ee;#ze;constructor(){super(),this.attachShadow({mode:"open"}),this.#Ee={isInitialized:!1,theme:Da.DEFAULT_OPTIONS.theme}}async connectedCallback(){if(this.viewId=this.getAttribute("data-view-id"),this.viewId){this.#ze=this.#Oe();try{await this.#ze,this.#Ee.isInitialized=!0;const e=qc.getViewConfig(this.viewId);if(!e)throw new Error("Config is required for initialization");await this.#Ue(e);if(this.getAttribute("data-nzv-id")){const e=await Hc.getCurrentStats(this.viewId);e&&this.statsUI.displayStats(e)}this.#Ee.isInitialized=!0,this.dispatchEvent(new CustomEvent("dialog-initialized",{detail:{viewId:this.viewId}}))}catch(e){}}}async#Oe(){return new Promise((e=>{const t=document.createElement("template");t.innerHTML=Pc.getDialogTemplate(),this.shadowRoot.appendChild(t.content.cloneNode(!0)),this.#Re(),queueMicrotask((()=>e()))}))}async#Ue(e){const t=document.createElement("style");t.textContent=Fc(),this.shadowRoot.appendChild(t),this.statsUI=new dc(this.shadowRoot),this.profileUI=new Rc,this.zapListUI=new Bc(this.shadowRoot,this.profileUI,this.viewId,e),qc.setZapListUI(this.zapListUI);const n=Qa.getZapEvents(this.viewId);n?.length?await this.zapListUI.renderZapListFromCache(n):this.zapListUI.showNoZapsMessage();const r=this.getAttribute("data-nzv-id");if(r){const e=await Qa.getCachedStats(this.viewId,r);if(e?.stats)this.statsUI.displayStats(e.stats);else{const e=await Hc.getCurrentStats(this.viewId);e&&this.statsUI.displayStats(e)}}}static get observedAttributes(){return["data-theme"]}#Re(){const e=this.#W(".dialog");this.#W(".close-dialog-button").addEventListener("click",(()=>this.closeDialog())),e.addEventListener("click",(t=>{t.target===e&&this.closeDialog()})),document.addEventListener("keydown",(t=>{if(e?.open)if("Escape"===t.key)this.closeDialog();else if(" "===t.key){t.preventDefault();const e=this.#W(".dialog-zap-list");e&&(e.scrollTop+=.8*e.clientHeight)}}))}attributeChangedCallback(e,t,n){if(t!==n&&"data-theme"===e)this.#Pe(n)}#Pe(e){Qa.updateThemeState(this.viewId,{theme:e}).isInitialized&&this.#De()}#De(){const e="dark"===Qa.getThemeState(this.viewId).theme?"dark-theme":"light-theme";this.shadowRoot.host.classList.add(e)}async showDialog(){await this.#ze;const e=this.#W(".dialog");e&&!e.open&&this.#Ee.isInitialized&&(e.showModal(),this.#Be(),history.pushState({dialogOpen:!0},""),window.addEventListener("popstate",this.#je))}closeDialog(){const e=this.#W(".dialog");e?.open&&(this.zapListUI?.destroy(),qc.unsubscribe(this.viewId),e.close(),this.remove(),window.removeEventListener("popstate",this.#je),history.state&&history.state.dialogOpen&&history.back())}#je=()=>{this.closeDialog()};displayZapStats(e){this.statsUI.displayStats(e)}#W(e){return this.shadowRoot.querySelector(e)}#Be(){const e=this.getAttribute("data-view-id"),t=document.querySelector(`button[data-zap-view-id="${e}"]`);if(!t)return;const n=this.#W(".dialog-title"),r=this.#W(".dialog-title a");if(!r||!n)return;r.setAttribute("tabindex","-1");const i=t.getAttribute("data-title"),s=t.getAttribute("data-nzv-id");r.href=s?`https://njump.me/${s}`:"#",i?.trim()?(r.textContent=i,n.classList.add("custom-title")):(r.textContent=Da.DIALOG_CONFIG.DEFAULT_TITLE+oc(s),n.classList.remove("custom-title"))}getOperations(){if(!this.#Ee.isInitialized)return null;const e={closeDialog:()=>this.closeDialog(),showDialog:()=>this.showDialog()};return this.#Ee.isInitialized&&Object.assign(e,{prependZap:e=>this.zapListUI?.prependZap(e),displayZapStats:e=>this.statsUI?.displayStats(e),showNoZapsMessage:()=>this.zapListUI?.showNoZapsMessage()}),e}async waitForInitialization(){return this.#ze}}customElements.define("nzv-dialog",Vc);const Gc={create:async(e,t)=>{if(!e||!t)return Promise.reject(new Error("Invalid viewId or config"));qc.setViewConfig(e,t);const n=document.querySelector(`nzv-dialog[data-view-id="${e}"]`);if(n)return n;const r=document.createElement("nzv-dialog");r.setAttribute("data-view-id",e),r.setAttribute("data-config",JSON.stringify(t));const i=document.querySelector(`button[data-zap-view-id="${e}"]`);return i?.getAttribute("data-nzv-id")&&r.setAttribute("data-nzv-id",i.getAttribute("data-nzv-id")),document.body.appendChild(r),await r.waitForInitialization(),r},get:e=>document.querySelector(`nzv-dialog[data-view-id="${e}"]`),execute:(e,t,...n)=>{const r=Gc.get(e),i=r?.getOperations();return i?i[t]?.(...n)??null:null}};const Wc=(e,t)=>Gc.execute(t,"displayZapStats",e);async function Yc(e,t){try{const n=Ba.fromButton(e);if(!n)throw new Error("Failed to create config from button");qc.setViewConfig(t,n);const r=await async function(e){try{const t=qc.getViewConfig(e);if(!t)throw new Error(`View configuration not found for viewId: ${e}`);return qc.setViewConfig(e,t),await Gc.create(e,t)}catch(e){return null}}(t);if(!r)throw new Error(Da.ZAP_CONFIG.ERRORS.DIALOG_NOT_FOUND);await async function(e){try{const t=Gc.get(e);if(!t)throw new Error("Dialog not found");await t.waitForInitialization();const n=t.getOperations();if(!n?.showDialog)throw new Error("Basic dialog operations not available");n.showDialog()}catch(e){}}(t),setTimeout((async()=>{if(await async function(e,t){const n=Qa.getZapEvents(e);if(n.length>0){const e=[...new Set(n.map((e=>e.pubkey)))];Uc.fetchProfiles(e)}const{hasEnoughCachedEvents:r}=await Qa.processCachedData(e,t);return r&&qc.setupInfiniteScroll(e),r}(t,n),!e.hasAttribute("data-initialized")){const r=e.getAttribute("data-nzv-id");await Promise.all([$c.connectToRelays(n.relayUrls),qc.initializeSubscriptions(n,t),r?Hc.initializeStats(r,t,!0):Promise.resolve()]),e.setAttribute("data-initialized","true")}}),0)}catch(e){}}function Kc(){Object.entries(Da.LIBRARIES).forEach((([e,t])=>{window[e]=t})),document.querySelectorAll("button[data-nzv-id]").forEach(((e,t)=>{if(e.hasAttribute("data-zap-view-id"))return;const n=`nostr-zap-view-${t}`;e.setAttribute("data-zap-view-id",n),e.hasAttribute("data-zap-color-mode")||e.setAttribute("data-zap-color-mode",Da.ZAP_CONFIG.DEFAULT_COLOR_MODE),e.addEventListener("click",(()=>Yc(e,n)))}))}function Qc(e={}){Object.assign(Da,e),"undefined"!=typeof window&&Kc()}"undefined"!=typeof window&&document.addEventListener("DOMContentLoaded",Kc)})(),r})()));